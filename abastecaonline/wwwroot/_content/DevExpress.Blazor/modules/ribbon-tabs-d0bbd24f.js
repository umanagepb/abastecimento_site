import{D as t}from"./dom-95153cd1.js";import{R as e,k as i,u as s,f as n,c as o,J as r,K as l,o as a,F as h}from"./dom-utils-2919d18e.js";import{L as c,U as u}from"./layout-builder-98e87af4.js";import{d,r as p}from"./disposable-d2c2d283.js";import{a as f,R as g}from"./rect-7fc5c2ef.js";import{attachEventsForFocusHiding as b}from"./focus-utils-000f342e.js";import"./browser-a3d50e79.js";import"./_tslib-158249d5.js";import"./point-9c6ab88a.js";import"./touch-53923870.js";var m;!function(t){t[t.None=0]="None",t[t.Back=1]="Back",t[t.Forward=2]="Forward"}(m||(m={}));class v{static calculate(t,e,i,s,n){let o=-e.left+i.left;switch(t){case m.Forward:o=Math.round(i.right-e.right),0===Math.round(o)&&n&&(o=Math.round(n.right-e.right)),o=Math.min(Math.max(0,o),e.width),0===o&&(o=e.width);break;case m.Back:o=i.left-e.left,0===Math.round(o)&&s&&(o=Math.round(s.left-e.left)),o=-Math.min(Math.max(0,Math.abs(o)),e.width),0===o&&(o=-e.width);break;default:{const t=i.left<e.left,r=i.right>e.right;if(!t&&!r)return 0;if(r){const t=i.right-e.right,s=n?n.right-e.right:0,r=i.left-s;o=n&&r>=e.left?o=s:t}else if(t){const t=-i.left+e.left,n=s?-s.left+e.left:0,r=i.right+t,l=i.right+n;o=s&&l<=e.right?-n:r<=e.right?-t:0}break}}return Math.round(o)}}class k extends c{constructor(t,e,i,s){super(t),this.builders=e||[],this.name=i,this.index=s?s.index+1:0,this.prevState=s,this.nextState=null,s&&(s.nextState=this)}for(t){return this.builders[this.builders.length]=this.createLayoutEntity(C,this.owner,this.name,t)}}class S extends c{constructor(t,e,i,s,n,o,r){super(t),this.onEnter=o,this.onLeave=r,this.prevBlock=null,this.nextBlock=null;const l=e;if(l.block&&(this.prevBlock=l.block,this.prevBlock&&(this.prevBlock.nextBlock=this)),l.block=this,this.isApplied=!1,this.node=e,this.className=s,this.blocksContainer=i,this.widthRanges=[],this.blocksContainerOffset=this.getBoxInnerOffset(i),this._isActive=n,u.getIsParent(i,e.parentNode))for(;e.parentNode!==i;)this.blocksContainerOffset+=this.getBoxInnerOffset(e=e.parentNode);this.ownerGroup=null}canBePushed(){return!this.isActive()&&this.prevBlock&&this.prevBlock.isActive()}canBePopped(){return this.isActive()&&this.prevBlock}push(){this._isActive=!0,this.prevBlock&&(this.prevBlock._isActive=!1)}pop(){this._isActive=!1,this.prevBlock&&(this.prevBlock._isActive=!0)}isActive(){return this._isActive}getWidth(t=!1){return t?this.widthRanges[0].maxWidth:this.widthRanges[0].minWidth}applyLayout(){!this.isApplied&&this.isActive()&&(this.nextBlock&&this.nextBlock.applyLayoutInternal(!1),this.prevBlock&&this.prevBlock.applyLayoutInternal(!1),this.applyLayoutInternal(!0))}applyLayoutInternal(t){this.isApplied!==t&&(this.toggleClassName(this.blocksContainer,this.className,t),t?this.onEnter():this.onLeave()),this.isApplied=t}dispose(){this.node.block=null,this.ownerGroup=null,this.isApplied&&this.toggleClassName(this.blocksContainer,this.className,!1)}}class B extends c{constructor(t,e){super(t),this.blocks=[],this.isDefault=e}isActive(){return this.blocks.some((function(t){return t.isActive()}))}addBlock(t){t.ownerGroup=this,this.blocks.push(t)}applyLayout(){for(let t=0;t<this.blocks.length;t++)this.blocks[t].applyLayout()}getWidth(t=!1){let e=0,i=null;const s=this.getOrderedBlocks();for(let n=0;n<s.length;n++){const o=s[n];this.isDefault&&i!==o.blocksContainer&&(i=o.blocksContainer,e+=o.blocksContainerOffset),e+=o.getWidth(t)}return e}getOrderedBlocks(){return this.blocks}shrink(){const t=this.getOrderedBlocks();for(let e=t.length-1;e>=0;e--){const i=t[e];if(i.canBePushed())return i.push(),!0}return!1}grow(){const t=this.getOrderedBlocks();for(let e=0;e<t.length;e++){const i=t[e];if(i.canBePopped())return i.pop(),!0}return!1}}class C extends c{constructor(t,e,i){super(t),this.name=e,this.selectorOrFunc=i,this.onStateEnter=null,this.onStateLeave=null,this.prepareBlockFunc=null}getBlockWidth(t){return this.prepareBlockFunc?this.prepareBlockFunc(t):[]}findBlockElements(t){const e=u.getChildElementNodesByPredicate(t,(t=>u.elementMatchesSelector(t,this.selectorOrFunc)));return null!=e?e:[]}setPrepareFunc(t){return this.prepareBlockFunc=t.bind(this),this}buildBlock(t,e,i){const s=this.createLayoutEntity(S,this.owner,t,e,this.name,i,(()=>{var t;this.onStateEnter&&(null===(t=this.owner)||void 0===t||t.domChanges.push(this.onStateEnter.bind(this,s)))}),(()=>{var t;this.onStateLeave&&(null===(t=this.owner)||void 0===t||t.domChanges.push(this.onStateLeave.bind(this,s)))}));return this.prepareBlockFunc&&(s.widthRanges=this.prepareBlockFunc(s)),s}onEnterState(t){return this.onStateEnter=t,this}onLeaveState(t){return this.onStateLeave=t,this}setOverflow(){return this}fixTabsWidth(){return this}}class y extends C{fixTabsWidth(){return this.prepareBlockFunc=function(e){var i;const s=t.getNodesByClassName(null===(i=this.owner)||void 0===i?void 0:i.getContainer(),"nav-tabs")[0];if(!s)return[];const n=a(s),o=s.querySelectorAll("li"),r=[],l={minWidth:0,maxWidth:0};for(let t=0;t<o.length;t++)h=this.getNodeWidth(o[t]),r.push({width:h,isActive:!0});var h;return l.minWidth=l.maxWidth=r.filter((function(t){return t.isActive})).reduce((function(t,e){return t+e.width}),n),[l]},this}setOverflow(){return this.prepareBlockFunc=function(t){const e=u.getChildElementNodes(t.node);if(!e)return[];const i=a(t.node)+h(t.node);let s=0;for(let t=0;t<e.length;t++)s=Math.max(s,this.getNodeWidth(e[t]));return[{minWidth:i+s,maxWidth:i+s}]},this}}class x extends c{constructor(t,e,i){super(t),this.groupsContainer=e,this.groupsContainerOffset=this.getBoxInnerOffset(this.groupsContainer),this.selector=i,this.currentWidth=-1,this.maxWidth=-1,this.minWidth=-1,this.blockGroups=[],this.allBlocks=[],this.states=[]}createBlockGroups(){}defineState(t,e){const i=[];e(this.createLayoutEntity(k,this.owner,i,t));const s=this.getNodesOrContainerIfMatches(this.groupsContainer,this.selector),n=this.createBlockGroup();for(let t=0;t<s.length;t++){const e=s[t];for(let t=0;t<i.length;t++){const s=i[t],o=this.getNodesOrContainerIfMatches(e,s.selectorOrFunc);for(let t=0;t<o.length;t++){const i=s.buildBlock(o[t],e,n.isDefault);this.allBlocks.push(i),n.addBlock(i)}}}}getNodesOrContainerIfMatches(t,e){let i=Array.from(t.querySelectorAll(e));return 0===i.length&&u.elementMatchesSelector(t,e)&&(i=[t]),i}createBlockGroup(t=null){return this.blockGroups[this.blockGroups.length]=this.createLayoutEntity(B,this.owner,0===this.blockGroups.length,t)}getWidth(t=!1){let e=0;e+=this.groupsContainerOffset;let i=null,s=0;for(let n=0;n<this.allBlocks.length;n++){const o=this.allBlocks[n];o.isActive()&&(i!==o.blocksContainer&&this.groupsContainer!==o.blocksContainer&&(e+=s,s=0,i=o.blocksContainer,s+=o.blocksContainerOffset),s+=o.getWidth(t))}return e+=s,e}shrink(){for(let t=0;t<this.blockGroups.length;t++)if(this.blockGroups[t].shrink())return!0;return!1}grow(){for(let t=this.blockGroups.length-1;t>=0;t--)if(this.blockGroups[t].grow())return!0;return!1}applyLayout(){for(let t=0;t<this.blockGroups.length;t++)this.blockGroups[t].applyLayout()}adjust(t){if(this.currentWidth>t){for(;this.getWidth()>t&&this.shrink(););this.currentWidth=t,this.applyLayout()}else if(t>this.currentWidth){for(;t>this.getWidth()&&this.grow();)if(this.getWidth()>t){this.shrink();break}this.currentWidth=t,this.applyLayout()}}initialize(){this.currentWidth=this.getWidth(!1),this.minWidth=this.currentWidth,this.maxWidth=this.getWidth(!0)}dispose(){for(let t=0;t<this.allBlocks.length;t++)this.allBlocks[t].dispose();this.allBlocks=[],this.blockGroups=[]}}class E extends c{constructor(t,e){super(null),this.rebuildBreakpointsInfo=[],this.builderClass=e,this.control=t,this.container=t.getMainElement(),this.containerOffsets=this.calculateContainerOffsets(),this.blockGroupsArray=[],this.isReady=!1,this.classesToApply=[],this.domChanges=[],this.nextAdjustGroupWidth=null}resolveLayoutEntityType(t){return t===C?this.builderClass:t}toggleClassNameInternal(t,e,i){this.getBatchCssUpdateCache(t)[e]=i}getBatchCssUpdateCache(t){let e=t._layoutBuilderCache;return e||(e=t._layoutBuilderCache={},this.classesToApply.push(this.createBatchCssUpdateDelegate(t))),e}createBatchCssUpdateDelegate(e){return function(){const i=e._layoutBuilderCache;if(i){delete e._layoutBuilderCache;for(const s in i)Object.prototype.hasOwnProperty.call(i,s)&&t.toggleClassName(e,s,i[s])}}}createBlockGroups(t,e,i){this.rebuildBreakpointsInfo.push({selector:t,groupSelector:e,prepareFunc:i});const s=[],n=this.querySelectorAll(t);for(let t=0;t<n.length;t++){const o=this.createLayoutEntity(x,this,n[t],e);this.blockGroupsArray.push(o),i&&i(o),o.createBlockGroups(),s.push(o)}return this.nextAdjustGroupWidth=this.getGroupsWidth(),s}rebuild(){const t=this.rebuildBreakpointsInfo;this.dispose();for(let e=0;e<t.length;e++)this.createBlockGroups(t[e].selector,t[e].groupSelector,t[e].prepareFunc);e((()=>this.initialize()))}initialize(){for(let t=0;t<this.blockGroupsArray.length;t++)this.blockGroupsArray[t].initialize();this.isReady=!0,this.adjust()}adjust(t=null,e=null){if(this.isReady){const i=this.classesToApply,s=this.domChanges;let n,o=this.classesToApply=[],r=this.domChanges=[];null!==this.nextAdjustGroupWidth?(n=this.nextAdjustGroupWidth,this.nextAdjustGroupWidth=null):n=this.getGroupsWidth();for(let t=0;t<this.blockGroupsArray.length;t++)this.blockGroupsArray[t].adjust(n);t&&t(),o=i.concat(o),r=s.concat(r),this.queueUpdates((()=>{for(;o.length;){const t=o.shift();t&&t()}this.queueUpdates((()=>{for(;r.length;){const t=r.shift();t&&t()}e&&e()}))}))}}queueUpdates(t){e(t)}getGroupsWidth(){const t=this.getContainer();return t?t.offsetWidth-this.containerOffsets:0}dispose(){this.containerOffsets=this.calculateContainerOffsets();for(let t=0;t<this.blockGroupsArray.length;t++)this.blockGroupsArray[t].dispose();this.blockGroupsArray=[],this.isReady=!1,this.rebuildBreakpointsInfo=[]}calculateContainerOffsets(){return this.container?this.getBoxInnerOffset(this.container):0}}class w{constructor(t,e){this.mainElementContentWidthSubscription=null,this.contentPanelWidthSubscription=null,this.currentSize={width:null,height:null},this.contentSize={width:null,height:null},this.layoutBreakPoints=null,this.scrollContainerElement=null,this.canTrackScroll=!1,this.tabCount=0,this.updateOverflowStateTimeout=0,this.onScrollHandler=this.onScroll.bind(this),this.onNextButtonClickHandler=this.onScrollToNext.bind(this),this.onPrevButtonClickHandler=this.onScrollToPrev.bind(this),this.onClickHandler=this.onClick.bind(this),this.dotNetReference=t,this.domChanges=[],this.mainElement=e.mainElement,this.tabCount=e.tabCount,this.scrollMode=e.scrollMode,this.activeTab=e.activeTab,this.id=e.id,this.renderMode=e.renderMode,this.subscribeToEvents()}subscribeToEvents(){if(d(this.mainElement),this.scrollMode!==W.NavButtons&&this.scrollMode!==W.Swipe)return;const t=this.getScrollContent();null==t||t.addEventListener("scroll",this.onScrollHandler),null==t||t.addEventListener("click",this.onClickHandler);const e=this.getPrevButton();null==e||e.addEventListener("click",this.onPrevButtonClickHandler);const i=this.getNextButton();null==i||i.addEventListener("click",this.onNextButtonClickHandler);const s=()=>{null==t||t.removeEventListener("scroll",this.onScrollHandler),null==t||t.removeEventListener("click",this.onClickHandler),null==e||e.removeEventListener("click",this.onPrevButtonClickHandler),null==i||i.removeEventListener("click",this.onNextButtonClickHandler)},n=b(this.mainElement);p(this.mainElement,(()=>{s(),n()}))}dispose(){this.updateOverflowStateTimeout&&(clearTimeout(this.updateOverflowStateTimeout),this.updateOverflowStateTimeout=0),this.mainElementContentWidthSubscription&&s(this.mainElementContentWidthSubscription),this.contentPanelWidthSubscription&&s(this.contentPanelWidthSubscription)}activate(t){const e=document.querySelector(w.getSelector("data-dxtabs-tab-id",t));if(e&&null!=e.parentNode){const t=Array.from(e.parentNode.children).indexOf(e);this.scrollToIndex(t)}}onScroll(t){this.updateOverflowState()}getMainElement(){return this.mainElement}initialize(){e((()=>{this.buildLayout()})),e((()=>{this.adjustLayout()})),this.mainElementContentWidthSubscription=n(this.getMainElement(),(t=>{this.currentSize.width===t.width&&this.currentSize.height===t.height||(this.currentSize={width:t.width,height:t.height},this.onMainElementResize())}));const t=document.querySelector(w.getSelector("data-dxtabs-content-id",this.id));t&&(this.contentPanelWidthSubscription=n(t,(t=>{this.contentSize.width===t.width&&this.contentSize.height===t.height||(this.contentSize={width:t.width,height:t.height},this.onContentElementResize())})))}onMainElementResize(){this.layoutBreakPoints&&this.layoutBreakPoints.adjust(),this.updateOverflowState()}onContentElementResize(){this.updateSelectedContent()}update(t){var e,i;this.tabCount!==t.tabCount||this.scrollMode!==t.scrollMode||this.renderMode!==t.renderMode?(this.scrollMode=t.scrollMode,this.renderMode=t.renderMode,this.tabCount=t.tabCount,this.activeTab=t.activeTab,this.scrollMode!==W.NavButtons||this.layoutBreakPoints?null===(e=this.layoutBreakPoints)||void 0===e||e.rebuild():this.initialize(),this.subscribeToEvents(),this.updateSelectedContent()):null===(i=this.layoutBreakPoints)||void 0===i||i.adjust(null,(()=>{this.queryUpdateOverflowState(200)}))}queryUpdateOverflowState(t){this.updateOverflowStateTimeout&&clearTimeout(this.updateOverflowStateTimeout),this.updateOverflowStateTimeout=setTimeout((()=>{this.updateOverflowStateTimeout=0,this.updateOverflowState()}),t)}buildLayout(){var t;this.scrollMode!==W.NavButtons&&this.scrollMode!==W.Swipe||(this.layoutBreakPoints=this.layoutBreakPoints||new E(this,y)),null===(t=this.layoutBreakPoints)||void 0===t||t.createBlockGroups(".dxbs-tabs-scrollable",".dxbs-tabs-scrollable",(t=>{t.defineState("no-overflow",(function(t){t.for(".dxbs-tabs-scrollable .nav").fixTabsWidth()})),t.defineState("has-overflow",(t=>{t.for(".dxbs-tabs-scrollable .nav").setOverflow().onEnterState((()=>this.onEnterOverflowState())).onLeaveState((()=>this.onLeaveOverflowState()))}))}))}adjustLayout(){var t;this.applyLayoutStateAppearance(),null===(t=this.layoutBreakPoints)||void 0===t||t.adjust()}applyLayoutStateAppearance(){var e;t.addClassName(this.getMainElement(),"dxbs-loaded"),null===(e=this.layoutBreakPoints)||void 0===e||e.initialize()}onEnterOverflowState(){this.canTrackScroll=!0,this.queryUpdateOverflowState()}onLeaveOverflowState(){this.canTrackScroll=!1}updateOverflowState(){if(!this.canTrackScroll||this.scrollMode!==W.NavButtons)return;const e=this.findScrollContainer();if(!e)return;const i=this.getScrollContent();if(!i)return;const s=i.scrollLeft,n=s>0,l=Math.round(i.scrollWidth-s)!==Math.round(i.clientWidth),a=this.getNextButton(),h=this.getPrevButton();o((()=>{t.toggleClassName(e,"can-scroll-right",l),a&&r(a,"disabled",!l),t.toggleClassName(e,"can-scroll-left",n),h&&r(h,"disabled",!n)}))}findScrollContainer(){if(!this.scrollContainerElement){const t=this.getMainElement();this.scrollContainerElement=u.elementMatchesSelector(t,".dxbs-tabs-scrollable")?t:t.querySelector(".dxbs-tabs-scrollable")}return this.scrollContainerElement}getScrollContent(){return t.getNodesByClassName(this.getMainElement(),"dxbs-scroll-viewer-content")[0]}getTabsCell(){return t.getNodesByClassName(this.getMainElement(),"nav-tabs")[0]}getPrevButton(){var t;return null===(t=this.findScrollContainer())||void 0===t?void 0:t.querySelector(".dxbs-tabs-scroll-btn.prev")}getNextButton(){var t;return null===(t=this.findScrollContainer())||void 0===t?void 0:t.querySelector(".dxbs-tabs-scroll-btn.next")}onScrollToPrev(t){t.preventDefault();const e=this.findExtremeTabItemIndex(this.tabCount-1,0);this.scrollToIndex(e,m.Back)}onClick(t){let e=t.target;for(;e;){if(l(e,"nav-item")){const t=e.getAttribute("data-dxtabs-tab-id");t&&this.activate(t);break}e=e.parentElement}}onScrollToNext(t){t.preventDefault();const e=this.findExtremeTabItemIndex(0,this.tabCount-1);this.scrollToIndex(e,m.Forward)}isElementVisible(t){return!0}getTabElement(e,i){const s=this.getTabsCell(),n=t.getChildNodesByClassName(s,"nav-item");return Array.from(n)[e]}scrollToIndex(t,e=m.None){if(t>-1&&this.getScrollContent()){const i=(t,e)=>t&&!this.isElementVisible(t)?i(e(t),e):t;let s=this.getTabElement(t,!1);this.isElementVisible(s)||(s=this.getTabElement(t,!0));const n=i(s.nextElementSibling,(function(t){return t.nextElementSibling})),o=i(s.previousElementSibling,(function(t){return t.previousElementSibling}));this.scrollToTab(s,o,n,e)}}findExtremeTabItemIndex(t,e){const i=(e-t)/Math.abs(e-t),s=this.getContentFrameRect(this.getScrollContent()),n=e+i;for(;t!==n;t+=i){let e=this.getTabElement(t,!1);if(this.isElementVisible(e)||this.isElementVisible(e=this.getTabElement(t,!0))){const n=e.getBoundingClientRect();if(-1===i&&n.left<s.left||1===i&&n.right>s.right)return t}}return-1}getContentFrameRect(e){const i=t.getCurrentStyle(e),s=e.getBoundingClientRect();return new f(s.left+t.pxToInt(i.paddingLeft)+t.pxToInt(i.borderLeftWidth),s.top+t.pxToInt(i.paddingTop)+t.pxToInt(i.borderTopWidth),s.width-t.pxToInt(i.paddingRight)-t.pxToInt(i.borderRightWidth),s.height-t.pxToInt(i.paddingBottom)-t.pxToInt(i.borderBottomWidth))}scrollToTab(t,e,i,s){const n=this.getScrollContent(),o=v.calculate(s,this.getContentFrameRect(n),g.fromDomRect(t.getBoundingClientRect()),e?g.fromDomRect(e.getBoundingClientRect()):void 0,i?g.fromDomRect(i.getBoundingClientRect()):void 0);0!==o&&(n.scrollLeft+=o)}changeSelection(t){this.activeTab=t.activeTab,this.activate(this.activeTab),this.updateSelectedContent()}updateSelectedContent(){const i=document.querySelector(w.getSelector("data-dxtabs-content-id",this.id));if(i){const s=document.querySelector(w.getSelector("data-dxtabs-content-id",this.activeTab)),n=Array.from(document.querySelectorAll(w.getSelector("data-dxtabs-content-id",this.id)+"> .dx-tabs-content")).filter((t=>t!==s));e((()=>{if(s&&(s.style.cssText="",s.setAttribute("data-dx-tab-loaded","")),this.renderMode!==T.Default){const t=`position:absolute;visibility:hidden;left:-10000px;width:${i.clientWidth}px;height:${i.clientHeight}px`;n.forEach((e=>{e.style.cssText=t}))}i&&t.addClassName(i,"dxbs-loaded")}))}}static getSelector(t,e){return`[${t}=${e}]`}}var T,W;!function(t){t[t.Default=0]="Default",t[t.AllTabs=1]="AllTabs",t[t.OnDemand=2]="OnDemand"}(T||(T={})),function(t){t[t.Auto=0]="Auto",t[t.NavButtons=1]="NavButtons",t[t.Swipe=2]="Swipe",t[t.NoScroll=3]="NoScroll"}(W||(W={}));const A=new Map;function O(t,e){const i=e.mainElement;if(!i)return Promise.reject("failed");let s=A.get(i);return s?s.update(e):(s=new w(t,e),s.initialize(),A.set(i,s)),Promise.resolve("ok")}function N(t,e){const i=A.get(e.mainElement);return i&&i.changeSelection(e),Promise.resolve("ok")}function M(t){return e(t,A),Array.from(A.keys()).forEach((t=>{i(t)&&e(t,A)})),Promise.resolve("ok");function e(t,e){if(!t)return;d(t);const i=e.get(t);null==i||i.dispose(),e.delete(t)}}const L={init:O,dispose:M,changeSelection:N,TabsScrollHelper:v};export{N as changeSelection,L as default,M as dispose,O as init};
