import{a as e}from"./_tslib-158249d5.js";import{i as n}from"./logicaltreehelper-15991dcb.js";import{P as o}from"./supportcaptureelement-35919fa4.js";import{DxUIHandlersBridgeTagName as t}from"./dx-ui-handlers-bridge-4076ae57.js";import{D as i}from"./dx-dropdown-owner-899c537e.js";import{E as s}from"./eventhelper-8570b930.js";import{s as r}from"./lit-element-b0a6fcba.js";import{e as l}from"./property-d3853089.js";class d extends i{constructor(){super(),this.boundOnKeyDownHandler=this.onKeyDown.bind(this),this.boundOnFocusOutHandler=this.onFocusOut.bind(this),this.boundOnClickHandler=this.onClick.bind(this),this.isDropDownOpen=!1,this.dropDownButtonElement=null,this._inputElement=null,this._uiHandlersBridge=null}get inputElement(){return this._inputElement}get uiHandlersBridge(){return this._uiHandlersBridge}connectedCallback(){super.connectedCallback(),this.addEventListener("keydown",this.boundOnKeyDownHandler),this.addEventListener("focusout",this.boundOnFocusOutHandler),this.addEventListener("click",this.boundOnClickHandler)}disconnectedCallback(){this.removeEventListener("keydown",this.boundOnKeyDownHandler),this.removeEventListener("focusout",this.boundOnFocusOutHandler),this.removeEventListener("click",this.boundOnClickHandler),super.disconnectedCallback()}getInputElement(){return this.querySelector("input")}onSlotChanged(e){super.onSlotChanged(e),this.dropDownButtonElement=this.querySelector(".dxbs-editor-dropdown-button"),this._inputElement=this.getInputElement(),n(this.inputElement,(()=>["logicalParent"]))&&this.addLogicalChild(this.inputElement),this._uiHandlersBridge=this.querySelector(t)}onKeyDown(e){this.isDropDownOpen||this.invokeKeyDownServerCommand(e)}onDropDownShown(e){var n;super.onDropDownShown(e),this.useMobileFocusBehaviour||null===(n=this.inputElement)||void 0===n||n.focus()}onFocusOut(e){var n,o,t;const i=s.getEventSource(e);if(null===(n=this.dropDownElement)||void 0===n?void 0:n.contains(i))return;const r=null!==(o=e.relatedTarget)&&void 0!==o?o:document.activeElement;this.contains(r)||(null===(t=this.dropDownElement)||void 0===t?void 0:t.contains(r))||this.processLostFocus()}onClick(e){var n;if(!s.containsInComposedPath(e,d.isClearButtonElement))return s.containsInComposedPath(e,d.isDropDownButtonElement)?(e.stopPropagation(),void this.toggleDropDownVisibility()):void 0;null===(n=this.inputElement)||void 0===n||n.focus()}canHandlePointerDown(e){return o.containsInComposedPath(e,this.dropDownButtonElement)||o.containsInComposedPath(e,this.inputElement)}invokeKeyDownServerCommand(e){return d.isToggleDropDownVisibilityKeyCommand(e)?(this.toggleDropDownVisibility(),!0):super.invokeKeyDownServerCommand(e)}processLostFocus(){}ensureDropDownElement(){super.ensureDropDownElement(),this.dropDownElement&&this.dropDownElement.addEventListener("focusout",this.boundOnFocusOutHandler)}disposeDropDownElement(){super.disposeDropDownElement(),this.dropDownElement&&this.dropDownElement.removeEventListener("focusout",this.boundOnFocusOutHandler)}toggleDropDownVisibility(){var e;null===(e=this.uiHandlersBridge)||void 0===e||e.send(this.isDropDownOpen?"closeDropDown":"openDropDown",{})}static isToggleDropDownVisibilityKeyCommand(e){return(e.altKey||e.metaKey)&&("ArrowUp"===e.key||"ArrowDown"===e.key)}static isClearButtonElement(e){var n;return!!e&&(null===(n=e.classList)||void 0===n?void 0:n.contains("dxbs-editor-clear-btn"))}static isDropDownButtonElement(e){var n;return!!e&&(null===(n=e.classList)||void 0===n?void 0:n.contains("dxbs-editor-dropdown-button"))}}d.shadowRootOptions={...r.shadowRootOptions,delegatesFocus:!0},e([l({type:Boolean,attribute:"is-dropdown-open"})],d.prototype,"isDropDownOpen",void 0);export{d as D};
