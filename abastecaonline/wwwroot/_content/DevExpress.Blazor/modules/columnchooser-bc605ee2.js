import{A as e}from"./dom-utils-2919d18e.js";import{E as n}from"./eventRegister-fb9b0e47.js";import{FocusUnit as t,DragAndDropUnit as o,getClientRect as s,RectBlz as i}from"./dragAndDropUnit-87b22292.js";import"./dom-95153cd1.js";import"./browser-a3d50e79.js";import"./_tslib-158249d5.js";import"./touch-53923870.js";let r,c,u,l,f,d,a,p,m,h=null,v=-1,g=-1,w=!0,y=!1;function _(e,t,o,s){const i=Array.from(t).map((e=>function(e){const n=e.clientRef;return e.serverRef&&(n._dx_server_ref=e.serverRef),n}(e)));if(l?l._id!==s._id&&(B(l),l=s):l=s,!p){p=e;let n=p;for(;n.parentNode!==document&&n.classList;){if(n.classList.contains("modal-dialog")){y=!0;break}n=n.parentNode}}if(f=new Map,d&&d.dispose(),d=new n(p),h||(c=new Map,u=new Map,h=i),g=-1,d.attachEventWithContext(document,"keydown",b,document),h&&(h.sort(((e,n)=>e.dataset.vindex-n.dataset.vindex)),m=function(e,n){if(y)return e;let t=e,o=window.getComputedStyle(t);for(;o.position!==n&&t.parentNode!==document;)t=t.parentNode,o=window.getComputedStyle(t);return t}(p,"absolute"),x(o&&!y),E())){const e=d.attachEvent(m,"focusin",(function(){e.dispose(),h[0].focus()}))}O()}function x(e){w=e,a&&a.dispose();const n=document.querySelector(".column-chooser-exit-button");a=n?new t(n,null,p,!w):null,u.forEach((function(e){e.dispose()})),u=new Map,h.forEach((function(e){!function(e,n){if(e._dx_server_ref){let n=c.get(e);n||(n=new o(e,e.parentNode,C,".column-chooser-drag-icon-owner",z,y),n.onDragStart=M,n.onDrag=q,n.onDragCancel=S,n.onDropAnimationEnd=R,c.set(e,n)),n.reset()}e.classList.remove("up"),e.classList.remove("down"),e.classList.remove("freeze");let s=u.get(e);s||(s=new t(e,".custom-control-input",n,y||!w),s.onFocus=N,s.onBlur=k,s.onClick=D,u.set(e,s));s.reset()}(e,m)}))}function E(){return w}function b(e){switch(E()||(x(!0),9===e.keyCode&&h[h.length-1].focus()),e.keyCode){case 32:g>=0&&(e.preventDefault(),h[g].click());break;case 38:e.preventDefault(),L(-1);break;case 40:e.preventDefault(),L(1)}}function L(e){if(!h||!c)return;g+=e,g=g<0?h.length-1:g,g%=h.length;const n=u.get(h[g]);n&&n.focus()}function N(e){g=h.indexOf(e)}function k(e){g===h.indexOf(e)&&(g===h.length-1&&a&&a.focus(),g=-1)}function D(e){E()&&x(!1)}function j(e){return h.find((function(n,t,o){return function(e,n){const t=A(e);return!!t&&(t.top<=n&&n<=t.bottom)}(n,e.y)}))}function C(e){const n=j(e);return n?{item:n,relativeRect:A(n)}:null}function O(){if(r&&r.style){const e=c.get(r);e&&e.reset();const n=u.get(r);n&&n.reset(),v=-1,r.childNodes.forEach((function(e){e.style&&(e.style.visibility="")})),r=null}}function M(e){r=e,v=h.indexOf(r),h.forEach((function(e){e.blur(),e!==r&&e.classList.add("freeze")})),r.childNodes.forEach((function(e){e.style&&(e.style.visibility="hidden")}));const n=u.get(r);n&&n.stop()}function A(e){let n=f.get(e);if(n)return n;const t=s(e),o=z();return n=new i(t.x-o.x,t.y-o.y,t.width,t.height),f.set(e,n),n}function R(n,t){h.forEach((function(e){c.get(e).stop()}));const o=p.cloneNode(!0);e(o),o.style["z-index"]=2e3,p.parentNode.appendChild(o),l.invokeMethodAsync("OnElementsExchange",n._dx_server_ref,t._dx_server_ref).catch((function(e){console.error(e)})).finally((()=>o.remove()))}function S(e){h.forEach((function(e){e.classList.remove("up"),e.classList.remove("down"),e.classList.remove("freeze")})),O()}function z(){const e=y?p.parentNode:p,n=s(e);return 0!==e.scrollTop?{x:n.x,y:n.y-e.scrollTop}:n.location}function T(e){u.get(e).updateStyleMetadata()}function q(e,n){if(!e)return;-1===v&&(v=h.indexOf(e));const t=j(n.centerOfDraggingObject);if(!t)return;const o=h.indexOf(t);let s=!1;h.forEach(v<o?function(e){r===e&&(s=!0),s?(T(e),e.classList.add("up")):e.classList.remove("up","down"),t===e&&(s=!1)}:v>o?function(e){t===e&&(s=!0),s?(T(e),e.classList.add("down")):e.classList.remove("up","down"),r===e&&(s=!1)}:function(e){e.classList.remove("up","down")})}function B(e){e._id===l._id&&(e.dispose(),c.forEach((function(e,n){e.dispose(),n._dx_server_ref&&n._dx_server_ref.dispose()})),u.forEach((function(e){e.dispose()})),h=null,r=null,v=-1,p=null,f=null,c=null,u=null,l=null,d&&d.dispose(),d=null)}const F={init:_,dispose:B};export{F as default,B as dispose,_ as init};
