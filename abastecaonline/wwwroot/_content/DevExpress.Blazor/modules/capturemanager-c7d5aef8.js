import{D as e,S as t}from"./simpleevent-84045703.js";import{L as n}from"./locker-c40478e6.js";import{E as r}from"./eventhelper-8570b930.js";import{L as a}from"./logicaltreehelper-15991dcb.js";import{L as s}from"./layouthelper-4b19d191.js";class i{static isFocused(e){return e===document.activeElement}static isFocusWithin(e,t=!1){return t?a.containsElement(e,document.activeElement):s.containsElement(e,document.activeElement)}static restoreFocus(e){e.focus({preventScroll:!1}),this.restoreFocusAction.execute((()=>{i.isFocused(e)||e.focus({preventScroll:!1})}))}static cancelRestoreFocus(){this.restoreFocusAction.cancel()}static unfocus(){i.cancelRestoreFocus();const e=document.activeElement;e&&e.blur()}}i.restoreFocusAction=new e;class o{constructor(){this.handled=!1}}class c extends o{constructor(){super(...arguments),this.nextInteractionHandled=!1}}class u{constructor(){this._lostCaptureEvent=new t,this._gotCaptureEvent=new t,this._capturedElement=null,this._captureStack=[],this.pointerDownHandler=this.handlePointerDown.bind(this),this.mouseClickHandler=this.handleClick.bind(this),this.pointerUpHandler=this.handlePointerUp.bind(this),this.keyDownHandler=this.handleKeyDown.bind(this),this.capturedInteractionLocker=new n,this.preventNextPointerInteraction=!1,this.restoreFocusOnPreventNextPointerInteractionElement=null,document.addEventListener("pointerdown",this.pointerDownHandler,{capture:!0}),document.addEventListener("click",this.mouseClickHandler,{capture:!0}),document.addEventListener("pointerup",this.pointerUpHandler,{capture:!0}),document.addEventListener("keydown",this.keyDownHandler,{capture:!0})}get hasCapture(){return!!this._capturedElement}get lostCapture(){return this._lostCaptureEvent}get gotCapture(){return this._gotCaptureEvent}get capturedElement(){return this._capturedElement}get captureStackCount(){return this._captureStack.length}capture(e,t=!0){if(e===this.capturedElement)return!0;if(this.capturedElement&&!this.removeCapture(this.capturedElement,e))return!1;return this.createCapture(this._capturedElement,e,t)}releaseCapture(e){var t;if(this.capturedElement!==e)return this._captureStack=this._captureStack.filter((t=>t!==e)),!0;const n=null!==(t=this._captureStack.pop())&&void 0!==t?t:null;return this.capture(n,!1)}removeCapture(e,t){const n={sender:e,target:t,result:!0};this.lostCapture.raise(n);return!!n.result&&(e.lostCapture(),!0)}createCapture(e,t,n){if(!t)return this._capturedElement=null,!0;const r={sender:t,result:!0};this.gotCapture.raise(r);return!!r.result&&(e&&n&&this._captureStack.push(e),this._capturedElement=t,t.gotCapture(),!0)}handlePointerUp(e){if(!this.capturedInteractionLocker.IsLocked)return this.preventNextPointerInteraction?(this.restoreFocusOnPreventNextPointerInteractionElement=document.activeElement,void r.markHandled(e,!1)):void 0;r.markHandled(e,!1)}handleClick(e){if(this.capturedInteractionLocker.IsLocked)r.markHandled(e,!1);else if(this.preventNextPointerInteraction){if(this.preventNextPointerInteraction=!1,r.markHandled(e,!1),this.restoreFocusOnPreventNextPointerInteractionElement&&i.isFocused(this.restoreFocusOnPreventNextPointerInteractionElement))return;i.unfocus()}}async handlePointerDown(e){if(!this.capturedInteractionLocker.IsLocked&&(this.preventNextPointerInteraction=!1,this.capturedElement))try{this.capturedInteractionLocker.lock();const t=new c;await this.capturedElement.processCapturedPointerDownAsync(e,t),this.preventNextPointerInteraction=t.handled&&t.nextInteractionHandled,this.preventNextPointerInteraction&&r.markHandled(e,!1)}finally{this.capturedInteractionLocker.unlock()}}async handleKeyDown(e){var t;if(this.hasCapture&&!this.capturedInteractionLocker.IsLocked)try{this.capturedInteractionLocker.lock();const n=new o;await(null===(t=this.capturedElement)||void 0===t?void 0:t.processCapturedKeyDownAsync(e,n))}finally{this.capturedInteractionLocker.unlock()}}hasCapturedElementForTests(){return this.hasCapture}getCapturedElementForTests(){return this.capturedElement}}function l(){return p}const p=new u,d=Object.freeze({__proto__:null,CaptureInteractionOptions:o,PointerCaptureInteractionOptions:c,CaptureManager:u,getCaptureManagerSingletonForTests:l,captureManagerSingleton:p,default:{CaptureManager:u,captureManagerSingleton:p,getCaptureManagerSingletonForTests:l}});export{i as F,d as a,p as c};
