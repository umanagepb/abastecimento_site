import{a as e}from"./_tslib-158249d5.js";import{S as t,a as s}from"./simpleevent-84045703.js";import{F as n,c as i}from"./capturemanager-c7d5aef8.js";import{v as o,B as a,p as r,d as l}from"./popuproot-d37b16a2.js";import{BranchActivatedEvent as d,BranchIdContext as c,BranchRefreshedEvent as h}from"./branch-ea431ccc.js";import{T as u,I as p,V as b,D as m,a as g,b as f,P as y,c as w,d as v}from"./supportcaptureelement-35919fa4.js";import{B as I}from"./browser-a3d50e79.js";import{D as E}from"./dom-95153cd1.js";import{D as S}from"./layouthelper-4b19d191.js";import{L as C}from"./logicaltreehelper-15991dcb.js";import{n as x}from"./nameof-factory-64d95f5b.js";import{C as T}from"./custom-events-helper-18f7786a.js";import{e as D}from"./property-d3853089.js";import{n as F}from"./custom-element-bd7061f2.js";import{$ as B,s as k}from"./lit-element-b0a6fcba.js";import{D as R}from"./popupbasedialog-0778f080.js";import{D as H}from"./popupportal-447465dc.js";import"./locker-c40478e6.js";import"./eventhelper-8570b930.js";import"./data-qa-utils-8be7c726.js";import"./rafaction-bba7928b.js";import"./dx-ui-element-de378e9d.js";import"./lit-element-base-af247167.js";import"./rect-7fc5c2ef.js";import"./point-9c6ab88a.js";const O=new class{constructor(){this._shadowBranchEvent=new t,this._topShadowId=null,this.shadowSet=new Set}get shadowBranchChanged(){return this._shadowBranchEvent}register(e){this.shadowSet.add(e),this.raiseTopShadowStackChanged()}unregister(e){this.shadowSet.delete(e),this.raiseTopShadowStackChanged()}raiseTopShadowStackChanged(){const e=this.getTopShadowModal();if(this._topShadowId===e)return;this._topShadowId=e;this._shadowBranchEvent.raise({branch:e})}getTopShadowModal(){let e=-1,t="";for(const s of Array.from(this.shadowSet)){const n=o.getIndex(s);n>e&&(e=n,t=s)}return t}};const L=new class{constructor(){this.paddingCoerced=!1,this.bodyScrollTop=0,this.bodyScrollPadding="",this.scrollLocked=!1,this.scrollLockHostSet=new Set}register(e){this.scrollLockHostSet.add(e),this.updateScrollLock()}unregister(e){this.scrollLockHostSet.delete(e),this.updateScrollLock()}updateScrollLock(){this.toggleBodyScroll(document.body,this.scrollLockHostSet.size>0)}toggleBodyScroll(e,t){t!==this.scrollLocked&&(this.scrollLocked=t,this.toggleScrollPadding(e,t),E.toggleClassName(e,"modal-open",t),E.toggleClassName(e,"dxbs-modal-open",t),I.Safari&&this.toggleSafariScroll(e,t))}toggleScrollPadding(e,t){if(t){const t=S.getVerticalScrollbarWidth();if(0===t)return;this.paddingCoerced=!0;const s=parseInt(getComputedStyle(document.body).getPropertyValue("padding-right"),10);return this.bodyScrollPadding=document.body.style.paddingRight,void(e.style.paddingRight=`${s+t}px`)}this.paddingCoerced&&(e.style.paddingRight=this.bodyScrollPadding,this.paddingCoerced=!1)}toggleSafariScroll(e,t){t?(this.bodyScrollTop=window.pageYOffset,E.toggleClassName(e,"dx-prevent-safari-scrolling",t)):(E.toggleClassName(e,"dx-prevent-safari-scrolling",t),window.scrollTo(0,this.bodyScrollTop))}},j=["a[href]","audio[controls]","button",'[contenteditable]:not([contenteditable="false"])',"details>summary:first-of-type","details","input","select","textarea","[tabindex]","video[controls]"].join(",");class K{static getTabbables(e,t){const s=this.findTabbables(e,t),n=[],i=[];return s.forEach(((e,t)=>{const s=K.getTabIndex(e);0===s?n.push(e):i.push({index:t,tabIndex:s,item:e})})),i.sort(((e,t)=>e.tabIndex===t.tabIndex?e.index-t.index:e.tabIndex-t.tabIndex)).map((e=>e.item)).concat(n)}static findTabbables(e,t){const s=Array.from(e.querySelectorAll(j));return(t&&e.matches(j)||e.webkitMatchesSelector(j))&&s.unshift(e),s.filter(K.filterTabbable)}static filterTabbable(e){return!e.disabled&&(!K.isHiddenInput(e)&&(!K.isHidden(e)&&!(K.getTabIndex(e)<0)))}static getTabIndex(e){const t=e.getAttribute("tabindex");if(t){const e=parseInt(t,10);if(!isNaN(e))return e}return"true"===e.contentEditable||e.nodeName===u.audio||e.nodeName===u.video||e.nodeName===u.details?0:e.tabIndex}static isHiddenInput(e){return e.tagName===u.input&&e.getAttribute("type")===p.hidden}static isHidden(e){if(window.getComputedStyle(e).visibility===b.hidden)return!0;let t=e;for(;t;){if(window.getComputedStyle(e).display===m.none)return!0;t=t.parentElement}return!1}}class A{constructor(e){this.action=null,this.postponeAction=e}executePostpone(e){this.action=null,this.postponeAction()?e():this.action=e}execute(){this.action&&this.postponeAction()&&this.executeForce()}executeForce(){this.action&&this.action(),this.clear()}clear(){this.action=null}}const P=new class{constructor(){this.element=null,this.tabbables=[],this.lastFocusedElement=null,this.mutationObserver=new MutationObserver(this.handleMutations.bind(this)),this.focusPostponedAction=new A((()=>{var e,t;return null!==(t=(null===(e=this.tabbables)||void 0===e?void 0:e.length)>0)&&void 0!==t&&t})),this.documentFocusInHandler=this.documentFocusIn.bind(this),this.documentKeyDownHandler=this.documentKeyDown.bind(this),this.firstInnerElementKeyDownHandler=this.firstInnerElementKeyDown.bind(this),this.lastInnerElementKeyDownHandler=this.lastInnerElementKeyDown.bind(this),this.handleFocusOutHandler=this.handleFocusOut.bind(this),this.firstInnerElement=null,this.lastInnerElement=null}activate(e){if(this.element="string"==typeof e?document.querySelector(e):e,null===this.element)throw"element is null";this.lastFocusedElement=document.activeElement,this.subscribe(this.element),this.tabbables=K.getTabbables(this.element,!0),this.updateInnerElements(),this.subscribeInnerElementsKeyDown(),this.focusPostponedAction.executePostpone(this.forceFocusFirstElement.bind(this)),this.mutationObserver.observe(this.element,{subtree:!0,childList:!0})}deactivate(e){this.element&&(this.focusPostponedAction.clear(),this.mutationObserver.disconnect(),this.unsubscribeDocument(),this.unsubscribe(this.element),this.unsubscribeInnerElementsKeyDown(),e&&!C.containsElement(this.element,document.activeElement)&&this.lastFocusedElement&&n.restoreFocus(this.lastFocusedElement),this.element=null,this.lastFocusedElement=null,clearTimeout(this.updateTabbablesTimerID))}forceFocusFirstElement(){const e=this.tabbables[0];e&&(this.lastFocusedElement&&this.element&&C.containsElement(this.element,document.activeElement)||n.restoreFocus(e))}handleMutations(e){clearTimeout(this.updateTabbablesTimerID),this.updateTabbablesTimerID=setTimeout((()=>{this.tabbables=K.getTabbables(this.element,!0),this.unsubscribeInnerElementsKeyDown(),this.updateInnerElements(),this.subscribeInnerElementsKeyDown(),this.focusPostponedAction.execute()}),50)}subscribe(e){this.element.addEventListener("focusout",this.handleFocusOutHandler,!0)}unsubscribe(e){this.element.removeEventListener("focusout",this.handleFocusOutHandler,!0)}handleFocusOut(e){const t=e.relatedTarget;t?this.element.contains(t)||this.focusPostponedAction.executePostpone(this.forceFocusFirstElement.bind(this)):this.subscribeDocument()}subscribeDocument(){document.addEventListener("focusin",this.documentFocusInHandler),document.addEventListener("keydown",this.documentKeyDownHandler)}unsubscribeDocument(){document.removeEventListener("keydown",this.documentKeyDownHandler),document.removeEventListener("focusin",this.documentFocusInHandler)}documentKeyDown(e){var t;const s=e.target;if(s&&(this.element===s||(null===(t=this.element)||void 0===t?void 0:t.contains(s))))return;const n=this.element;n&&n.processKeyDown(e)}documentFocusIn(e){const t=e.target;if(!t)return;this.unsubscribeDocument();const s=e.relatedTarget;(s||this.element.contains(t))&&(!s||this.element.contains(s))||this.focusPostponedAction.executePostpone(this.forceFocusFirstElement.bind(this))}firstInnerElementKeyDown(e){var t;this.firstInnerElement===document.activeElement&&"Tab"===e.key&&e.shiftKey&&(e.preventDefault(),null===(t=this.lastInnerElement)||void 0===t||t.focus({preventScroll:!1}))}lastInnerElementKeyDown(e){var t;this.lastInnerElement!==document.activeElement||"Tab"!==e.key||e.shiftKey||(e.preventDefault(),null===(t=this.firstInnerElement)||void 0===t||t.focus({preventScroll:!1}))}unsubscribeInnerElementsKeyDown(){var e,t;null===(e=this.firstInnerElement)||void 0===e||e.removeEventListener("keydown",this.firstInnerElementKeyDownHandler),null===(t=this.lastInnerElement)||void 0===t||t.removeEventListener("keydown",this.lastInnerElementKeyDownHandler)}subscribeInnerElementsKeyDown(){var e,t;null===(e=this.firstInnerElement)||void 0===e||e.addEventListener("keydown",this.firstInnerElementKeyDownHandler),null===(t=this.lastInnerElement)||void 0===t||t.addEventListener("keydown",this.lastInnerElementKeyDownHandler)}updateInnerElements(){this.tabbables&&(this.firstInnerElement=this.tabbables[0],this.lastInnerElement=this.tabbables[this.tabbables.length-1])}},q=x();class z{constructor(e){this.closeReason=e}}class N extends CustomEvent{constructor(e){super(N.eventName,{detail:new z(e),bubbles:!0,composed:!0,cancelable:!0})}}N.eventName="dxbl-modal.closingRequested",T.register(N.eventName,(e=>e.detail));class _ extends CustomEvent{constructor(e){super(_.eventName,{detail:new z(e),bubbles:!0,composed:!0,cancelable:!0})}}_.eventName="dxbl-modal.closingResultRequested",T.register(_.eventName,(e=>e.detail));let V=class extends g{constructor(){super(...arguments),this._positionChangedEvent=new s,this.shadowSlotChangedHandler=this.handleShadowSlotChange.bind(this),this.topShadowBranchChangedHandler=this.handleTopShadowBranchChanged.bind(this),this.shadow=null,this.closingResultRequestedTcs=new f,this.popupDialog=null,this._zIndex=0,this.modal=null,this.shadingChangedEvent=new t,this._isOpen=!1,this.shading=!1,this.closeOnOutsideClick=!1,this.closeOnEscape=!1,this.autoZIndex=!1,this.manualZIndex=0,this.shadowVisible=!1,this.topShadowBranchId=null,this.hasServerSideClosing=!1,this.disableFocusTrap=!1}get positionChanged(){return this._positionChangedEvent}get renderedVisible(){return!0}get isOpen(){return this._isOpen}get branchType(){return a.Modal}get preventInteractions(){return!0}render(){return B`
            <dxbl-branch
                id="branch"
                branch-id="${this.branchId}"
                type="${this.branchType}">
                ${this.renderShadow()}
                ${this.renderDefaultSlot()}
            </dxbl-branch>
        `}renderDefaultSlot(){return B`<slot></slot>`}renderShadow(){return B`<slot name="shadow" @slotchange="${this.shadowSlotChangedHandler}"></slot>`}get zindex(){return this._zIndex}set zindex(e){e!==this._zIndex&&(this._zIndex=e,this.applyZIndexToModal())}handleShadowSlotChange(e){const t=e.target.assignedNodes();this.shadow=t.find((e=>e instanceof HTMLElement))}get shadingChanged(){return this.shadingChangedEvent}connectedCallback(){super.connectedCallback(),this.subscribeToEvents()}disconnectedCallback(){super.disconnectedCallback(),this.unsubscribeFromEvents(),this.close()}show(){this.isOpen||(this._isOpen=!0,this.initializeCapture(),this.initializeBodyScrollLock(),this.addToVisibleBranchTree())}close(){this.isOpen&&(this._isOpen=!1,this.releaseCapture(),this.releaseBodyScrollLock(),this.removeFromVisibleBranchTree())}willUpdate(e){this.shadowVisible=this.shading&&this.isOpen&&!!this.branchId&&this.branchId===this.topShadowBranchId}updated(e){this.shadow&&e.has(q("shadowVisible"))&&(this.shadow.style.display=this.shadowVisible?m.block:m.none),e.has(q("manualZIndex"))&&(this.style.zIndex=this.autoZIndex?"":String(this.manualZIndex))}ensureBranchId(){if(!this.branchId)throw new Error("branchId should not be null")}addToVisibleBranchTree(){this.ensureBranchId(),o.register(this.branchId),O.register(this.branchId),this.raiseBranchRefreshed()}removeFromVisibleBranchTree(){this.ensureBranchId(),o.unregister(this.branchId),O.unregister(this.branchId),this.raiseBranchRefreshed()}initializeBodyScrollLock(){L.register(this.branchId)}releaseBodyScrollLock(){L.unregister(this.branchId)}subscribeToEvents(){O.shadowBranchChanged.subscribe(this.topShadowBranchChangedHandler)}unsubscribeFromEvents(){O.shadowBranchChanged.unsubscribe(this.topShadowBranchChangedHandler)}handleTopShadowBranchChanged(e){this.topShadowBranchId=e.branch}initializeCapture(){i.capture(this)}releaseCapture(){this.processClosingRequested(!0),i.releaseCapture(this)}processClosingRequested(e){this.closingResultRequestedTcs.resolve(e),this.closingResultRequestedTcs=new f}applyZIndexToModal(){this.modal&&(this.modal.style.zIndex=this.zindex.toString(10))}notifyDialogConnected(e){this.popupDialog=e,this.initializeFocusTrap()}notifyDialogDisconnected(){this.popupDialog=null,this.initializeFocusTrap()}gotCapture(){super.gotCapture(),this.activate(),this.initializeFocusTrap()}lostCapture(){super.lostCapture(),this.releaseFocusTrap()}initializeFocusTrap(){this.isOpen&&this.popupDialog&&!this.disableFocusTrap&&P.activate(this.popupDialog)}releaseFocusTrap(){P.deactivate(!this.isOpen)}activate(){const e=new d(new c(this.branchId));this.dispatchEvent(e)}notifyCloseCanceled(){this.processClosingRequested(!1)}async processCapturedPointerDownAsync(e,t){t.handled||y.containsInComposedPath(e,this.popupDialog)||(t.nextInteractionHandled=!0,await w.processCapturedPointerDown(this,e,t))}async processCapturedKeyDownAsync(e,t){t.handled||this.closeOnEscape&&"Escape"===e.key&&await this.processEscape(e,t)}async processEscape(e,t){const s=await this.raiseClosingResultRequestedAsync(v.EscapePress);this.closingResultRequestedTcs=new f,s||(t.handled=!0)}async closeAsync(e,t){const s=await this.raiseClosingResultRequestedAsync(t);return this.closingResultRequestedTcs=new f,e.nextInteractionHandled=!0,e.handled=!0,Promise.resolve(!!s)}async closeHierarchyAsync(e,t,s){for(const e of o.iterateBranch(this.branchId)){const n=r.getPopup(e);await(null==n?void 0:n.closeAsync(t,s))}await this.closeAsync(t,s)}async raiseClosingResultRequestedAsync(e){if(!this.hasServerSideClosing)return this.raiseClosingRequested(e),!0;const t=new f;return this.closingResultRequestedTcs=t,this.raiseClosingResultRequested(e),t.promise}raiseClosingRequested(e){this.dispatchEvent(new N(e))}raiseClosingResultRequested(e){this.dispatchEvent(new _(e))}raiseBranchRefreshed(){const e=new h(new c(this.branchId));this.dispatchEvent(e)}};e([D({type:Boolean,attribute:"x-is-open",reflect:!0,converter:{fromAttribute:(e,t)=>{throw new Error("readonly")}}})],V.prototype,"_isOpen",void 0),e([D({type:Boolean,attribute:"shading"})],V.prototype,"shading",void 0),e([D({type:Boolean,attribute:"close-on-outside-click"})],V.prototype,"closeOnOutsideClick",void 0),e([D({type:Boolean,attribute:"close-on-escape"})],V.prototype,"closeOnEscape",void 0),e([D({type:Boolean,attribute:"auto-z-index"})],V.prototype,"autoZIndex",void 0),e([D({type:Number,attribute:"manual-z-index"})],V.prototype,"manualZIndex",void 0),e([D({type:String,attribute:"branch-id"})],V.prototype,"branchId",void 0),e([D({reflect:!1})],V.prototype,"shadowVisible",void 0),e([D({reflect:!1})],V.prototype,"topShadowBranchId",void 0),e([D({type:Boolean,attribute:"has-serverside-closing"})],V.prototype,"hasServerSideClosing",void 0),e([D({type:Boolean,attribute:"disable-focus-trap"})],V.prototype,"disableFocusTrap",void 0),V=e([F("dxbl-modal")],V);let M=class extends R{constructor(){super(...arguments),this.popup=null}connectedCallback(){super.connectedCallback(),this.popup=this.closest("dxbl-modal"),this.popup.notifyDialogConnected(this)}disconnectedCallback(){var e;super.disconnectedCallback(),null===(e=this.popup)||void 0===e||e.notifyDialogDisconnected(),this.popup=null}};M=e([F("dxbl-modal-dialog")],M);let Z=class extends k{constructor(){super(...arguments),this.slotChangedHandler=this.handleSlotChange.bind(this)}render(){return B`
            <slot @slotchange=${this.slotChangedHandler}></slot>
        `}handleSlotChange(e){const t=e.target.assignedNodes().find((e=>e instanceof M)),s=this.closest("dxbl-modal");s&&(t?s.notifyDialogConnected(t):s.notifyDialogDisconnected())}};Z=e([F("dxbl-modal-root")],Z);const $=["dxbl-modal-dialog","dxbl-modal","dxbl-modal-root",l,H];function U(e){return e}const W={getReference:U,registeredComponents:$};export{W as default,U as getReference,$ as registeredComponents};
