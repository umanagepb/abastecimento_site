import{B as e}from"./dom-9e6f7067.js";import{k as t}from"./key-b2db12a3.js";import{d as s,r as i}from"./disposable-d2c2d283.js";import{u as n,A as o,e as a,k as r}from"./dom-utils-728879e5.js";class l{constructor(e,t){this.preloader=e,this.parent=t,this._initialPaddingRight=0,this._initialPaddingLeft=0,this._contentWidth=0,this._internalWidthChanging=!1,this._unsubscriber=()=>!1,this._onHide=new Array,this.preloaderElement=e,this._preloaderWidth=e.offsetWidth,this.parentElement=t}static get(e){return l.preloaderMap.get(e)}static create(e,t){let s=l.get(e);return s||(s=new l(e,t),l.preloaderMap.set(e,s)),s}static remove(e){const t=l.preloaderMap.get(e);t&&(t.hide(),l.preloaderMap.delete(e))}display(e){this.init(e),this.preloaderElement.style.top=(this.parentElement.offsetHeight-this.preloaderElement.offsetHeight)/2+"px",this.calculateHorizontalPosition(this.parentElement.clientWidth-this._initialPaddingLeft-this._initialPaddingRight),this._internalWidthChanging=!0,this._unsubscriber=this.subscribeOnParentWidthChange(),this.preloaderElement.classList.remove("dxbs-preloader-initial")}hide(){this.preloaderElement.onanimationend=()=>{this.preloaderElement.style.display="none",n(this._unsubscriber),this.parentElement.style.paddingRight=this._initialPaddingRight+"px",this._onHide.forEach((e=>{e()})),this._onHide=[]},this.preloaderElement.classList.add("dxbs-preloader-success")}registerOnHideAction(e){this._onHide.push(e)}changeInitialPaddingRight(e){this._initialPaddingRight=e}init(e){this._contentWidth=e;const t=getComputedStyle(this.parentElement);this._initialPaddingRight=parseFloat(t.paddingRight),this._initialPaddingLeft=parseFloat(t.paddingLeft)}subscribeOnParentWidthChange(){return o(this.parentElement,(e=>{this._internalWidthChanging?this._internalWidthChanging=!1:this.calculateHorizontalPosition(e)}))}calculateHorizontalPosition(e){const t=parseFloat(this.parentElement.style.paddingRight);if(0===e||t===this._initialPaddingRight&&e-this._preloaderWidth<0)return this.preloaderElement.style.visibility="hidden",void(t!==this._initialPaddingRight&&(this._internalWidthChanging=!0,this.parentElement.style.paddingRight=this._initialPaddingRight+"px"));if(this.preloaderElement.style.visibility="visible",e<this._preloaderWidth+this._contentWidth)this.preloaderElement.style.left="auto",this.preloaderElement.style.right=this._initialPaddingRight+"px",t!==this._initialPaddingRight+this._preloaderWidth&&(this.parentElement.style.paddingRight=this._initialPaddingRight+this._preloaderWidth+"px",this._internalWidthChanging=!0);else{this.preloaderElement.style.left="calc("+(this._contentWidth+this._initialPaddingLeft)+"px + "+(0===this._contentWidth?"0":"0.5")+"em)",t!==this._initialPaddingRight&&(this._internalWidthChanging=!0,this.parentElement.style.paddingRight=this._initialPaddingRight+"px")}}}let d;l.preloaderMap=new Map;class h{constructor(){this.init_new_manager=window.Module.mono_bind_static_method("[DevExpress.Blazor.WebAssembly.Masks] MaskWrapper.MasksCollection:GetNewManager"),this.keyPress=window.Module.mono_bind_static_method("[DevExpress.Blazor.WebAssembly.Masks] MaskWrapper.MasksCollection:KeyPress"),this.clear=window.Module.mono_bind_static_method("[DevExpress.Blazor.WebAssembly.Masks] MaskWrapper.MasksCollection:Clear"),this.paste=window.Module.mono_bind_static_method("[DevExpress.Blazor.WebAssembly.Masks] MaskWrapper.MasksCollection:Paste"),this.getValue=window.Module.mono_bind_static_method("[DevExpress.Blazor.WebAssembly.Masks] MaskWrapper.MasksCollection:GetValue"),this.setValue=window.Module.mono_bind_static_method("[DevExpress.Blazor.WebAssembly.Masks] MaskWrapper.MasksCollection:SetValue"),this.setSelection=window.Module.mono_bind_static_method("[DevExpress.Blazor.WebAssembly.Masks] MaskWrapper.MasksCollection:SetSelection"),this.disposeMaskManager=window.Module.mono_bind_static_method("[DevExpress.Blazor.WebAssembly.Masks] MaskWrapper.MasksCollection:DisposeMaskManager"),this.updateProperties=window.Module.mono_bind_static_method("[DevExpress.Blazor.WebAssembly.Masks] MaskWrapper.MasksCollection:UpdateProperties")}}class u{constructor(e){e.includes("\\")&&(e=e.split("\\").join("\\\\")),this.info=JSON.parse(e)}get selectionStart(){return this.info.selectionStart}get selectionEnd(){return this.info.selectionEnd}get value(){return this.info.value}get displayText(){return this.info.displayText}}class p{constructor(e,t){this.onDisposeActions=new Array,this.customWheelProcessing=!1,this.suppressFocusEvents=!1,this.focusByMouse=!1,this.internalButtonsFocusEventsBlocked=!1,this.inputElement=e,this.dotnetHelper=t}initializeEvents(e){const t=t=>{e.onKeyDown(t)},s=t=>{e.onKeyUp(t)},n=t=>{e.onClick(t)},o=t=>{e.onCut(t)},a=t=>{e.onPaste(t)},l=t=>{e.onDrop(t)},d=t=>{e.shouldProcessOnFocus()&&e.onFocusByTab(e.inputElement.value?e.inputElement.value.length:0),e.focusByMouse=!1},h=t=>{e.focusByMouse=!1,e.onFocusOut(t)},u=t=>{e.onWheel(t,e)},p=t=>{e.checkValidInput()&&(e.focusByMouse=!0)};this.inputElement.addEventListener("keydown",t),this.inputElement.addEventListener("keyup",s),this.inputElement.addEventListener("click",n),this.inputElement.addEventListener("cut",o),this.inputElement.addEventListener("paste",a),this.inputElement.addEventListener("drop",l),this.inputElement.addEventListener("focus",d),this.inputElement.addEventListener("focusout",h),this.inputElement.addEventListener("wheel",u,{passive:!1}),this.inputElement.addEventListener("mousedown",p);const c=r(this.inputElement,".dxbs-input-group");c&&this.blockButtonsFocusEvents(c,this),i(this.inputElement,(()=>{e.inputElement.removeEventListener("keydown",t),e.inputElement.removeEventListener("keyup",s),e.inputElement.removeEventListener("click",n),e.inputElement.removeEventListener("cut",o),e.inputElement.removeEventListener("paste",a),e.inputElement.removeEventListener("drop",l),e.inputElement.removeEventListener("focus",d),e.inputElement.removeEventListener("focusout",h),e.inputElement.removeEventListener("wheel",u),e.inputElement.removeEventListener("mousedown",p),e.dispose()}))}blockButtonsFocusEvents(t,s){if(e.MobileUI||this.internalButtonsFocusEventsBlocked)return;const i=t.querySelectorAll(".dxbs-btn-group button");if(i&&i.length>0){const e=()=>{s.setSuppressFocusEvents(!0)},t=()=>{s.setSuppressFocusEvents(!1),s.focusByMouse=!0};i.forEach((s=>{s.addEventListener("mousedown",e),s.addEventListener("focusout",t),this.onDisposeActions.push((()=>{s.removeEventListener("mousedown",e),s.removeEventListener("focusout",t)}))})),this.internalButtonsFocusEventsBlocked=!0}}setSuppressFocusEvents(e){this.suppressFocusEvents=e}dispose(){for(;this.onDisposeActions.length>0;){const e=this.onDisposeActions.pop();e&&e()}}disposeMaskManagerCore(){}checkValidInsertion(e,s){return e.keyCode===t.KeyCode.Backspace||e.keyCode===t.KeyCode.Delete||e.keyCode===t.KeyCode.Home||e.keyCode===t.KeyCode.Enter||e.keyCode===t.KeyCode.End||(e.keyCode===t.KeyCode.Up||e.keyCode===t.KeyCode.Down)&&!s||e.keyCode===t.KeyCode.Left||e.keyCode===t.KeyCode.Right||e.ctrlKey&&(e.keyCode===t.KeyCode.Key_a||e.keyCode===t.KeyCode.Key_z)||!e.ctrlKey&&1===e.key.length}shouldProcessOnFocus(){return!this.suppressFocusEvents&&!e.MobileUI&&!this.focusByMouse&&this.checkValidInput()}checkValidInput(){return!this.inputElement.disabled&&!this.inputElement.readOnly}canHandleMouseWheel(){return this.checkValidInput()&&document.activeElement===this.inputElement&&!this.customWheelProcessing}}class c extends p{constructor(e,t,s,i){super(e,t),this.managerId=-1,this.isWheelScrolling={timer:0},this.maskProperties=s,this.onInputMode=i,this.customWheelProcessing=s.customWheelProcessing}initializeMonoMasks(e,t){return new Promise(((s,i)=>{this.maskProperties&&this.maskProperties.editMask&&0!==this.maskProperties.maskMode?(this.inputElement.value=e,this.displayPreloader(),void 0!==d?(this.initializeInternal(t),s()):(c.maskLoadingPromise||this.loadMasks(),c.maskLoadingPromise.then((()=>{this.initializeInternal(t),s()})))):i()}))}initializeInternal(e){s(this.inputElement),this.managerId=d.init_new_manager(this.maskProperties.maskMode,this.maskProperties.editMask,this.maskProperties.placeholder,this.maskProperties.lcid,this.maskProperties.flags,this.maskProperties.valueString,this.maskProperties.valueType,e),this.initializeEvents(this),this.fadeOutPreloader(),this.inputElement.setAttribute("data-dx-client-mask-initialized","true")}loadMasks(){c.maskLoadingPromise||(c.maskLoadingPromise=new Promise(((e,t)=>{const s=document.createElement("script");s.src="_content/DevExpress.Blazor.Server.WebAssembly/dotnet.js",s.onload=function(){!function t(){window.MONO.mono_wasm_runtime_is_ready?(document.head.removeChild(s),d=new h,e(!0)):window.setTimeout(t,100)}()},document.head.appendChild(s)})))}displayPreloader(){const e=r(this.inputElement,".dxbs-input-group");if(!e)return;const t=e.querySelector(".dxbs-preloader-container"),s=l.create(t,this.inputElement);if(s){this.blockEvents(this.inputElement,s);let t=0;if(this.inputElement.value){const s=document.createElement("span");s.style.visibility="hidden",s.style.width="auto",s.style.position="fixed",s.innerHTML=this.inputElement.value,s.style.fontSize=getComputedStyle(this.inputElement).fontSize,e.append(s),t=s.clientWidth,s.remove()}s.display(t)}}blockEvents(e,t){function s(e){e.preventDefault(),e.stopPropagation()}const i=r(e,".dxbs-input-group");let n=[];i&&(n=i.querySelectorAll("button"),n&&n.forEach((e=>{e.addEventListener("click",s),e.addEventListener("mousedown",s),e.addEventListener("mouseup",s)}))),e.addEventListener("keydown",s),e.addEventListener("click",s),e.addEventListener("cut",s),e.addEventListener("paste",s),t.registerOnHideAction((function(){e.removeEventListener("keydown",s),e.removeEventListener("click",s),e.removeEventListener("cut",s),e.removeEventListener("paste",s),n&&n.forEach((e=>{e.removeEventListener("click",s),e.removeEventListener("mousedown",s),e.removeEventListener("mouseup",s)}))}))}fadeOutPreloader(){const e=r(this.inputElement,".dxbs-input-group");if(!e)return;const t=e.querySelector(".dxbs-preloader-container");l.remove(t)}applyMaskInfo(e,t,s=""){this.checkValidInput()&&(this.inputElement.value=s||e.displayText,t&&this.dotnetHelper&&this.dotnetHelper.invokeMethodAsync("SetValue",e.value)),this.inputElement.setAttribute("dx-mask-value",e.value),document.activeElement===this.inputElement&&this.inputElement.setSelectionRange(e.selectionStart,e.selectionEnd)}onKeyDown(s){if(e.AndroidMobilePlatform&&s.preventDefault(),!this.checkValidInsertion(s,this.maskProperties.customArrowsUpDownProcessing)||!this.checkValidInput()||e.AndroidMobilePlatform)return;s.preventDefault();const i=new u(d.keyPress(this.managerId,s.key,s.shiftKey,s.ctrlKey));this.applyMaskInfo(i,this.onInputMode||s.keyCode===t.KeyCode.Enter),s.keyCode!==t.KeyCode.Left&&s.keyCode!==t.KeyCode.Right&&s.keyCode!==t.KeyCode.Home&&s.keyCode!==t.KeyCode.End||(this.suppressFocusEvents=!0,this.inputElement.blur(),this.inputElement.focus(),this.suppressFocusEvents=!1)}onKeyUp(s){if(this.checkValidInput())if(e.AndroidMobilePlatform){let e=s.key;229===s.keyCode&&(e=this.inputElement.value.substring(this.inputElement.selectionStart-1,this.inputElement.selectionStart));const i=new u(d.keyPress(this.managerId,e,!1,!1));this.applyMaskInfo(i,this.onInputMode||s.keyCode===t.KeyCode.Enter)}else s.keyCode!==t.KeyCode.Up&&s.keyCode!==t.KeyCode.Down||this.dotnetHelper.invokeMethodAsync("SetValue",this.inputElement.getAttribute("dx-mask-value"))}onClick(e){if(!this.checkValidInput())return;const t=new u(d.setSelection(this.managerId,this.inputElement.selectionStart,this.inputElement.selectionEnd));this.inputElement.selectionStart===this.inputElement.selectionEnd&&this.applyMaskInfo(t,!1)}onCut(e){if(!this.checkValidInput())return;e.preventDefault(),document.execCommand("copy");const t=new u(d.clear(this.managerId,this.inputElement.selectionStart,this.inputElement.selectionEnd));this.applyMaskInfo(t,this.onInputMode)}onPaste(e){if(!this.checkValidInput())return;e.preventDefault();const t=e.clipboardData,s=null==t?void 0:t.getData("Text"),i=new u(d.paste(this.managerId,s));this.applyMaskInfo(i,this.onInputMode)}onDrop(e){e.preventDefault()}onFocusByTab(e){const t=new u(d.setSelection(this.managerId,0,e));this.applyMaskInfo(t,!1)}onFocusOut(e){if(!this.checkValidInput()||this.suppressFocusEvents)return;e.preventDefault();const t=new u(d.getValue(this.managerId));this.dotnetHelper.invokeMethodAsync("OnFocusLost",t.value),this.applyMaskInfo(t,!1)}onWheel(e,t){if(!this.canHandleMouseWheel())return;e.preventDefault(),window.clearTimeout(this.isWheelScrolling.timer);const s=new u(d.keyPress(this.managerId,e.deltaY<0?"ArrowUp":"ArrowDown",!1,!1));this.applyMaskInfo(s,!1),this.isWheelScrolling.timer=setTimeout((function(){t.dotnetHelper.invokeMethodAsync("SetValue",t.inputElement.getAttribute("dx-mask-value"))}),500)}disposeMaskManagerCore(){const e=r(this.inputElement,".dxbs-input-group");if(e){const t=e.querySelector(".dxbs-preloader-container");l.remove(t)}void 0!==d&&d.disposeMaskManager(this.managerId)}setValue(e,t,s){const i=new u(d.setValue(this.managerId,e,t));this.applyMaskInfo(i,!1,s)}updateMask(e,t){this.maskProperties=e;const s=new u(d.updateProperties(this.managerId,e.maskMode,e.editMask,e.placeholder,e.lcid,e.flags,e.valueString,e.valueType));this.applyMaskInfo(s,!1,t)}}c.maskLoadingPromise=null;class m extends p{constructor(e,t,s,i){super(e,t),this.customArrowsProcessing=s,this.customWheelProcessing=i}initialize(e){this.inputElement.value=e,this.initializeEvents(this)}onKeyDown(s){this.checkValidInsertion(s,this.customArrowsProcessing)&&this.checkValidInput()&&!e.AndroidMobilePlatform&&(s.preventDefault(),this.dotnetHelper.invokeMethodAsync("KeyDown",s.key,s.keyCode,s.shiftKey,s.ctrlKey),s.keyCode!==t.KeyCode.Left&&s.keyCode!==t.KeyCode.Right&&s.keyCode!==t.KeyCode.Home&&s.keyCode!==t.KeyCode.End||(this.suppressFocusEvents=!0,this.inputElement.blur(),this.inputElement.focus(),this.suppressFocusEvents=!1))}onKeyUp(s){if(e.AndroidMobilePlatform){let e=s.key;229===s.keyCode&&(e=this.inputElement.value.substring(this.inputElement.selectionStart-1,this.inputElement.selectionStart)),this.dotnetHelper.invokeMethodAsync("KeyDown",e,s.keyCode,!1,!1)}else s.keyCode!==t.KeyCode.Up&&s.keyCode!==t.KeyCode.Down||this.customArrowsProcessing||(s.preventDefault(),this.dotnetHelper.invokeMethodAsync("KeyUp",s.keyCode))}onClick(e){this.checkValidInput()&&this.dotnetHelper.invokeMethodAsync("SetSelection",this.inputElement.selectionStart,this.inputElement.selectionEnd)}onCut(e){this.checkValidInput()&&(e.preventDefault(),document.execCommand("copy"),this.dotnetHelper.invokeMethodAsync("Clear",this.inputElement.selectionStart,this.inputElement.selectionEnd))}onPaste(e){if(!this.checkValidInput())return;e.preventDefault();const t=e.clipboardData,s=null==t?void 0:t.getData("Text");this.dotnetHelper.invokeMethodAsync("Paste",s)}onDrop(e){e.preventDefault()}onFocusByTab(e){this.dotnetHelper.invokeMethodAsync("SetSelection",0,e)}onFocusOut(e){this.checkValidInput()&&!this.suppressFocusEvents&&(this.inputElement.hasAttribute("date-process-focusout-via-component")||(e.preventDefault(),this.dotnetHelper.invokeMethodAsync("OnFocusLost",null).catch((e=>console.log(e)))))}onWheel(e,t){this.canHandleMouseWheel()&&(e.preventDefault(),this.dotnetHelper.invokeMethodAsync("OnMouseWheel",e.deltaY<0))}}const k=new Map;function E(e,t,s,i,n,o){return new Promise(((a,r)=>{let l=k.get(e);l||(l=new c(e,s,t,i),l.initializeMonoMasks(n,o).then((()=>{k.set(e,l),a()})).catch((()=>r())))}))}function y(e,t,s,i,n){if(!(e=a(e)))return;let o=k.get(e);o||(o=new m(e,t,i,n),o.initialize(s),k.set(e,o))}function v(e,t,s,i){const n=k.get(e);n&&n.setValue(t,s,i)}function g(e,t,s){const i=k.get(t);i&&i.updateMask(e,s)}function M(e,t,s,i){e&&(e.value=t,document.activeElement===e&&e.setSelectionRange(s,i))}function f(e,t){const s=k.get(e);s&&s.blockButtonsFocusEvents(t,s)}function b(e){if(e=a(e)){s(e);k.get(e)&&k.delete(e)}return Promise.resolve("ok")}const C={initMonoMasks:E,setValueToMonoMaskManager:v,initServerMasks:y,applyMaskParameters:M,updateRemoteMask:g,dispose:b},_=Object.freeze({__proto__:null,initMonoMasks:E,initServerMasks:y,setValueToMonoMaskManager:v,updateRemoteMask:g,applyMaskParameters:M,blockFocusEventsForButtons:f,dispose:b,default:C});export{l as P,_ as a,f as b,C as m};
