import{a as e}from"./_tslib-158249d5.js";import{S as t,F as s,a as n,c as i}from"./capturemanager-c228e074.js";import{v as o,B as a,p as r,d as l}from"./popuproot-4df55582.js";import{BranchActivatedEvent as d,BranchIdContext as h,BranchRefreshedEvent as c}from"./branch-6684bbdd.js";import{T as u,I as p,V as b,D as m,a as g,b as y,P as w,c as f,d as v}from"./supportcaptureelement-2f30b59b.js";import{a as I,D as S}from"./events-interseptor-b260a35a.js";import{D as E,B as C}from"./dom-9e6f7067.js";import{L as x}from"./dx-ui-element-4d613bb9.js";import{e as T,n as D}from"./property-ba1fa369.js";import{y as B,n as F}from"./lit-element-d284a100.js";import{D as R}from"./popupbasedialog-559fd684.js";import"./eventhelper-dec6cde0.js";import"./data-qa-utils-8be7c726.js";import"./rafaction-bba7928b.js";import"./layouthelper-c2462bd3.js";import"./rect-2684652a.js";import"./point-9c6ab88a.js";const k=new class{constructor(){this._shadowBranchEvent=new t,this._topShadowId=null,this.shadowSet=new Set}get shadowBranchChanged(){return this._shadowBranchEvent}register(e){this.shadowSet.add(e),this.raiseTopShadowStackChanged()}unregister(e){this.shadowSet.delete(e),this.raiseTopShadowStackChanged()}raiseTopShadowStackChanged(){const e=this.getTopShadowModal();if(this._topShadowId===e)return;this._topShadowId=e;this._shadowBranchEvent.raise({branch:e})}getTopShadowModal(){let e=-1,t="";for(const s of Array.from(this.shadowSet)){const n=o.getIndex(s);n>e&&(e=n,t=s)}return t}};const H=new class{constructor(){this.paddingCoerced=!1,this.bodyScrollTop=0,this.bodyScrollPadding="",this.scrollLocked=!1,this.scrollLockHostSet=new Set}register(e){this.scrollLockHostSet.add(e),this.updateScrollLock()}unregister(e){this.scrollLockHostSet.delete(e),this.updateScrollLock()}updateScrollLock(){this.toggleBodyScroll(document.body,this.scrollLockHostSet.size>0)}toggleBodyScroll(e,t){t!==this.scrollLocked&&(this.scrollLocked=t,this.toggleScrollPadding(e,t),E.toggleClassName(e,"modal-open",t),E.toggleClassName(e,"dxbs-modal-open",t),C.Safari&&this.toggleSafariScroll(e,t))}toggleScrollPadding(e,t){if(t){const t=window.innerWidth-e.getBoundingClientRect().width;if(0===t)return;this.paddingCoerced=!0;const s=parseInt(getComputedStyle(document.body).getPropertyValue("padding-right"),10);return this.bodyScrollPadding=document.body.style.paddingRight,void(e.style.paddingRight=`${s+t}px`)}this.paddingCoerced&&(e.style.paddingRight=this.bodyScrollPadding,this.paddingCoerced=!1)}toggleSafariScroll(e,t){t?(this.bodyScrollTop=window.pageYOffset,E.toggleClassName(e,"dx-prevent-safari-scrolling",t)):(E.toggleClassName(e,"dx-prevent-safari-scrolling",t),window.scrollTo(0,this.bodyScrollTop))}},O=["a[href]","audio[controls]","button",'[contenteditable]:not([contenteditable="false"])',"details>summary:first-of-type","details","input","select","textarea","[tabindex]","video[controls]"].join(",");class L{static getTabbables(e,t){const s=this.findTabbables(e,t),n=[],i=[];return s.forEach(((e,t)=>{const s=L.getTabIndex(e);0===s?n.push(e):i.push({index:t,tabIndex:s,item:e})})),i.sort(((e,t)=>e.tabIndex===t.tabIndex?e.index-t.index:e.tabIndex-t.tabIndex)).map((e=>e.item)).concat(n)}static findTabbables(e,t){const s=Array.from(e.querySelectorAll(O));return(t&&e.matches(O)||e.webkitMatchesSelector(O))&&s.unshift(e),s.filter(L.filterTabbable)}static filterTabbable(e){return!e.disabled&&(!L.isHiddenInput(e)&&(!L.isHidden(e)&&!(L.getTabIndex(e)<0)))}static getTabIndex(e){const t=e.getAttribute("tabindex");if(t){const e=parseInt(t,10);if(!isNaN(e))return e}return"true"===e.contentEditable||e.nodeName===u.audio||e.nodeName===u.video||e.nodeName===u.details?0:e.tabIndex}static isHiddenInput(e){return e.tagName===u.input&&e.getAttribute("type")===p.hidden}static isHidden(e){if(window.getComputedStyle(e).visibility===b.hidden)return!0;let t=e;for(;t;){if(window.getComputedStyle(e).display===m.none)return!0;t=t.parentElement}return!1}}class K{constructor(e){this.action=null,this.postponeAction=e}executePostpone(e){this.action=null,this.postponeAction()?e():this.action=e}execute(){this.action&&this.postponeAction()&&this.executeForce()}executeForce(){this.action&&this.action(),this.clear()}clear(){this.action=null}}const A=new class{constructor(){this.element=null,this.tabbables=[],this.lastFocusedElement=null,this.mutationObserver=new MutationObserver(this.handleMutations.bind(this)),this.focusPostponedAction=new K((()=>{var e,t;return null!==(t=(null===(e=this.tabbables)||void 0===e?void 0:e.length)>0)&&void 0!==t&&t})),this.documentFocusInHandler=this.documentFocusIn.bind(this),this.documentKeyDownHandler=this.documentKeyDown.bind(this),this.firstInnerElementKeyDownHandler=this.firstInnerElementKeyDown.bind(this),this.lastInnerElementKeyDownHandler=this.lastInnerElementKeyDown.bind(this),this.handleFocusOutHandler=this.handleFocusOut.bind(this),this.firstInnerElement=null,this.lastInnerElement=null}activate(e){if(this.element="string"==typeof e?document.querySelector(e):e,null===this.element)throw"element is null";this.lastFocusedElement=document.activeElement,this.subscribe(this.element),this.tabbables=L.getTabbables(this.element,!0),this.updateInnerElements(),this.subscribeInnerElementsKeyDown(),this.focusPostponedAction.executePostpone(this.forceFocusFirstElement.bind(this)),this.mutationObserver.observe(this.element,{subtree:!0,childList:!0})}deactivate(e){this.element&&(this.focusPostponedAction.clear(),this.mutationObserver.disconnect(),this.unsubscribeDocument(),this.unsubscribe(this.element),this.unsubscribeInnerElementsKeyDown(),e&&!x.containsElement(this.element,document.activeElement)&&this.lastFocusedElement&&s.restoreFocus(this.lastFocusedElement),this.element=null,this.lastFocusedElement=null)}forceFocusFirstElement(){const e=this.tabbables[0];e&&(this.lastFocusedElement&&this.element&&x.containsElement(this.element,document.activeElement)||s.restoreFocus(e))}handleMutations(e){this.tabbables=L.getTabbables(this.element,!0),this.unsubscribeInnerElementsKeyDown(),this.updateInnerElements(),this.subscribeInnerElementsKeyDown(),this.focusPostponedAction.execute()}subscribe(e){this.element.addEventListener("focusout",this.handleFocusOutHandler,!0)}unsubscribe(e){this.element.removeEventListener("focusout",this.handleFocusOutHandler,!0)}handleFocusOut(e){const t=e.relatedTarget;t?this.element.contains(t)||this.focusPostponedAction.executePostpone(this.forceFocusFirstElement.bind(this)):this.subscribeDocument()}subscribeDocument(){document.addEventListener("focusin",this.documentFocusInHandler),document.addEventListener("keydown",this.documentKeyDownHandler)}unsubscribeDocument(){document.removeEventListener("keydown",this.documentKeyDownHandler),document.removeEventListener("focusin",this.documentFocusInHandler)}documentKeyDown(e){var t;const s=e.target;if(s&&(this.element===s||(null===(t=this.element)||void 0===t?void 0:t.contains(s))))return;const n=this.element;n&&n.processKeyDown(e)}documentFocusIn(e){const t=e.target;if(!t)return;this.unsubscribeDocument();const s=e.relatedTarget;(s||this.element.contains(t))&&(!s||this.element.contains(s))||this.focusPostponedAction.executePostpone(this.forceFocusFirstElement.bind(this))}firstInnerElementKeyDown(e){var t;this.firstInnerElement===document.activeElement&&"Tab"===e.key&&e.shiftKey&&(e.preventDefault(),null===(t=this.lastInnerElement)||void 0===t||t.focus({preventScroll:!1}))}lastInnerElementKeyDown(e){var t;this.lastInnerElement!==document.activeElement||"Tab"!==e.key||e.shiftKey||(e.preventDefault(),null===(t=this.firstInnerElement)||void 0===t||t.focus({preventScroll:!1}))}unsubscribeInnerElementsKeyDown(){var e,t;null===(e=this.firstInnerElement)||void 0===e||e.removeEventListener("keydown",this.firstInnerElementKeyDownHandler),null===(t=this.lastInnerElement)||void 0===t||t.removeEventListener("keydown",this.lastInnerElementKeyDownHandler)}subscribeInnerElementsKeyDown(){var e,t;null===(e=this.firstInnerElement)||void 0===e||e.addEventListener("keydown",this.firstInnerElementKeyDownHandler),null===(t=this.lastInnerElement)||void 0===t||t.addEventListener("keydown",this.lastInnerElementKeyDownHandler)}updateInnerElements(){this.tabbables&&(this.firstInnerElement=this.tabbables[0],this.lastInnerElement=this.tabbables[this.tabbables.length-1])}};let P=class extends g{constructor(){super(...arguments),this._positionChangedEvent=new n,this.shadowSlotChangedHandler=this.handleShadowSlotChange.bind(this),this.topShadowBranchChangedHandler=this.handleTopShadowBranchChanged.bind(this),this.bridgeSlotChangedHandler=this.handleBridgeSlotChange.bind(this),this.shadow=null,this.closingResultRequestedTcs=new y,this.popupDialog=null,this._zIndex=0,this.modal=null,this._interceptor=null,this.shadingChangedEvent=new t,this._isOpen=!1,this.shading=!1,this.closeOnOutsideClick=!1,this.closeOnEscape=!1,this.autoZIndex=!1,this.manualZIndex=0,this.shadowVisible=!1,this.topShadowBranchId=null,this.hasServerSideClosing=!1,this.disableFocusTrap=!1}get positionChanged(){return this._positionChangedEvent}get renderedVisible(){return!0}get isOpen(){return this._isOpen}get branchType(){return a.Modal}get preventInteractions(){return!0}render(){return B`
            <dxbl-branch
                id="branch"
                branch-id="${this.branchId}"
                type="${this.branchType}">
                ${this.renderShadow()}
                ${this.renderDefaultSlot()}
                ${this.renderBridgeSlot()}
            </dxbl-branch>
        `}renderDefaultSlot(){return B`<slot></slot>`}renderShadow(){return B`<slot name="shadow" @slotchange="${this.shadowSlotChangedHandler}"></slot>`}renderBridgeSlot(){return B`
            <slot name="bridge" @slotchange=${this.bridgeSlotChangedHandler}></slot>
        `}get zindex(){return this._zIndex}set zindex(e){e!==this._zIndex&&(this._zIndex=e,this.applyZIndexToModal())}handleShadowSlotChange(e){const t=e.target.assignedNodes();this.shadow=t.find((e=>e instanceof HTMLElement))}get shadingChanged(){return this.shadingChangedEvent}connectedCallback(){super.connectedCallback(),this.subscribeToEvents()}disconnectedCallback(){super.disconnectedCallback(),this.unsubscribeFromEvents(),this.close()}show(){this.isOpen||(this._isOpen=!0,this.initializeCapture(),this.initializeBodyScrollLock(),this.addToVisibleBranchTree())}close(){this.isOpen&&(this._isOpen=!1,this.releaseCapture(),this.releaseBodyScrollLock(),this.removeFromVisibleBranchTree())}willUpdate(e){this.shadowVisible=this.shading&&this.isOpen&&!!this.branchId&&this.branchId===this.topShadowBranchId}updated(e){this.shadow&&e.has("shadowVisible")&&(this.shadow.style.display=this.shadowVisible?m.block:m.none),e.has("manualZIndex")&&(this.style.zIndex=this.autoZIndex?"":String(this.manualZIndex))}ensureBranchId(){if(!this.branchId)throw new Error("branchId should not be null")}addToVisibleBranchTree(){this.ensureBranchId(),o.register(this.branchId),k.register(this.branchId),this.raiseBranchRefreshed()}removeFromVisibleBranchTree(){this.ensureBranchId(),o.unregister(this.branchId),k.unregister(this.branchId),this.raiseBranchRefreshed()}initializeBodyScrollLock(){H.register(this.branchId)}releaseBodyScrollLock(){H.unregister(this.branchId)}subscribeToEvents(){k.shadowBranchChanged.subscribe(this.topShadowBranchChangedHandler)}unsubscribeFromEvents(){k.shadowBranchChanged.unsubscribe(this.topShadowBranchChangedHandler)}handleTopShadowBranchChanged(e){this.topShadowBranchId=e.branch}initializeCapture(){i.capture(this)}releaseCapture(){this.processClosingRequested(!0),i.releaseCapture(this)}processClosingRequested(e){this.closingResultRequestedTcs.resolve(e),this.closingResultRequestedTcs=new y}applyZIndexToModal(){this.modal&&(this.modal.style.zIndex=this.zindex.toString(10))}notifyDialogConnected(e){this.popupDialog=e,this.initializeFocusTrap()}notifyDialogDisconnected(){this.popupDialog=null,this.initializeFocusTrap()}gotCapture(){super.gotCapture(),this.activate(),this.initializeFocusTrap()}lostCapture(){super.lostCapture(),this.releaseFocusTrap()}initializeFocusTrap(){this.isOpen&&this.popupDialog&&!this.disableFocusTrap&&A.activate(this.popupDialog)}releaseFocusTrap(){A.deactivate(!this.isOpen)}activate(){const e=new d(new h(this.branchId));this.dispatchEvent(e)}notifyCloseCanceled(){this.processClosingRequested(!1)}async processCapturedPointerDownAsync(e,t){t.handled||w.containsInComposedPath(e,this.popupDialog)||(t.nextInteractionHandled=!0,await f.processCapturedPointerDown(this,e,t))}async processCapturedKeyDownAsync(e,t){t.handled||this.closeOnEscape&&"Escape"===e.key&&await this.processEscape(e,t)}async processEscape(e,t){const s=await this.raiseClosingResultRequestedAsync(v.EscapePress);this.closingResultRequestedTcs=new y,s||(t.handled=!0)}async closeAsync(e,t){const s=await this.raiseClosingResultRequestedAsync(t);return this.closingResultRequestedTcs=new y,e.nextInteractionHandled=!0,e.handled=!0,Promise.resolve(!!s)}async closeHierarchyAsync(e,t,s){for(const e of o.iterateBranch(this.branchId)){const n=r.getPopup(e);await(null==n?void 0:n.closeAsync(t,s))}await this.closeAsync(t,s)}async raiseClosingResultRequestedAsync(e){if(!this.hasServerSideClosing)return this.raiseClosingRequested(e),!0;const t=new y;return this.closingResultRequestedTcs=t,this.raiseClosingResultRequested(e),t.promise}raiseClosingRequested(e){this.raiseEvent("closingRequested",{closeReason:e})}raiseClosingResultRequested(e){this.raiseEvent("closingResultRequested",{closeReason:e})}raiseEvent(e,t){var s;null===(s=this._interceptor)||void 0===s||s.raise(e,t)}handleBridgeSlotChange(e){const t=e.target.assignedNodes();this._interceptor=t.find((e=>e instanceof I))}raiseBranchRefreshed(){const e=new c(new h(this.branchId));this.dispatchEvent(e)}};e([T({type:Boolean,attribute:"x-is-open",reflect:!0,converter:{fromAttribute:(e,t)=>{throw new Error("readonly")}}})],P.prototype,"_isOpen",void 0),e([T({type:Boolean,attribute:"shading"})],P.prototype,"shading",void 0),e([T({type:Boolean,attribute:"close-on-outside-click"})],P.prototype,"closeOnOutsideClick",void 0),e([T({type:Boolean,attribute:"close-on-escape"})],P.prototype,"closeOnEscape",void 0),e([T({type:Boolean,attribute:"auto-z-index"})],P.prototype,"autoZIndex",void 0),e([T({type:Number,attribute:"manual-z-index"})],P.prototype,"manualZIndex",void 0),e([T({type:String,attribute:"branch-id"})],P.prototype,"branchId",void 0),e([T({reflect:!1})],P.prototype,"shadowVisible",void 0),e([T({reflect:!1})],P.prototype,"topShadowBranchId",void 0),e([T({type:Boolean,attribute:"has-serverside-closing"})],P.prototype,"hasServerSideClosing",void 0),e([T({type:Boolean,attribute:"disable-focus-trap"})],P.prototype,"disableFocusTrap",void 0),P=e([D("dxbl-modal")],P);let q=class extends R{constructor(){super(...arguments),this.popup=null}connectedCallback(){super.connectedCallback(),this.popup=this.closest("dxbl-modal"),this.popup.notifyDialogConnected(this)}disconnectedCallback(){var e;super.disconnectedCallback(),null===(e=this.popup)||void 0===e||e.notifyDialogDisconnected(),this.popup=null}};q=e([D("dxbl-modal-dialog")],q);let _=class extends F{constructor(){super(...arguments),this.slotChangedHandler=this.handleSlotChange.bind(this)}render(){return B`
            <slot @slotchange=${this.slotChangedHandler}></slot>
        `}handleSlotChange(e){const t=e.target.assignedNodes().find((e=>e instanceof q)),s=this.closest("dxbl-modal");s&&(t?s.notifyDialogConnected(t):s.notifyDialogDisconnected())}};_=e([D("dxbl-modal-root")],_);const z=["dxbl-modal-dialog","dxbl-modal","dxbl-modal-root",l,S];function j(e){return e}const N={getReference:j,registeredComponents:z};export{N as default,j as getReference,z as registeredComponents};
