import{D as e,H as t,T as i,P as n,a as s,b as o,c as r,d as l}from"./dx-html-element-base-75114249.js";import{DxUIHandlersBridgeTagName as a}from"./dx-ui-handlers-bridge-4076ae57.js";import{B as d}from"./dom-9e6f7067.js";import{k as h}from"./key-b2db12a3.js";import{T as c}from"./transformhelper-3935ca6a.js";import{C as u}from"./component-isolate-styles-builder-76197efd.js";import{S as m}from"./dx-scroll-viewer-cd865df2.js";import"./data-qa-utils-8be7c726.js";import"./_tslib-158249d5.js";class g{}g.ClassName="dxbs-grid",g.DataTableClassName=g.ClassName+"-table",g.GroupPanelContentContainerClassName=g.ClassName+"-group-panel-content-container",g.EmptyHeaderCellContentContainerClassName=g.ClassName+"-empty-header",g.GroupContentFreeSpaceClassName=g.ClassName+"-group-content-free-space",g.HeaderRowClassName=g.ClassName+"-header-row",g.FilterRowClassName=g.ClassName+"-filter-row",g.GroupRowClassName=g.ClassName+"-group-row",g.FooterRowClassName=g.ClassName+"-footer-row",g.EmptyFooterRowClassName=g.ClassName+"-empty-footer-row",g.PagerRowClassName=g.ClassName+"-pager-row",g.HeaderElementClassName=g.ClassName+"-header",g.HeaderContentClassName=g.ClassName+"-header-content",g.AllowDragClassName=g.ClassName+"-action",g.DraggableHeaderClassName=g.ClassName+"-draggable-header",g.SelectionCellClassName=g.ClassName+"-selection-cell",g.CommandCellClassName=g.ClassName+"-command-cell",g.SelectedRowClassName=g.ClassName+"-selected-row",g.TouchSelectionClassName=g.ClassName+"-touch-selection",g.TouchSelectionEdgeClassName=g.ClassName+"-touch-selection-edge",g.MoveCursorCssClassName=g.ClassName+"-move-cursor",g.DraggingDownTargetClassName=g.ClassName+"-dragging-down-target",g.DraggingUpTargetClassName=g.ClassName+"-dragging-up-target",g.CardContainerClassName="card",g.ScrollViewerClassName="dxbs-scroll-viewer",g.ScrollViewerContentClassName="dxbs-scroll-viewer-content",g.ColumnsResizeAnchorClassName="dxbs-grid-column-resize-anchor",g.ColumnResizeTouchAnchorClassName="dxbs-grid-column-resize-touch-anchor",g.ColumnsSeparatorClassName="dxbs-grid-columns-separator",g.HiddenEmptyCellClassName="dxbs-grid-hidden-empty-cell";class C{constructor(e,t,i,n,s,o,r){this._uID=e,this._allowSort=t,this._allowGroup=i,this._width=n,this._minWidth=s,this._isIndent=o,this._isEmpty=r,this._firstRenderWidth=0,this._currentWidth=0,this._changedWidth=0}get uID(){return this._uID}get allowSort(){return this._allowSort}get allowGroup(){return this._allowGroup}get minWidth(){return this._minWidth}get isFixed(){return!!this._width}get isIndent(){return this._isIndent}get isEmpty(){return this._isEmpty}get isFree(){return!(this.changedWidth||this.width||this.isIndent||this.isEmpty)}get isPercent(){return!this.changedWidth&&!!this.width&&-1!==this.width.indexOf("%")}get width(){return this._width}set width(e){this._width=e}get firstRenderWidth(){return this._firstRenderWidth}set firstRenderWidth(e){this._firstRenderWidth=e}get currentWidth(){return this._currentWidth}set currentWidth(e){this._currentWidth=e}get changedWidth(){return this._changedWidth}set changedWidth(e){this._changedWidth=e}correctWidthByMinValue(){return this.currentWidth<this.minWidth&&(this.changedWidth=this.minWidth,!0)}distributeExcess(e){let t=this.currentWidth-e;return t<this.minWidth&&(t=this.minWidth),this.changedWidth=t,this.currentWidth-t}getPercents(){return this.isPercent?parseFloat(this.width.replace("%","")):0}}class b{constructor(e){this.columnsTotalPercents=0,this.columnsTotalPercentsWidth=0,this.columnsTotalFreeWidth=0,this.columnResizeController=e}initialize(){this.columnsTotalPercents=0,this.columnsTotalPercentsWidth=0,this.columnsTotalFreeWidth=0;for(let e=0;e<this.columnResizeController.columnsInfo.length;e++){const t=this.columnResizeController.columnsInfo[e],i=this.columnResizeController.getHeaderCellWidth(e);this.columnsTotalPercents+=t.getPercents(),t.isPercent?this.columnsTotalPercentsWidth+=i:t.isFree&&(this.columnsTotalFreeWidth+=i)}}getAllResizedColumns(e,t){const i=[];return this.calculateResizedColumns(i,e,t),t&&!i.includes(t.column)&&this.calculateResizedColumns(i,t,null),i}calculateResizedColumns(e,t,i){this.columnResizeController.isNextColumnResizeMode?t.column.isPercent?this.calculateResizedPercentColumns(e,t,i):t.column.isFree&&0===this.columnsTotalPercents?this.calculateResizedFreeColumns(e,t,i):this.calculateResizedColumn(e,t):this.calculateResizedColumn(e,t)}calculateResizedPercentColumns(e,t,i){if(null!==i&&i.column.isPercent)t.column.width=`${this.calculateNewPercent(t)}%`,i.column.width=`${this.calculateNewPercent(i)}%`,e.push(t.column,i.column);else{const i=this.calculateNewPercent(t);this.columnsTotalPercents<100===this.columnsTotalPercents-t.column.getPercents()+i<100?(t.column.width=`${i}%`,e.push(t.column)):this.calculateAllPercentColumns(e,t)}}calculateAllPercentColumns(e,t){const i=(this.columnsTotalPercentsWidth-t.initWidth+t.currentWidth)/this.columnsTotalPercents;for(let n=0;n<this.columnResizeController.columnsInfo.length;n++){const s=this.columnResizeController.columnsInfo[n],o=this.columnResizeController.getHeaderCellWidth(n);s.isPercent&&(s.width=s.uID===t.column.uID?t.currentWidth/i+"%":o/i+"%",e.push(s))}}calculateResizedFreeColumns(e,t,i){i&&i.column.isFree||(this.columnsTotalFreeWidth=this.columnsTotalFreeWidth-t.initWidth+t.currentWidth);for(let n=0;n<this.columnResizeController.columnsInfo.length;n++){const s=this.columnResizeController.columnsInfo[n],o=this.columnResizeController.getHeaderCellWidth(n);if(s.isFree){let n=o;s.uID===t.column.uID&&(n=t.currentWidth),s.uID===(null==i?void 0:i.column.uID)&&(n=i.currentWidth),s.width=100*n/this.columnsTotalFreeWidth+"%",e.push(s)}}}calculateResizedColumn(e,t){t.column.width=`${t.currentWidth}px`,e.push(t.column)}calculateNewPercent(e){return e.column.getPercents()*e.currentWidth/e.initWidth}}class p{constructor(e,t,i){this._column=e,this._currentWidth=t,this._initWidth=i}get column(){return this._column}get currentWidth(){return this._currentWidth}get initWidth(){return this._initWidth}}var v;!function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(v||(v={}));class E{constructor(e){this.columnIndex=-1,this.startMousePosition=-1,this.startElementPosition=-1,this.initWidth=-1,this.initNextWidth=-1,this.currentWidth=-1,this.currentNextWidth=-1,this.timeoutId=null,this.isColumnWidthsFixed=!1,this.fixedColumnWidths=[],this.columnWidthsBeforeFixed=[],this.boundOnDocumentMouseMoveHandler=this.onDocumentMouseMove.bind(this),this.grid=e,this.columnsCalculator=new b(this)}get columnsInfo(){return this.grid.columnsInfo}get isNextColumnResizeMode(){return this.grid.isNextColumnResizeMode}get moveStep(){const e=Math.ceil((this.initWidth+(this.isNextColumnResizeMode?this.initNextWidth:this.initWidth))/100);return Math.min(e,5)}get columnInfo(){return this.columnsInfo[this.columnIndex]}get nextColumnInfo(){return this.columnsInfo[this.columnIndex+1]}initialize(){this.columnResizeSeparator=this.grid.getColumnResizeSeparator()}isDragStarted(){return this.startMousePosition>-1}isFocused(){return-1!==this.columnIndex}focus(e){this.initializeResizing(e),this.needToFixColumnWidthsInPixels()&&this.fixColumnWidthsInPixels()}unfocus(){this.finalizeResizing()}startDrag(e,t){this.initializeResizing(e),this.startMousePosition=t,this.startElementPosition=this.getHeaderCellPosition(this.columnIndex),document.addEventListener("pointermove",this.boundOnDocumentMouseMoveHandler),document.body.classList.add("dxbs-resize-cursor"),this.needToFixColumnWidthsInPixels()&&this.fixColumnWidthsInPixels()}stopDrag(){const e=new p(this.columnInfo,this.currentWidth,this.initWidth),t=this.isNextColumnResizeMode?new p(this.nextColumnInfo,this.currentNextWidth,this.initNextWidth):null;this.notifyColumnWidthsChanged(e,t),this.finalizeDragging()}cancelDrag(){this.cancelResize(),this.finalizeDragging()}resizeByMousePosition(e){const t=this.getHeaderCellPosition(this.columnIndex);this.resize(e-this.startMousePosition+this.startElementPosition-t)}performMoveStep(e){if(this.isDragStarted())return;let t=e===v.Right?this.moveStep:-this.moveStep;t+=this.currentWidth-this.initWidth,this.resize(t),this.timeoutId&&clearTimeout(this.timeoutId)}stopMove(){const e=new p(this.columnInfo,this.currentWidth,this.initWidth),t=this.isNextColumnResizeMode?new p(this.nextColumnInfo,this.currentNextWidth,this.initNextWidth):null;this.timeoutId=setTimeout((()=>this.notifyColumnWidthsChanged(e,t)),500)}getHeaderCellWidth(e){const t=this.getHeaderCell(e);return t&&t.getBoundingClientRect().width||0}onDocumentMouseMove(e){this.resizeByMousePosition(e.pageX)}initializeResizing(e){var t;this.columnIndex=e,this.initializeWidths();const i=this.getHeaderCell(e);i&&(null===(t=this.columnResizeSeparator)||void 0===t||t.show(i))}finalizeResizing(){var e;null===(e=this.columnResizeSeparator)||void 0===e||e.hide(),this.columnIndex=-1,this.clearWidths()}finalizeDragging(){this.startMousePosition=-1,this.startElementPosition=-1,document.removeEventListener("pointermove",this.boundOnDocumentMouseMoveHandler),document.body.classList.remove("dxbs-resize-cursor"),this.finalizeResizing()}initializeWidths(){this.initWidth=this.currentWidth=this.getHeaderCellWidth(this.columnIndex),this.isNextColumnResizeMode&&(this.initNextWidth=this.getHeaderCellWidth(this.columnIndex+1)),this.columnsCalculator.initialize()}clearWidths(){this.initWidth=-1,this.initNextWidth=-1,this.currentWidth=-1,this.currentNextWidth=-1}fixColumnWidthsInPixels(){this.columnWidthsBeforeFixed=[];const e=this.grid.getColElements();for(let t=0;t<this.grid.columnsInfo.length;t++){this.allowResize(this.grid.columnsInfo[t])&&(this.fixedColumnWidths.push(`${this.getHeaderCellWidth(t)}px`),this.columnWidthsBeforeFixed.push(e[t].style.width))}for(let t=0;t<this.grid.columnsInfo.length;t++){const i=this.grid.columnsInfo[t];this.allowResize(i)&&(e[t].style.width=this.fixedColumnWidths[t]),i.isEmpty&&e[t].classList.remove(g.HiddenEmptyCellClassName)}}resize(e){var t;const i=this.getNewWidth(e);i!==this.currentWidth&&(this.currentWidth=i,this.isNextColumnResizeMode&&(this.currentNextWidth=this.initWidth+this.initNextWidth-i),requestAnimationFrame((()=>this.updateColElements(this.currentWidth,this.currentNextWidth))),null===(t=this.columnResizeSeparator)||void 0===t||t.render())}cancelResize(){if(this.isNextColumnResizeMode||this.isColumnWidthsFixed)this.currentWidth=this.initWidth,this.currentNextWidth=this.initNextWidth,this.updateColElements(this.currentWidth,this.currentNextWidth);else{const e=this.grid.getColElements();for(let t=0;t<this.grid.columnsInfo.length;t++){const i=this.grid.columnsInfo[t];this.allowResize(i)&&(e[t].style.width=this.columnWidthsBeforeFixed[t]),i.isEmpty&&e[t].classList.add(g.HiddenEmptyCellClassName)}}}getNewWidth(e){const t=this.initWidth+e;if(t<this.columnInfo.minWidth)return this.columnInfo.minWidth;if(this.isNextColumnResizeMode){const e=this.initWidth+this.initNextWidth-this.nextColumnInfo.minWidth;if(t>e)return e}return t}updateColElements(e,t){const i=this.getColElement(this.columnIndex),n=this.isNextColumnResizeMode?this.getColElement(this.columnIndex+1):null;i&&(i.style.width=`${e}px`),n&&(n.style.width=`${t}px`)}notifyColumnWidthsChanged(e,t){let i=this.columnsCalculator.getAllResizedColumns(e,t);this.isNextColumnResizeMode||this.isColumnWidthsFixed||(i=i.concat(this.getFixedColumns(e)));const n=i.map((e=>e.uID)),s=i.map((e=>e.width));this.grid.onColumnWidthsChanged(n,s),this.isNextColumnResizeMode||(this.isColumnWidthsFixed=!0)}getFixedColumns(e){const t=[];for(let i=0;i<this.grid.columnsInfo.length;i++){const n=this.grid.columnsInfo[i];this.allowResize(n)&&n.uID!==e.column.uID&&(n.width=this.fixedColumnWidths[i],t.push(n))}return t}getHeaderCell(e){const t=this.grid.getHeaderRow();return t?t.cells.item(e):null}getHeaderCellPosition(e){const t=this.getHeaderCell(e);return t&&t.getBoundingClientRect().x||0}getColElement(e){return this.grid.getColElements()[e]}needToFixColumnWidthsInPixels(){return!this.isNextColumnResizeMode&&!this.isColumnWidthsFixed}allowResize(e){return!e.isIndent&&!e.isEmpty}}class x extends e{constructor(){super(),this.cell=null,this.parentWidth=0,this.tableContainerResizeObserver=new ResizeObserver(this.onTableContainerSizeChanged.bind(this)),this.boundOnTableContainerScroll=this.onTableContainerScroll.bind(this)}get tableContainer(){return this._tableContainer}initializeComponent(){super.initializeComponent(),this.initializeTableContainer(),this.tableContainer.addEventListener("scroll",this.boundOnTableContainerScroll),this.tableContainerResizeObserver.observe(this.tableContainer)}initializeTableContainer(){this._tableContainer=this.closest(`.${g.ScrollViewerContentClassName}`)}disposeComponent(){super.disposeComponent(),this.tableContainer.removeEventListener("scroll",this.boundOnTableContainerScroll),this.tableContainerResizeObserver.unobserve(this.tableContainer)}show(e){this.cell=e,this.classList.add(x.ActiveColumnResizeSeparator),this.render()}hide(){this.cell=null,this.classList.remove(x.ActiveColumnResizeSeparator),this.style.transform="none"}render(){requestAnimationFrame((()=>{if(!this.cell)return;const e=this.getColumnSeparatorPosition(this.cell),t=x.getCenteredByBorderPosition(e,this.offsetWidth),i=this.getActualHeight();this.style.transform=`translateX(${t})`,i>0&&(this.style.height=`${i}px`)}))}onTableContainerScroll(){this.render()}onTableContainerSizeChanged(e){const t=e[0].contentRect.width;this.parentWidth!==t&&(this.parentWidth=t,this.render())}getColumnSeparatorPosition(e){return e.offsetLeft+e.offsetWidth-this.tableContainer.scrollLeft}getActualHeight(){const e=this.tableContainer.querySelector(`.${g.DataTableClassName} > tfoot`);if(!e)return 0;const t=e.getBoundingClientRect().height;return this.tableContainer.getBoundingClientRect().height-t}static getCenteredByBorderPosition(e,t){return`calc(${e}px - (${t}px - var(--dx-grid-table-border-left-width)) / 2)`}}x.ActiveColumnResizeSeparator="active";class f{static getSvgHtml(e){return`\n<svg class="dx-image" role="img">\n    <use href="_content/DevExpress.Blazor/dx-blazor.svg#${e}"></use>\n</svg>`}}f.ArrowUpIconName="dx-arrow-up";var w,S,R;!function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(w||(w={}));class y{constructor(){this.downTargetElement=y.addTargetToDom(g.DraggingDownTargetClassName),this.upTargetElement=y.addTargetToDom(g.DraggingUpTargetClassName);const e=this.upTargetElement.getBoundingClientRect();this.targetElementSize={width:e.width,height:e.height},this.upTargetElementPosition=null,this.downTargetElementPosition=null,this.hide()}show(){this.upTargetElementPosition&&this.downTargetElementPosition&&(this.downTargetElement.style.transform=c.translateByPoint(this.downTargetElementPosition),this.upTargetElement.style.transform=c.translateByPoint(this.upTargetElementPosition),this.downTargetElement.classList.remove("d-none"),this.upTargetElement.classList.remove("d-none"))}hide(){this.downTargetElement.classList.add("d-none"),this.upTargetElement.classList.add("d-none")}setPositionRelativeToElement(e,t){this.setUpTargetPosition(e,t),this.setDownTargetPosition(e,t)}setUpTargetPosition(e,t){this.upTargetElementPosition={x:this.getTargetXCoordinate(e,t),y:e.y+e.height}}setDownTargetPosition(e,t){this.downTargetElementPosition={x:this.getTargetXCoordinate(e,t),y:e.y-this.targetElementSize.height}}getTargetXCoordinate(e,t){let i=e.x-this.targetElementSize.width/2;return t===w.Right&&(i+=e.width),i}dispose(){y.removeElementsByClassName(g.DraggingDownTargetClassName),y.removeElementsByClassName(g.DraggingUpTargetClassName)}static removeElementsByClassName(e){const t=document.querySelectorAll(`.${e}`);for(let e=0;e<t.length;e++)t[e].remove()}static addTargetToDom(e){const t=document.createElement("div");return t.className=e,t.innerHTML=f.getSvgHtml(f.ArrowUpIconName),document.body.appendChild(t),t}}!function(e){e[e.Header=0]="Header",e[e.GroupPanel=1]="GroupPanel"}(S||(S={}));class D{constructor(e){this.boundOnDocumentMouseMoveHandler=this.onDocumentMouseMove.bind(this),this.boundOnDocumentScrollHandler=this.onDocumentScroll.bind(this),this.boundOnHeaderMouseMoveHandler=this.onHeaderMouseMove.bind(this),this.boundOnElementMouseOutHandler=this.onElementMouseOut.bind(this),this.boundOnGroupPanelMouseMoveHandler=this.onGroupPanelMouseMove.bind(this),this.boundOnEmptyHeaderCellMouseMoveHandler=this.onEmptyHeaderCellMouseMove.bind(this),this.boundOnGroupFreeSpaceMouseMoveHandler=this.onGroupFreeSpaceMouseMove.bind(this),this.draggableContext=null,this.isRefreshUIRequested=!1,this.grid=e}start(e,t){const i=D.addDraggableHeaderToDOM(e);this.draggableContext=this.createDraggableContext(e,i,t),this.addEventSubscriptions(),this.updateDraggableElement(t)}stop(){var e;this.isRefreshUIRequested=!1,null===(e=this.draggableContext)||void 0===e||e.targets.dispose(),this.draggableContext=null,D.removeDraggableHeaderFromDom(),this.removeEventSubscriptions(),document.body.classList.remove(g.MoveCursorCssClassName)}isStarted(){return!!this.draggableContext}updateDraggableContextByEvent(e){const t=document.elementFromPoint(e.pageX,e.pageY);this.updateDraggableContextByElement(t,e)}onDocumentMouseMove(e){this.updateDraggableElement(e)}onDocumentScroll(e){this.draggableContext&&(this.draggableContext.currentScrollPosition=D.getDocumentScrollPosition(),this.draggableContext.srcHeaderPosition=D.getElementPosition(this.draggableContext.srcHeaderElement),this.draggableContext.mouseOverElement&&this.setMouseOverElementInfo(this.draggableContext.mouseOverElement),this.updateDraggableElementPosition(),this.refreshUI())}onHeaderMouseMove(e){this.updateDraggableContextByElement(e.target,e)}onElementMouseOut(e){this.clearMoveStateFromDraggableContext(),this.refreshUI()}onGroupPanelMouseMove(){const e=this.grid.getGroupPanelContentContainer();this.onPanelElementMouseMove(e,S.GroupPanel)}onEmptyHeaderCellMouseMove(){const e=this.grid.getEmptyHeaderCellContentContainer();this.onPanelElementMouseMove(e,S.Header)}onGroupFreeSpaceMouseMove(){const e=this.grid.getGroupContentFreeSpaceElement();this.onPanelElementMouseMove(e,S.GroupPanel)}updateDraggableElement(e){this.draggableContext&&(this.draggableContext.currentCursorPosition={x:e.pageX,y:e.pageY},this.draggableContext.initialScrollPosition=this.draggableContext.currentScrollPosition,this.updateDraggableElementPosition(),this.refreshUI())}onPanelElementMouseMove(e,t){e&&this.draggableContext&&this.draggableContext.mouseOverElement!==e&&this.draggableContext.srcHeaderElement!==e.previousElementSibling&&(this.clearMoveStateFromDraggableContext(),this.setMouseOverElementInfo(e),this.draggableContext.dropArea=t,this.isPossibleDropToCurrentArea()&&(this.draggableContext.isPossibleDropColumn=!0,this.draggableContext.targets.setPositionRelativeToElement(this.draggableContext.mouseOverElementRect,w.Left)),this.refreshUI())}isPossibleDropToCurrentArea(){var e,t,i;return(null===(e=this.draggableContext)||void 0===e?void 0:e.allowGroup)||(null===(t=this.draggableContext)||void 0===t?void 0:t.dropArea)===(null===(i=this.draggableContext)||void 0===i?void 0:i.srcArea)}createColumnDraggedHandlerArgs(){if(!this.draggableContext||!this.draggableContext.isPossibleDropColumn)return null;const e=this.draggableContext;return{columnUid:e.columnUid,beforeColumnUid:e.beforeColumnUid,dropArea:e.dropArea}}updateDraggableContextByElement(e,t){const i=this.grid.findHeaderElement(e);i&&(this.updateDraggableContext(i,t),this.refreshUI())}updateDraggableContext(e,t){if(this.clearMoveStateFromDraggableContext(),null!=this.draggableContext&&this.draggableContext.srcHeaderElement!==e&&(this.setMouseOverElementInfo(e),this.isPossibleDropToCurrentArea())){const i=this.isThereCursorInLeftPart(t);if(i&&e.previousElementSibling!==this.draggableContext.srcHeaderElement&&(this.draggableContext.beforeColumnUid=this.grid.getColumnUID(e),this.draggableContext.isPossibleDropColumn=!0),!i&&e.nextElementSibling!==this.draggableContext.srcHeaderElement){const t=e.nextElementSibling;t&&(this.draggableContext.beforeColumnUid=this.grid.getColumnUID(t)),this.draggableContext.isPossibleDropColumn=!0}this.draggableContext.isPossibleDropColumn&&this.draggableContext.targets.setPositionRelativeToElement(this.draggableContext.mouseOverElementRect,i?w.Left:w.Right)}}getDropColumnArea(e){const t=this.grid.getGroupPanelContentContainer();return t&&D.isThereHeaderInsideGroupPanel(t,e)?S.GroupPanel:S.Header}static isThereHeaderInsideGroupPanel(e,t){const i=e.childNodes.length;for(let n=0;n<i;n++)if(e.childNodes[n]===t)return!0;return!1}refreshUI(){this.isRefreshUIRequested||(this.isRefreshUIRequested=!0,requestAnimationFrame((()=>{this.isRefreshUIRequested=!1;const e=this.draggableContext;e&&(e.headerElement.style.transform=`translate(${Math.round(e.draggableElementPosition.x)}px, ${Math.round(e.draggableElementPosition.y)}px)`,e.headerElement.classList.add("visible"),e.isPossibleDropColumn?e.targets.show():e.targets.hide(),document.body.classList.add(g.MoveCursorCssClassName))})))}setMouseOverElementInfo(e){if(!this.draggableContext)return;this.draggableContext.mouseOverElement=e;const t=e.getBoundingClientRect();if(this.draggableContext.mouseOverElementRect={x:t.left+this.draggableContext.currentScrollPosition.x,y:t.top+this.draggableContext.currentScrollPosition.y,width:t.width,height:t.height},this.draggableContext.scrollViewerRect){const e=this.draggableContext.scrollViewerRect;this.draggableContext.mouseOverElementRect.x<e.x&&(this.draggableContext.mouseOverElementRect.x=e.x),this.draggableContext.mouseOverElementRect.x+this.draggableContext.mouseOverElementRect.width>e.x+e.width&&(this.draggableContext.mouseOverElementRect.width=e.x+e.width-this.draggableContext.mouseOverElementRect.x)}this.draggableContext.dropArea=this.getDropColumnArea(e)}isThereCursorInLeftPart(e){if(!this.draggableContext||!this.draggableContext.mouseOverElementRect)return!1;const t=this.draggableContext.mouseOverElementRect;return e.pageX<t.x+t.width/2}updateDraggableElementPosition(){if(!this.draggableContext)return;const e=this.draggableContext;e.draggableElementPosition={x:e.srcHeaderPosition.x+(e.currentCursorPosition.x-e.initialCursorPosition.x)+(e.currentScrollPosition.x-e.initialScrollPosition.x)+e.currentScrollPosition.x,y:e.srcHeaderPosition.y+(e.currentCursorPosition.y-e.initialCursorPosition.y)+(e.currentScrollPosition.y-e.initialScrollPosition.y)+e.currentScrollPosition.y}}addEventSubscriptions(){document.addEventListener("pointermove",this.boundOnDocumentMouseMoveHandler),document.addEventListener("scroll",this.boundOnDocumentScrollHandler),this.addHeaderEventSubscriptions(),this.addGroupPanelEventSubscriptions(),this.addEmptyHeaderCellEventSubscriptions(),this.addGroupContentFreeSpaceElementEventSubscriptions()}addHeaderEventSubscriptions(){const e=this.grid.getHeaderCells();for(let t=0;t<e.length;t++){const i=e[t];i.addEventListener("pointermove",this.boundOnHeaderMouseMoveHandler),i.addEventListener("pointerout",this.boundOnElementMouseOutHandler)}}addEmptyHeaderCellEventSubscriptions(){const e=this.grid.getEmptyHeaderCellContentContainer();e&&this.addPanelElementEventSubscriptions(e,this.boundOnEmptyHeaderCellMouseMoveHandler)}addGroupPanelEventSubscriptions(){if(!this.shouldAddEventListenersToGroupPanel())return;const e=this.grid.getGroupPanelContentContainer();this.addPanelElementEventSubscriptions(e,this.boundOnGroupPanelMouseMoveHandler)}addGroupContentFreeSpaceElementEventSubscriptions(){const e=this.grid.getGroupContentFreeSpaceElement();e&&this.addPanelElementEventSubscriptions(e,this.boundOnGroupFreeSpaceMouseMoveHandler)}addPanelElementEventSubscriptions(e,t){e.addEventListener("pointermove",t),e.addEventListener("pointerout",this.boundOnElementMouseOutHandler)}removeEventSubscriptions(){document.removeEventListener("pointermove",this.boundOnDocumentMouseMoveHandler),document.removeEventListener("scroll",this.boundOnDocumentScrollHandler),this.removeHeaderEventSubscriptions(),this.removeGroupPanelEventSubscriptions(),this.removeEmptyHeaderCellEventSubscriptions(),this.removeGroupContentFreeSpaceElementEventSubscriptions()}removeHeaderEventSubscriptions(){const e=this.grid.getHeaderCells();for(let t=0;t<e.length;t++){const i=e[t];i.removeEventListener("pointermove",this.boundOnHeaderMouseMoveHandler),i.removeEventListener("pointerout",this.boundOnElementMouseOutHandler)}}removeGroupPanelEventSubscriptions(){if(!this.shouldAddEventListenersToGroupPanel())return;const e=this.grid.getGroupPanelContentContainer();this.removePanelElementEventSubscriptions(e,this.boundOnGroupPanelMouseMoveHandler)}removeEmptyHeaderCellEventSubscriptions(){const e=this.grid.getEmptyHeaderCellContentContainer();e&&this.removePanelElementEventSubscriptions(e,this.boundOnEmptyHeaderCellMouseMoveHandler)}removeGroupContentFreeSpaceElementEventSubscriptions(){const e=this.grid.getGroupContentFreeSpaceElement();e&&this.removePanelElementEventSubscriptions(e,this.boundOnGroupFreeSpaceMouseMoveHandler)}removePanelElementEventSubscriptions(e,t){e.removeEventListener("pointermove",t),e.removeEventListener("pointerout",this.boundOnElementMouseOutHandler)}shouldAddEventListenersToGroupPanel(){const e=this.grid.getGroupPanelContentContainer();return!!e&&!(null==e?void 0:e.querySelector(`.${g.HeaderElementClassName}`))}static addDraggableHeaderToDOM(e){const t=document.createElement("div");t.className=`card ${g.DraggableHeaderClassName}`,e.classList.contains(g.SelectionCellClassName)&&t.classList.add(g.SelectionCellClassName),e.classList.contains(g.CommandCellClassName)&&t.classList.add(g.CommandCellClassName),t.style.width=`${e.clientWidth}px`,t.style.height=`${e.clientHeight}px`;const i=getComputedStyle(e);t.style.padding=i.padding,t.style.font=i.font;const n=this.getContentElement(e).cloneNode(!0);return t.appendChild(n),document.body.appendChild(t),t}static getContentElement(e){return e.querySelector(`.${g.HeaderContentClassName}`)}static removeDraggableHeaderFromDom(){const e=document.querySelectorAll(`.${g.DraggableHeaderClassName}`);for(let t=0;t<e.length;t++)e[t].remove()}createDraggableContext(e,t,i){const n=D.getDocumentScrollPosition(),s=D.getPointerPosition(i),o=this.grid.getScrollViewer();return{srcHeaderPosition:D.getElementPosition(e),srcHeaderElement:e,headerElement:t,allowGroup:this.grid.canGroupByColumn(e),mouseOverElement:null,mouseOverElementRect:null,scrollViewerRect:o&&o.getRectangle(),isPossibleDropColumn:!1,columnUid:this.grid.getColumnUID(e),beforeColumnUid:null,srcArea:e.closest(`.${g.GroupPanelContentContainerClassName}`)?S.GroupPanel:S.Header,dropArea:S.Header,initialCursorPosition:s,currentCursorPosition:{x:0,y:0},draggableElementPosition:s,initialScrollPosition:n,currentScrollPosition:n,targets:new y}}clearMoveStateFromDraggableContext(){this.draggableContext&&(this.draggableContext.mouseOverElement=null,this.draggableContext.mouseOverElementRect=null,this.draggableContext.isPossibleDropColumn=!1,this.draggableContext.beforeColumnUid=null)}static getPointerPosition(e){return{x:e.pageX,y:e.pageY}}static getDocumentScrollPosition(){return{x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop}}static getElementPosition(e){const{left:t,top:i}=e.getBoundingClientRect();return{x:t,y:i}}}class H{constructor(e){this._startSelectionRowIndex=-1,this._endSelectionRowIndex=-1,this.savedSelectedRows=[],this.boundOnRowPointerEnterHandler=this.onRowPointerEnter.bind(this),this.grid=e}get startSelectionRowIndex(){return this._startSelectionRowIndex}get endSelectionRowIndex(){return this._endSelectionRowIndex}start(e,t){this._startSelectionRowIndex=this.grid.getRowVisibleIndexByTarget(e),this._startSelectionRowIndex>-1&&(this._endSelectionRowIndex=this._startSelectionRowIndex,t&&this.storeSelectedRows(),this.addRowEventSubscriptions(),this.updateRowsSelection())}stop(){this._startSelectionRowIndex>-1&&(this.deselectRows(),this.removeRowEventSubscriptions(),this.restoreSelectedRows(),this._startSelectionRowIndex=-1,this._endSelectionRowIndex=-1)}isStarted(){return this._startSelectionRowIndex>-1&&this._endSelectionRowIndex>-1}updateSeletionByEvent(e){const t=document.elementFromPoint(e.pageX,e.pageY);this.updateSeletionByElement(t)}findRowElement(e){return this.grid.getMainElement().querySelector(`tr[data-visible-index="${e}"]`)}findRowElements(){return this.grid.getMainElement().querySelectorAll("tr[data-visible-index]")}findSelectedRowElements(){return this.grid.getMainElement().querySelectorAll(`tr.${g.SelectedRowClassName}[data-visible-index]`)}addRowEventSubscriptions(){const e=this.findRowElements();if(e)for(let t=0;t<e.length;t++)e[t].addEventListener("pointerenter",this.boundOnRowPointerEnterHandler)}removeRowEventSubscriptions(){const e=this.findRowElements();if(e)for(let t=0;t<e.length;t++)e[t].removeEventListener("pointerenter",this.boundOnRowPointerEnterHandler)}updateSeletionByElement(e){this._endSelectionRowIndex=this.grid.getRowVisibleIndexByTarget(e,!0),this.updateRowsSelection()}onRowPointerEnter(e){this.updateSeletionByElement(e.target)}selectRows(e){for(let t=0;t<e.length;t++){const i=this.findRowElement(e[t]);i&&i.classList.add(0===t||t===e.length-1?g.TouchSelectionEdgeClassName:g.TouchSelectionClassName)}}deselectRows(){const e=this.findRowElements();if(e)for(let t=0;t<e.length;t++)e[t].classList.remove(g.TouchSelectionClassName,g.TouchSelectionEdgeClassName)}updateRowsSelection(){if(-1===this.startSelectionRowIndex||-1===this.endSelectionRowIndex)return;this.deselectRows();const e=Math.min(this.startSelectionRowIndex,this.endSelectionRowIndex),t=Math.max(this.startSelectionRowIndex,this.endSelectionRowIndex),i=Array.from({length:t-e+1},((t,i)=>i+e));this.selectRows(i)}storeSelectedRows(){const e=this.findSelectedRowElements();if(e)for(let t=0;t<e.length;t++)e[t].classList.remove(g.SelectedRowClassName),this.savedSelectedRows.push(e[t])}restoreSelectedRows(){for(let e=0;e<this.savedSelectedRows.length;e++)this.savedSelectedRows[e].classList.add(g.SelectedRowClassName);this.savedSelectedRows=[]}}!function(e){e[e.ColumnsChanged=0]="ColumnsChanged",e[e.DataTableResize=1]="DataTableResize"}(R||(R={}));class P{constructor(e){this.grid=e,this.freeColumnIndices=[],this.percentColumnIndeces=[],this.totalAbsoluteWidth=0,this.totalPercentWidth=0,this.totalPercents=0,this.freeCoumnsCount=0,this.excess=0}get totalWidth(){let e=0;for(let t=0;t<this.columnsInfo.length;t++){const i=this.columnsInfo[t];e+=i.changedWidth?i.changedWidth:i.currentWidth}return e}get columnsInfo(){return this.grid.columnsInfo}correctWidths(e){return 0!==this.columnsInfo.length&&(requestAnimationFrame((()=>{const t=this.grid.getColElements();this.resetColumnWidths(t,e),this.collectInfo(e),this.distributeExcess(),this.applyChangedWidths(t,e)})),!0)}resetColumnWidths(e,t){for(let i=0;i<e.length;i++)i<this.columnsInfo.length&&!this.columnsInfo[i].isIndent&&!this.columnsInfo[i].isEmpty&&(this.columnsInfo[i].changedWidth=0,t===R.ColumnsChanged&&this.repairStyle(e[i],i))}collectInfo(e){this.clearInfo(e),e===R.ColumnsChanged&&this.getCurrentWidths(),e===R.DataTableResize&&this.calculateCurrentWidths();for(let e=0;e<this.columnsInfo.length;e++){const t=this.columnsInfo[e];t.isIndent||t.isEmpty||(t.correctWidthByMinValue()&&(this.excess+=t.changedWidth-t.currentWidth),t.isFree&&this.freeColumnIndices.push(e),t.isPercent&&(this.totalPercentWidth+=t.currentWidth,this.percentColumnIndeces.push(e)))}}clearInfo(e){this.freeColumnIndices=[],this.percentColumnIndeces=[],this.totalPercentWidth=0,this.excess=0,e===R.ColumnsChanged&&(this.totalAbsoluteWidth=0,this.freeCoumnsCount=0,this.totalPercents=0)}getCurrentWidths(){const e=this.grid.getHeaderRow();if(!e)return;const t=e.cells;if(t.length&&(1!==t.length||!t[0].classList.contains(g.EmptyHeaderCellContentContainerClassName)))for(let e=0;e<this.columnsInfo.length;e++){const i=this.columnsInfo[e];i.currentWidth=i.firstRenderWidth=t[e].getBoundingClientRect().width,i.isPercent?this.totalPercents+=i.getPercents():i.isFixed||i.isIndent?this.totalAbsoluteWidth+=i.firstRenderWidth:i.isFree&&(this.freeCoumnsCount+=1)}}calculateCurrentWidths(){const e=this.grid.getTableContainerWidth(),t=this.totalAbsoluteWidth;let i=e*this.totalPercents/100;i>e-t&&(i=Math.max(0,e-t));const n=Math.max(0,e-t-i);for(let e=0;e<this.columnsInfo.length;e++){const t=this.columnsInfo[e];t.isPercent?t.currentWidth=i*t.getPercents()/this.totalPercents:t.isFixed||t.isIndent?t.currentWidth=t.firstRenderWidth:t.isFree?t.currentWidth=n/this.freeCoumnsCount:t.isEmpty&&(t.currentWidth=n)}}distributeExcess(){if(this.excess>0){this.sortIndices(this.freeColumnIndices,0),this.distributeExcessToFreeColumns();const e=this.columnsInfo[this.columnsInfo.length-1];e.isEmpty&&(this.excess-=e.currentWidth),this.excess>0&&(this.sortIndices(this.percentColumnIndeces,this.excess/this.totalPercentWidth),this.distributeExcessToPercentColumns())}}sortIndices(e,t){e.sort(((e,i)=>{const n=this.columnsInfo[e],s=this.columnsInfo[i];return s.currentWidth-s.minWidth-s.currentWidth*t-(n.currentWidth-n.minWidth-n.currentWidth*t)>0?-1:1}))}distributeExcessToFreeColumns(){for(let e=0;e<this.freeColumnIndices.length;e++){this.excess-=this.columnsInfo[this.freeColumnIndices[e]].distributeExcess(this.excess/(this.freeColumnIndices.length-e))}}distributeExcessToPercentColumns(){for(let e=0;e<this.percentColumnIndeces.length;e++){const t=this.columnsInfo[this.percentColumnIndeces[e]];this.excess-=t.distributeExcess(this.excess*t.currentWidth/this.totalPercentWidth),this.totalPercentWidth-=t.currentWidth}}applyChangedWidths(e,t){for(let i=0;i<this.columnsInfo.length;i++){const n=this.columnsInfo[i].changedWidth;n?e[i].style.width=`${n}px`:t===R.DataTableResize&&this.repairStyle(e[i],i)}}repairStyle(e,t){e.style.width=this.columnsInfo[t].isFixed?this.columnsInfo[t].width:""}}class W extends u{constructor(e){super(),this.cardElement=e}buildStyleSheetCore(){const e=this.getBackgroundColorByElement(this.cardElement),t=this.getTableBorderWidth("border-bottom-width"),i=this.getTableBorderWidth("border-left-width");return`\n::slotted(div.card) {\n    ${this.getContainerColorVarDeclaration(e)}\n    ${this.getHeaderColorVarDeclaration(e)}\n    ${this.getGroupFooterColorVarDeclaration(e)}\n    ${this.getFooterColorVarDeclaration(e)}\n    ${this.getSelectionColorVarDeclaration(e)}\n    ${this.getTouchColorVarDeclaration(e)}\n    ${this.getTableBorderBottomWidthVarDeclaration(t)}\n    ${this.getTableBorderLeftWidthVarDeclaration(i)}\n}\n`}getBorderWidthByElement(e,t){if(!e)return 1;const i=getComputedStyle(e),n=i.getPropertyValue(t);return parseFloat(n)||parseFloat(i.borderWidth)}getTableBorderWidth(e){return this.getElementValue((e=>{e.className="table table-bordered",e.innerHTML="<tr><td></td></tr>"}),(t=>{let i=this.getBorderWidthByElement(t,e);return i||(i=this.getBorderWidthByElement(t.querySelector("tr"),e)),i||(i=this.getBorderWidthByElement(t.querySelector("td"),e)),i}),"table")}getContainerColorVarDeclaration(e){return this.getLightMixedColorVarDeclaration("--dx-grid-container-color",e,0)}getHeaderColorVarDeclaration(e){return this.useBlackMixColor(e)?this.getBlackMixedColorVarDeclaration("--dx-grid-header-color",e,.2):this.getLightMixedColorVarDeclaration("--dx-grid-header-color",e,.5)}getGroupFooterColorVarDeclaration(e){return this.useBlackMixColor(e)?this.getBlackMixedColorVarDeclaration("--dx-grid-group-footer-color",e,.1):this.getLightMixedColorVarDeclaration("--dx-grid-group-footer-color",e,.2)}getFooterColorVarDeclaration(e){return this.useBlackMixColor(e)?this.getBlackMixedColorVarDeclaration("--dx-grid-footer-color",e,.12):this.getLightMixedColorVarDeclaration("--dx-grid-footer-color",e,.5)}getSelectionColorVarDeclaration(e){return this.useBlackMixColor(e)?this.getBlackMixedColorVarDeclaration("--dx-grid-selection-color",e,.25):this.getLightMixedColorVarDeclaration("--dx-grid-selection-color",e,.95)}getTouchColorVarDeclaration(e){return this.useBlackMixColor(e)?this.getBlackMixedColorVarDeclaration("--dx-grid-touch-color",e,.5):this.getDarkMixedColorVarDeclaration("--dx-grid-touch-color",e,.15)}getTableBorderBottomWidthVarDeclaration(e){return`--dx-grid-table-border-bottom-width: ${e}px;`}getTableBorderLeftWidthVarDeclaration(e){return`--dx-grid-table-border-left-width: ${e}px;`}getLightMixedColorVarDeclaration(e,t,i){return u.getMixedColorVarDeclaration(e,t,this.lightColor,i)}getDarkMixedColorVarDeclaration(e,t,i){return u.getMixedColorVarDeclaration(e,t,this.darkColor,i)}getBlackMixedColorVarDeclaration(e,t,i){return u.getMixedColorVarDeclaration(e,t,0,i)}}const I=document.createElement("template");I.innerHTML="\n<style></style>\n<slot />";const M="dxbl-grid",N=["button","input","select","a","label"],z=["dxbs-grid-empty-cell","dxbs-grid-indent-cell","dxbs-grid-expand-group-cell"];class T extends e{constructor(){var e;super(),this._columnsInfo=[],this._allowSelectRowByClick=!1,this._enableMultiSelect=!1,this._hasRowClickEvent=!1,this._hasRowDblClickEvent=!1,this._isNextColumnResizeMode=!1,this.boundOnDragStartHandler=this.onDragStart.bind(this),this.boundOnDragStopHandler=this.onDragStop.bind(this),this.boundOnDragCancelHandler=this.onDragCancel.bind(this),this.boundOnClickHandler=this.onClick.bind(this),this.boundOnDblClickHandler=this.onDblClick.bind(this),this.boundOnDocumentKeyDownHandler=this.onDocumentKeyDown.bind(this),this.boundOnCellPointerOverHandler=this.onCellPointerOver.bind(this),this.draggingHelper=new D(this),this.columnWidthsController=new P(this),this.columnResizeController=new E(this),this.selectionHelper=new H(this),this.resizeDataTableObserver=new ResizeObserver(this.onDataTableSizeChanged.bind(this)),this.isolatedStyleElement=null===(e=this.shadowRoot)||void 0===e?void 0:e.querySelector("style"),this.isInitResize=!0,this.isHoverableDevice=!1}initializeComponent(){super.initializeComponent(),this.isHoverableDevice=class{static isHoverableDevice(){return window.matchMedia("(hover: hover) and (pointer: fine)").matches}}.isHoverableDevice(),this.uiHandlersBridge=this.querySelector(a),this.columnResizeController.initialize(),this.buildIsolateStyles(),this.addEventSubscriptions();const e=this.getDataTable();e&&this.resizeDataTableObserver.observe(e)}disposeComponent(){this.removeEventSubscriptions();const e=this.getDataTable();e&&this.resizeDataTableObserver.unobserve(e),delete this.uiHandlersBridge,super.disposeComponent()}getMainElement(){return this}getDataTable(){return this.querySelector(`.${g.DataTableClassName}`)}getHeaderRow(){return this.querySelector(`thead > tr.${g.HeaderRowClassName}`)}getFilterRow(){return this.querySelector(`thead > tr.${g.FilterRowClassName}`)}getHeaderCells(){return this.querySelectorAll(`.${g.HeaderElementClassName}`)}getGroupPanelContentContainer(){return this.querySelector(`.${g.GroupPanelContentContainerClassName}`)}getEmptyHeaderCellContentContainer(){return this.querySelector(`.${g.EmptyHeaderCellContentContainerClassName}`)}getGroupContentFreeSpaceElement(){return this.querySelector(`.${g.GroupContentFreeSpaceClassName}`)}getColElements(){return this.querySelectorAll("col")}getFooterRow(){return this.querySelector(`.${g.FooterRowClassName}`)}getCardContainer(){return this.querySelector(`.${g.CardContainerClassName}`)}getPagerRow(){return this.querySelector(`.${g.PagerRowClassName}`)}getScrollViewer(){return this.querySelector(`.${g.ScrollViewerClassName}`)}getTableContainerWidth(){const e=this.querySelector(`.${g.ScrollViewerContentClassName}`);return null==e?void 0:e.getBoundingClientRect().width}getColumnResizeSeparator(){return this.querySelector(`.${g.ColumnsSeparatorClassName}`)}addEventSubscriptions(){this.addEventListener(n.eventName,this.boundOnDragStartHandler),this.addEventListener(s.eventName,this.boundOnDragStopHandler),this.addEventListener(o.eventName,this.boundOnDragCancelHandler),this.addEventListener(r.eventName,this.boundOnClickHandler),this.addEventListener(l.eventName,this.boundOnDblClickHandler),document.addEventListener("keydown",this.boundOnDocumentKeyDownHandler),this.isHoverableDevice&&this.addEventListener("pointerover",this.boundOnCellPointerOverHandler)}removeEventSubscriptions(){this.removeEventListener(n.eventName,this.boundOnDragStartHandler),this.removeEventListener(s.eventName,this.boundOnDragStopHandler),this.removeEventListener(o.eventName,this.boundOnDragCancelHandler),this.removeEventListener(r.eventName,this.boundOnClickHandler),this.removeEventListener(l.eventName,this.boundOnDblClickHandler),document.removeEventListener("keydown",this.boundOnDocumentKeyDownHandler),this.isHoverableDevice&&this.removeEventListener("pointerover",this.boundOnCellPointerOverHandler)}onDragStart(e){var t,i,n;const s=e.target,o=e.detail.source;if(this.isResizeAnchor(s)){const e=this.findHeaderElement(s),i=this.getElementIndex(e);this.columnResizeController.startDrag(i,o.pageX),null===(t=this.getScrollViewer())||void 0===t||t.startAutoScrolling(m.Horizontal,(e=>this.columnResizeController.resizeByMousePosition(e.pageX)))}else if(this.isHeaderContentElement(s)){const e=this.findHeaderElement(s);e&&(this.draggingHelper.start(e,o),null===(i=this.getScrollViewer())||void 0===i||i.startAutoScrolling(m.Horizontal,(e=>this.draggingHelper.updateDraggableContextByEvent(e))))}else this.selectionHelper.start(o.target,!o.ctrlKey&&!o.metaKey&&!e.detail.isLongTap),null===(n=this.getScrollViewer())||void 0===n||n.startAutoScrolling(m.Vertical,(e=>this.selectionHelper.updateSeletionByEvent(e)),(e=>{const t=this.getDataTable();if(t){const i=t.querySelector("thead");i&&(e.y+=i.offsetHeight,e.height-=i.offsetHeight);const n=t.querySelector("tfoot");n&&(e.height-=n.offsetHeight)}}))}onDragStop(e){var t;if(this.columnResizeController.isDragStarted())this.columnResizeController.stopDrag();else if(this.draggingHelper.isStarted())this.onColumnHeaderDragged(),this.draggingHelper.stop();else if(this.selectionHelper.isStarted()){if(this.uiHandlersBridge&&this.selectionHelper.startSelectionRowIndex>-1&&this.selectionHelper.endSelectionRowIndex>-1){this.uiHandlersBridge.send("rowDragged",{startVisibleIndex:this.selectionHelper.startSelectionRowIndex,endVisibleIndex:this.selectionHelper.endSelectionRowIndex,cleanSelection:!e.detail.source.ctrlKey&&!e.detail.source.metaKey&&!e.detail.isLongTap})}this.selectionHelper.stop()}null===(t=this.getScrollViewer())||void 0===t||t.stopAutoScrolling()}onDragCancel(e){var t;this.columnResizeController.isDragStarted()?this.columnResizeController.cancelDrag():this.draggingHelper.isStarted()?this.draggingHelper.stop():this.selectionHelper.isStarted()&&this.selectionHelper.stop(),null===(t=this.getScrollViewer())||void 0===t||t.stopAutoScrolling()}onClick(e){const t=e.target;if("dxbl-grid-header-content"!==t.tagName.toLowerCase()||this.isResizeAnchor(t)){const t={columnUid:-1},i=this.getRowVisibleIndexByTarget(e.detail.source.target,!1,t);if(this.uiHandlersBridge&&i>-1){this.uiHandlersBridge.send("rowClicked",{visibleIndex:i,columnUid:t.columnUid,ctrlKey:e.detail.source.ctrlKey||e.detail.source.metaKey,shiftKey:e.detail.source.shiftKey})}}else{const t=this.findHeaderElement(e.target);t&&(this.canSortByColumn(t)?this.onColumnHeaderClicked(t,e.detail.source.ctrlKey||e.detail.source.metaKey,e.detail.source.shiftKey):e.detail.isTouch&&t.click())}}onDblClick(e){const t={columnUid:-1},i=this.getRowVisibleIndexByTarget(e.detail.source.target,!1,t);if(this.uiHandlersBridge&&i>-1){this.uiHandlersBridge.send("rowDblClicked",{visibleIndex:i,columnUid:t.columnUid,ctrlKey:e.detail.source.ctrlKey||e.detail.source.metaKey,shiftKey:e.detail.source.shiftKey})}}getRowVisibleIndexByTarget(e,t,i){let n=e,s=e;for(;n&&n!==this&&(t||!this.isElementIgnoredByRowClick(n));){if("tr"===n.tagName.toLowerCase()&&n.dataset.visibleIndex)return i&&s&&s!==n&&!n.classList.contains(g.GroupRowClassName)&&(i.columnUid=this.getColumnUID(s)),parseInt(n.dataset.visibleIndex);s=n,n=n.parentElement}return-1}isElementIgnoredByRowClick(e){if(N.indexOf(e.tagName.toLowerCase())>-1)return!0;for(let t=0;t<z.length;t++)if(e.classList.contains(z[t]))return!0;return!1}get allowSelectRowByClick(){return this._allowSelectRowByClick}set allowSelectRowByClick(e){this._allowSelectRowByClick=e,this.updateHandlePointerEventsMode()}get enableMultiSelect(){return this._enableMultiSelect}set enableMultiSelect(e){this._enableMultiSelect=e,this.updateHandlePointerEventsMode()}get hasRowClickEvent(){return this._hasRowClickEvent}set hasRowClickEvent(e){this._hasRowClickEvent=e,this.updateHandlePointerEventsMode()}get hasRowDblClickEvent(){return this._hasRowDblClickEvent}set hasRowDblClickEvent(e){this._hasRowDblClickEvent=e,this.updateHandlePointerEventsMode()}get isNextColumnResizeMode(){return this._isNextColumnResizeMode}set isNextColumnResizeMode(e){this._isNextColumnResizeMode=e}get columnsInfo(){return this._columnsInfo}updateHandlePointerEventsMode(){this.handlePointerEventsMode=t.None,this.hasRowClickEvent&&(this.handlePointerEventsMode|=t.Click),this.hasRowDblClickEvent&&(this.handlePointerEventsMode|=t.DblClick),this.allowSelectRowByClick&&(this.handlePointerEventsMode|=t.Click,this.enableMultiSelect&&d.TouchUI&&(this.handlePointerEventsMode|=t.Dragging))}notifyColumnsInitialized(e){this._columnsInfo=e}notifyColumnsChanged(e){this._columnsInfo=e,this.correctWidths(R.ColumnsChanged)}notifyColumnResizeAnchorFocus(e){const t=this.findHeaderElement(e),i=this.getElementIndex(t);this.columnResizeController.focus(i)}notifyColumnResizeAnchorBlur(){this.columnResizeController.unfocus()}notifyColumnResizeAnchorMove(e){this.columnResizeController.performMoveStep(e)}notifyColumnResizeAnchorStopMove(){this.columnResizeController.stopMove()}correctWidths(e){if(this.columnResizeController.isDragStarted()||this.columnResizeController.isFocused())return;this.columnWidthsController.correctWidths(e);const t=this.getScrollViewer();t&&t.refreshUI&&t.refreshUI()}getElementIndex(e){if(!e)return-1;if(e instanceof HTMLTableCellElement)return e.cellIndex;if(e&&e.parentElement)for(let t=0;t<e.parentElement.children.length;t++)if(e.parentElement.children[t]===e)return t;return-1}getColumnsInfo(e){const t=this.getElementIndex(e);return 0<=t&&t<this.columnsInfo.length?this.columnsInfo[t]:null}getColumnUID(e){const t=this.getColumnsInfo(e);return t?t.uID:-1}canSortByColumn(e){const t=this.getColumnsInfo(e);return!!t&&t.allowSort}canGroupByColumn(e){const t=this.getColumnsInfo(e);return!!t&&t.allowGroup}findHeaderElement(e){const t=e;return t?this.isHeaderElement(t)?t:t.closest(`.${g.HeaderElementClassName}`):null}isHeaderElement(e){return e&&e.classList.contains(g.HeaderElementClassName)}isHeaderContentElement(e){return"dxbl-grid-header-content"===e.tagName.toLowerCase()}isResizeAnchor(e){return e.classList.contains(g.ColumnsResizeAnchorClassName)}onDocumentKeyDown(e){if("Enter"===e.key||" "===e.key){const t=this.findHeaderElement(e.target);t&&this.onColumnHeaderClicked(t,e.ctrlKey||e.metaKey,e.shiftKey)}}onCellPointerOver(e){const t=e.target;!t||t.getAttribute("title")&&!t.hasAttribute(T.TextTrimmedAttributeName)||(t.offsetWidth<t.scrollWidth?(t.setAttribute("title",t.innerText),t.setAttribute(T.TextTrimmedAttributeName,"")):(t.removeAttribute("title"),t.removeAttribute(T.TextTrimmedAttributeName)))}onColumnHeaderDragged(){const e=this.draggingHelper.createColumnDraggedHandlerArgs();e&&this.uiHandlersBridge&&this.uiHandlersBridge.send("columnHeaderDragged",e)}onColumnHeaderClicked(e,t,i){const n={columnUid:this.getColumnUID(e),ctrlKey:t,shiftKey:i};this.uiHandlersBridge&&this.uiHandlersBridge.send("columnHeaderClicked",n)}onColumnWidthsChanged(e,t){this.uiHandlersBridge&&this.uiHandlersBridge.send("columnWidthsChanged",{columnUids:e,widths:t})}onDataTableSizeChanged(e){if(this.isInitResize)this.isInitResize=!1;else{e[0].contentRect.width!==this.columnWidthsController.totalWidth&&this.correctWidths(R.DataTableResize)}}getContentTemplate(){return I}buildIsolateStyles(){const e=this.getCardContainer();if(e){new W(e).buildStyleSheet(this.isolatedStyleElement)}}static get observedAttributes(){return["allow-select-row-by-click","enable-multi-select","has-row-click-event","has-row-dbl-click-event","is-next-column-resize-mode"]}attributeChangedCallback(e,t,i){switch(e){case"allow-select-row-by-click":this.allowSelectRowByClick=null!==i;break;case"enable-multi-select":this.enableMultiSelect=null!==i;break;case"has-row-click-event":this.hasRowClickEvent=null!==i;break;case"has-row-dbl-click-event":this.hasRowDblClickEvent=null!==i;break;case"is-next-column-resize-mode":this.isNextColumnResizeMode=null!==i}}}T.TextTrimmedAttributeName="text-trimmed",customElements.define("dxbl-grid",T),customElements.define("dxbl-grid-header-content",class extends e{constructor(){super(),this.handlePointerEventsMode=t.Click|t.Dragging}get handlePointerEventsTarget(){return this.closest(`.${g.HeaderElementClassName}`)}get handlePointerEventsDelay(){return i}}),customElements.define("dxbl-grid-columns-info",class extends e{constructor(){super()}get data(){return this.getAttribute("data")}get columns(){return null!==this.data?this.parseColumns(this.data):[]}initializeComponent(){super.initializeComponent(),this.grid=this.closest(`.${g.ClassName}`),this.grid.notifyColumnsChanged(this.columns),this.grid.notifyColumnsInitialized(this.columns)}parseColumns(e){const t=JSON.parse(e),i=[];for(let e=0;e<t.length;e++){const n=new C(t[e].UID,t[e].AllowSort,t[e].AllowGroup,t[e].Width,t[e].MinWidth,t[e].IsIndent,t[e].IsEmpty);i.push(n)}return i}static get observedAttributes(){return["data"]}attributeChangedCallback(e,t,i){var n;null===(n=this.grid)||void 0===n||n.notifyColumnsChanged(this.parseColumns(i))}}),customElements.define("dxbl-column-resize-anchor",class extends e{constructor(){super(),this.boundOnAnchorFocusHandler=this.onAnchorFocus.bind(this),this.boundOnAnchorBlurHandler=this.onAnchorBlur.bind(this),this.boundOnKeyDownHandler=this.onKeyDown.bind(this),this.boundOnKeyUpHandler=this.onKeyUp.bind(this),this.handlePointerEventsMode=t.Click|t.Dragging}get handlePointerEventsDelay(){return i}initializeComponent(){var e,t,i,n;super.initializeComponent(),d.TouchUI&&this.classList.add(g.ColumnResizeTouchAnchorClassName),this.grid=this.closest(`.${g.ClassName}`),this.focusableElement=this.querySelector("div"),null===(e=this.focusableElement)||void 0===e||e.addEventListener("focus",this.boundOnAnchorFocusHandler),null===(t=this.focusableElement)||void 0===t||t.addEventListener("blur",this.boundOnAnchorBlurHandler),null===(i=this.focusableElement)||void 0===i||i.addEventListener("keydown",this.boundOnKeyDownHandler),null===(n=this.focusableElement)||void 0===n||n.addEventListener("keyup",this.boundOnKeyUpHandler)}disposeComponent(){var e,t,i,n;super.disposeComponent(),null===(e=this.focusableElement)||void 0===e||e.removeEventListener("focus",this.boundOnAnchorFocusHandler),null===(t=this.focusableElement)||void 0===t||t.removeEventListener("blur",this.boundOnAnchorBlurHandler),null===(i=this.focusableElement)||void 0===i||i.removeEventListener("keydown",this.boundOnKeyDownHandler),null===(n=this.focusableElement)||void 0===n||n.removeEventListener("keyup",this.boundOnKeyUpHandler)}onAnchorFocus(e){var t;null===(t=this.grid)||void 0===t||t.notifyColumnResizeAnchorFocus(e.target)}onAnchorBlur(){var e;null===(e=this.grid)||void 0===e||e.notifyColumnResizeAnchorBlur()}onKeyDown(e){var t,i;e.keyCode===h.KeyCode.Left&&(e.preventDefault(),null===(t=this.grid)||void 0===t||t.notifyColumnResizeAnchorMove(v.Left)),e.keyCode===h.KeyCode.Right&&(e.preventDefault(),null===(i=this.grid)||void 0===i||i.notifyColumnResizeAnchorMove(v.Right))}onKeyUp(e){var t;e.keyCode!==h.KeyCode.Left&&e.keyCode!==h.KeyCode.Right||null===(t=this.grid)||void 0===t||t.notifyColumnResizeAnchorStopMove()}}),customElements.define("dxbl-column-resize-separator",x);const O={loadModule:function(){}};export{T as DxGrid,M as DxGridTagName,O as default};
