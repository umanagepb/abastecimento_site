import{e,c as t,D as o}from"./dom-utils-728879e5.js";import{D as n}from"./dom-9e6f7067.js";import{r as i,d as r}from"./disposable-d2c2d283.js";import{setupTooltip as s,hideTooltip as c}from"./tooltip-fd2e4f4b.js";var a;function l(e,t,o){var n;const i=e.querySelectorAll(".dx-chart-legend-item");for(let e=0;e<i.length;e++){const r=i[e];if(r){const e=+(null!==(n=r.getAttribute("data-series"))&&void 0!==n?n:""),i=r.getAttribute("data-point");d(r,t,e,i,o)}}}function d(e,t,o,i,r){if(!e)return;const s=u(t,o,i);if(!s)return;const c=e.querySelector(".dx-chart-legend-icon");if(c){const e=s.getColor();n.hasClassName(c,"dx-chart-def-icon")&&(c.style.backgroundColor=e),c.style.color=e}h(e,t,o,i,["mouseover","focusin"],(function(e){const o=t.option("legend.hoverMode");r===a.series?e.hover(o):"includepoints"===o&&e.hover()})),h(e,t,o,i,["mouseout","focusout"],(function(e){e.clearHover()}))}function u(e,t,o){const n=e.getSeriesByPos(t);return o?n.getPoints().filter((function(e){return e.tag===o}))[0]:n}function h(e,t,o,n,r,s){r.forEach((function(r){const c=function(){const e=u(t,o,n);e&&s(e)};e.addEventListener(r,c),i(e,(()=>{e.removeEventListener(r,c)}))}))}!function(e){e[e.series=0]="series",e[e.point=1]="point"}(a||(a={}));class p{constructor(e,t,o){this._disposed=!1,this._widget=this.createRelatedWidget(e,t,o),this._chartElement=p.getChartElement(e)}get chartElement(){return this._chartElement}set chartElement(e){this._chartElement=e}get widget(){return this._widget}get disposed(){return this._disposed}static getChartElement(e){return e.querySelector(".dx-chart")}async createRelatedWidget(e,t,o){const n=await import("./devexpress-394524a9.js");return n.viz.localization.locale(t.locale),new Promise((i=>{try{const r=p.getChartElement(e),s=this.createWidgetBuilder(n,r,t,i);this.proceedWithPalette(e,t,o,s)}catch(e){console.error(e.name+":"+e.message)}}))}async proceedWithPalette(e,i,r,s){if(i.palette)s(this.completeChartOptions(e,i,r,i.palette));else{const c=["bg-primary","bg-success","bg-danger","bg-warning","bg-info"],a=document.createElement("DIV");a.className="d-none position-absolute";for(let e=0;e<c.length;e++){const t=document.createElement("DIV");t.className=c[e],a.appendChild(t)}t((()=>{e.appendChild(a),o((()=>{const o=[];for(let e=0;e<a.childNodes.length;e++)o.push(n.getCurrentStyle(a.childNodes[e]).backgroundColor);t((()=>{e.removeChild(a),s(this.completeChartOptions(e,i,r,o))}))}))}))}}completeChartOptions(e,t,o,n){const i={animation:t.animation,tooltip:t.tooltip,dataSource:t.dataSource,palette:n,resolveLabelOverlapping:t.resolveLabelOverlapping,dataPrepareSettings:{sortingMethod:!1},adaptiveLayout:{width:0,height:0},seriesTemplate:{nameField:"seriesId",customizeSeries:function(e){return t.series.filter((function(t){return t.seriesId===e}))[0]}},customizeLabel:function(e){return e.data.pointLabel},customizePoint:function(e){return e.data.pointAppearance},legend:{visible:!1,hoverMode:(t.legend?t.legend.hoverMode:null)||"includepoints"},onPointClick:function(e){const t=e.target;o.invokeMethodAsync("OnPointClickAsync",t.data,t.tag,t.series.index)},pathModified:!1};if(t.tooltip&&t.tooltip.enabled){s(i,t.tooltip,o);const n=e.querySelector(".dx-chart-legend");n&&n.addEventListener("mouseover",(function(){c(e,!0)}))}else i.tooltip={enabled:!1,forceEvents:!1};return i}dispose(){this._disposed=!0}update(e,t,o){this.widget.then((n=>{this.proceedWithPalette(o,e,t,(function(e){e.animation={enabled:!1},n.option(e)}))})).catch((e=>console.error(e)))}}const g=new Map;function m(e){const t=g.get(e);return void 0===t?Promise.reject():t.widget}function f(e,t,o,n){return new Promise(((i,r)=>{const s=g.get(e);void 0===s||s.chartElement!==p.getChartElement(e)?g.set(e,n(e,t,o)):s.disposed||s.update(t,o,e),i()}))}function v(e,t,o,n){m(e).then((function(e){const i=u(e,t,o);n?i.show():i.hide()})).catch((e=>console.error(e)))}function b(e){m(e).then((function(e){e.render()})).catch((e=>console.error(e)))}function C(t){if(!(t=e(t)))return;const o=t.querySelectorAll(".dx-chart-legend-item");for(let e=0;e<o.length;e++){const t=o[e];t&&r(t)}return function(t,o){t=e(t);const n=g.get(t);void 0!==n&&(n.chartElement=null,n.dispose(),o&&g.delete(t))}(t,!0)}export{p as C,a as L,C as d,l as e,f as i,v as o,b as r};
