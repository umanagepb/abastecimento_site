import{z as e}from"./dom-utils-728879e5.js";import{E as n,F as t,D as o,a as s,R as i}from"./dragAndDropUnit-c78bb263.js";import"./dom-9e6f7067.js";import"./_tslib-158249d5.js";import"./touch-585ccec1.js";let c,r,u,l,f,a,d,p,m,h=null,v=-1,g=-1,w=!0,y=!1;function _(e,t,o,s){const i=Array.from(t).map((e=>function(e){const n=e.clientRef;return e.serverRef&&(n._dx_server_ref=e.serverRef),n}(e)));if(l?l._id!==s._id&&(q(l),l=s):l=s,!p){p=e;let n=p;for(;n.parentNode!==document&&n.classList;){if(n.classList.contains("modal-dialog")){y=!0;break}n=n.parentNode}}if(f=new Map,a&&a.dispose(),a=new n(p),h||(r=new Map,u=new Map,h=i),g=-1,a.attachEventWithContext(document,"keydown",L,document),h&&(h.sort(((e,n)=>e.dataset.vindex-n.dataset.vindex)),m=function(e,n){if(y)return e;let t=e,o=window.getComputedStyle(t);for(;o.position!==n&&t.parentNode!==document;)t=t.parentNode,o=window.getComputedStyle(t);return t}(p,"absolute"),x(o&&!y),E())){const e=a.attachEvent(m,"focusin",(function(){e.dispose(),h[0].focus()}))}j()}function x(e){w=e,d&&d.dispose();const n=document.querySelector(".column-chooser-exit-button");d=n?new t(n,null,p,!w):null,u.forEach((function(e){e.dispose()})),u=new Map,h.forEach((function(e){!function(e,n){if(e._dx_server_ref){let n=r.get(e);n||(n=new o(e,e.parentNode,O,".column-chooser-drag-icon-owner",A,y),n.onDragStart=M,n.onDrag=T,n.onDragCancel=S,n.onDropAnimationEnd=R,r.set(e,n)),n.reset()}e.classList.remove("up"),e.classList.remove("down"),e.classList.remove("freeze");let s=u.get(e);s||(s=new t(e,".custom-control-input",n,y||!w),s.onFocus=D,s.onBlur=N,s.onClick=k,u.set(e,s));s.reset()}(e,m)}))}function E(){return w}function L(e){switch(E()||(x(!0),9===e.keyCode&&h[h.length-1].focus()),e.keyCode){case 32:g>=0&&(e.preventDefault(),h[g].click());break;case 38:e.preventDefault(),b(-1);break;case 40:e.preventDefault(),b(1)}}function b(e){if(!h||!r)return;g+=e,g=g<0?h.length-1:g,g%=h.length;const n=u.get(h[g]);n&&n.focus()}function D(e){g=h.indexOf(e)}function N(e){g===h.indexOf(e)&&(g===h.length-1&&d&&d.focus(),g=-1)}function k(e){E()&&x(!1)}function C(e){return h.find((function(n,t,o){return function(e,n){const t=z(e);return!!t&&(t.top<=n&&n<=t.bottom)}(n,e.y)}))}function O(e){const n=C(e);return n?{item:n,relativeRect:z(n)}:null}function j(){if(c&&c.style){const e=r.get(c);e&&e.reset();const n=u.get(c);n&&n.reset(),v=-1,c.childNodes.forEach((function(e){e.style&&(e.style.visibility="")})),c=null}}function M(e){c=e,v=h.indexOf(c),h.forEach((function(e){e.blur(),e!==c&&e.classList.add("freeze")})),c.childNodes.forEach((function(e){e.style&&(e.style.visibility="hidden")}));const n=u.get(c);n&&n.stop()}function z(e){let n=f.get(e);if(n)return n;const t=s(e),o=A();return n=new i(t.x-o.x,t.y-o.y,t.width,t.height),f.set(e,n),n}function R(n,t){h.forEach((function(e){r.get(e).stop()}));const o=p.cloneNode(!0);e(o),o.style["z-index"]=2e3,p.parentNode.appendChild(o),l.invokeMethodAsync("OnElementsExchange",n._dx_server_ref,t._dx_server_ref).catch((function(e){console.error(e)})).finally((()=>o.remove()))}function S(e){h.forEach((function(e){e.classList.remove("up"),e.classList.remove("down"),e.classList.remove("freeze")})),j()}function A(){const e=y?p.parentNode:p,n=s(e);return 0!==e.scrollTop?{x:n.x,y:n.y-e.scrollTop}:n.location}function F(e){u.get(e).updateStyleMetadata()}function T(e,n){if(!e)return;-1===v&&(v=h.indexOf(e));const t=C(n.centerOfDraggingObject);if(!t)return;const o=h.indexOf(t);let s=!1;h.forEach(v<o?function(e){c===e&&(s=!0),s?(F(e),e.classList.add("up")):e.classList.remove("up","down"),t===e&&(s=!1)}:v>o?function(e){t===e&&(s=!0),s?(F(e),e.classList.add("down")):e.classList.remove("up","down"),c===e&&(s=!1)}:function(e){e.classList.remove("up","down")})}function q(e){e._id===l._id&&(e.dispose(),r.forEach((function(e,n){e.dispose(),n._dx_server_ref&&n._dx_server_ref.dispose()})),u.forEach((function(e){e.dispose()})),h=null,c=null,v=-1,p=null,f=null,r=null,u=null,l=null,a&&a.dispose(),a=null)}const B={init:_,dispose:q};export{B as default,q as dispose,_ as init};
