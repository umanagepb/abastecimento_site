import{D as e}from"./dom-9e6f7067.js";import{D as t,H as a,P as n,a as r,b as l,c as i}from"./dx-html-element-base-75114249.js";import{DxUIHandlersBridgeTagName as s}from"./dx-ui-handlers-bridge-4076ae57.js";import{R as o}from"./rect-2684652a.js";import{C as d}from"./component-isolate-styles-builder-76197efd.js";import"./_tslib-158249d5.js";import"./data-qa-utils-8be7c726.js";import"./point-9c6ab88a.js";class c{constructor(e){this._pointerDownDate=e.pointerDownDate,this._pointerUpDate=null,this._clearSelection=e.clearSelection,this.dayCellElements=e.dayCellElements,this.refreshUI(!1)}get clearSelection(){return this._clearSelection}get pointerDownDate(){return this._pointerDownDate}get pointerUpDate(){return this._pointerUpDate}set pointerUpDate(e){this._pointerUpDate!==e&&e&&(this._pointerUpDate=e,this.refreshUI(!0))}get isValid(){return!!this._pointerUpDate}stop(){this.refreshUI(!1)}cancel(){for(let e=0;e<this.dayCellElements.length;e++){const t=this.dayCellElements[e];c.removeDayCellSelectedClasses(t),t.hasAttribute("data-selected")&&c.addSelectedClassesToCell(t)}}refreshUI(t){const a=this.getStartDateRange(),n=this.getEndDateRange();for(let r=0;r<this.dayCellElements.length;r++){const l=this.dayCellElements[r],i=Number(l.dataset.date);c.removeDayCellSelectedClasses(l),!t||i!==a&&i!==n||e.addClassName(l,"dxbs-calendar-selected-range"),c.isApplySelectedStyle(i,a,n,t)&&c.addSelectedClassesToCell(l),l.hasAttribute("data-selected")&&!this.clearSelection&&c.addSelectedClassesToCell(l)}}getStartDateRange(){return this.pointerUpDate?Math.min(this.pointerUpDate.getTime(),this.pointerDownDate.getTime()):this.pointerDownDate.getTime()}getEndDateRange(){return this.pointerUpDate?Math.max(this.pointerUpDate.getTime(),this.pointerDownDate.getTime()):this.pointerDownDate.getTime()}static isApplySelectedStyle(e,t,a,n){return!(e<t||e>a)&&(!n||!c.isDateRangeBoundary(e,t,a))}static isDateRangeBoundary(e,t,a){return e===t||e===a}static addSelectedClassesToCell(t){e.addClassName(t,"dxbs-calendar-selected-item")}static removeDayCellSelectedClasses(t){e.removeClassName(t,"dxbs-calendar-selected-item"),e.removeClassName(t,"dxbs-calendar-selected-range"),e.removeClassName(t,"text-white")}}class h{constructor(e,t){this._pointerDownDate=e,this._pointerUpDate=null,this._clearSelection=t}get clearSelection(){return this._clearSelection}get pointerDownDate(){return this._pointerDownDate}get pointerUpDate(){return this._pointerUpDate}set pointerUpDate(e){this._pointerUpDate=e}get isValid(){var e;return this.pointerDownDate.getTime()===(null===(e=this.pointerUpDate)||void 0===e?void 0:e.getTime())}stop(){}cancel(){}}var u;!function(e){e[e.Month=0]="Month",e[e.Year=1]="Year",e[e.Years=2]="Years",e[e.Decades=3]="Decades"}(u||(u={}));class D extends d{constructor(e){super(),this.cardElement=e}buildStyleSheetCore(){const e=this.getCurrentColor(),t=this.getBackgroundColorByElement(this.cardElement);return`\n::slotted(.dxbs-calendar-header) {\n    ${D.getHeaderHoverColorVarDeclaration(e,t)}\n    ${D.getHeaderSelectionColorVarDeclaration(e,t)}\n    ${D.getHeaderActiveColorVarDeclaration(e,t)}\n}\n::slotted(dxbl-calendar-table-container) {\n    ${D.getTableHoverColorVarDeclaration(e,t)}\n    ${D.getTableSelectionColorVarDeclaration(e,t)}\n    ${D.getTableActiveColorVarDeclaration(e,t)}\n    ${this.getTableSelectedTodayColorVarDeclaration(e)}\n}\n`}static getHeaderHoverColorVarDeclaration(e,t){return d.getMixedColorVarDeclaration("--dx-calendar-header-hover-color",t,e,.1)}static getHeaderSelectionColorVarDeclaration(e,t){return d.getMixedColorVarDeclaration("--dx-calendar-header-selection-color",t,e,.15)}static getHeaderActiveColorVarDeclaration(e,t){return d.getMixedColorVarDeclaration("--dx-calendar-header-active-color",t,e,.25)}static getTableHoverColorVarDeclaration(e,t){return d.getMixedColorVarDeclaration("--dx-calendar-table-hover-color",t,e,.05)}static getTableSelectionColorVarDeclaration(e,t){return d.getMixedColorVarDeclaration("--dx-calendar-table-selection-color",t,e,.1)}static getTableActiveColorVarDeclaration(e,t){return d.getMixedColorVarDeclaration("--dx-calendar-table-active-color",t,e,.2)}getTableSelectedTodayColorVarDeclaration(e){return d.getMixedColorVarDeclaration("--dx-calendar-table-selected-today-color",this.primaryColor,e,.1)}getCurrentColor(){return this.getElementValue((e=>e.style.backgroundColor="currentColor"),(e=>this.getBackgroundColorByElement(e)))}}const b=document.createElement("template");b.innerHTML="\n<style></style>\n<slot />";class y extends t{constructor(){var e;super(),this.boundOnStartDaySelectionHandler=this.onStartDaySelection.bind(this),this.boundOnStopDaySelectionHandler=this.onStopDaySelection.bind(this),this.boundOnCancelDaySelectionHandler=this.onCancelDaySelection.bind(this),this.boundOnSelectDayHandler=this.onSelectDay.bind(this),this.boundOnDayCellPointerEnterHandler=this.onDayCellPointerEnter.bind(this),this._enableMultiSelect=!1,this._readonly=!1,this._disabled=!1,this.daySelectionRenderer=null,this.isolatedStyleElement=null===(e=this.shadowRoot)||void 0===e?void 0:e.querySelector("style"),this.calendarTableResizeObserver=new ResizeObserver(this.onCalendarTableSizeChanged.bind(this))}get enableMultiSelect(){return this._enableMultiSelect}set enableMultiSelect(e){this._enableMultiSelect=e}get readonly(){return this._readonly}set readonly(e){this._readonly=e}get disabled(){return this._disabled}set disabled(e){this._disabled=e}initializeComponent(){super.initializeComponent(),this.buildIsolateStyles(),this.addEventSubscriptions(),this.uiHandlersBridge=this.querySelector(s),this.fixCalendarTableSize()}disposeComponent(){delete this.uiHandlersBridge,this.removeEventSubscriptions(),super.disposeComponent()}disconnectedCallback(){this.calendarTableResizeObserver.disconnect(),super.disconnectedCallback()}fixCalendarTableSize(){const e=this.getCalendarTableElement();e.style.width="",e.style.height="";const t=e.getBoundingClientRect();o.fromDomRect(t).isEmpty?this.calendarTableResizeObserver.observe(e):this.applyTableSize(e,t.width,t.height)}applyTableSize(e,t,a){e.style.width=t+"px",e.style.height=a+"px"}onCalendarTableSizeChanged(e){if(e.length<1)return;const t=e[0].target,a=e[0].contentRect;o.fromDomRect(a).isEmpty||(this.applyTableSize(t,a.width,a.height),this.calendarTableResizeObserver.disconnect())}addEventSubscriptions(){this.addEventListener(n.eventName,this.boundOnStartDaySelectionHandler),this.addEventListener(r.eventName,this.boundOnStopDaySelectionHandler),this.addEventListener(l.eventName,this.boundOnCancelDaySelectionHandler),this.addEventListener(i.eventName,this.boundOnSelectDayHandler)}removeEventSubscriptions(){this.removeEventListener(n.eventName,this.boundOnStartDaySelectionHandler),this.removeEventListener(r.eventName,this.boundOnStopDaySelectionHandler),this.removeEventListener(l.eventName,this.boundOnCancelDaySelectionHandler),this.removeEventListener(i.eventName,this.boundOnSelectDayHandler)}addDayCellEventSubscriptions(){const e=this.findDayCellElements();for(let t=0;t<e.length;t++){e[t].addEventListener("pointerenter",this.boundOnDayCellPointerEnterHandler)}}removeDayCellEventSubscriptions(){const e=this.findDayCellElements();for(let t=0;t<e.length;t++){e[t].removeEventListener("pointerenter",this.boundOnDayCellPointerEnterHandler)}}onStartDaySelection(e){if(this.readonly||this.disabled)return;const t=y.getDateFromTarget(e.detail.source.target);if(!t)return;this.daySelectionRenderer=this.createDaySelectionRenderer(t,!e.detail.isLongTap&&(!(e.detail.source.ctrlKey||e.detail.source.metaKey)||e.detail.isTouch)),this.addDayCellEventSubscriptions()}onStopDaySelection(e){this.daySelectionRenderer&&(this.daySelectionRenderer.pointerUpDate=y.getDateFromTarget(e.detail.source.target),this.daySelectionRenderer.stop(),this.raiseSelectionChanged(),this.removeDayCellEventSubscriptions(),this.daySelectionRenderer=null)}onCancelDaySelection(e){this.daySelectionRenderer&&(this.daySelectionRenderer.cancel(),this.removeDayCellEventSubscriptions(),this.daySelectionRenderer=null)}onSelectDay(e){const t=y.getDateFromTarget(e.detail.source.target);t&&this.invokeDayCellPointerUp(t,t,!(e.detail.source.ctrlKey||e.detail.source.metaKey))}raiseSelectionChanged(){this.daySelectionRenderer&&this.daySelectionRenderer.isValid&&this.invokeDayCellPointerUp(this.daySelectionRenderer.pointerDownDate,this.daySelectionRenderer.pointerUpDate,this.daySelectionRenderer.clearSelection)}invokeDayCellPointerUp(e,t,a){var n;null===(n=this.uiHandlersBridge)||void 0===n||n.send("dayCellPointerUp",{pointerDownDate:e,pointerUpDate:t,clearSelection:a})}onDayCellPointerEnter(e){if(!this.daySelectionRenderer)return;const t=y.getDateFromTarget(e.target);this.daySelectionRenderer.pointerUpDate=t}createDaySelectionRenderer(e,t){return this.enableMultiSelect?new c({pointerDownDate:e,clearSelection:t,dayCellElements:this.findDayCellElements()}):new h(e,t)}findDayCellElements(){return this.querySelectorAll(".dxbs-day")}getCalendarTableElement(){return this.querySelector(".card-body > table")}static getDateFromTarget(e){const t=y.getDayCellByTarget(e);return t?y.getDateFromCell(t):null}static getDayCellByTarget(t){const a=t;return a?e.hasClassName(a,"dxbs-day")?a:a.closest(".dxbs-day"):null}static getDateFromCell(e){return new Date(Number(e.getAttribute("data-date")))}getContentTemplate(){return b}buildIsolateStyles(){new D(this).buildStyleSheet(this.isolatedStyleElement)}static get observedAttributes(){return["enable-multi-select","readonly","disabled"]}attributeChangedCallback(e,t,a){switch(e){case"enable-multi-select":this.enableMultiSelect=null!==a;break;case"readonly":this.readonly=null!==a;break;case"disabled":this.disabled=null!==a}}}customElements.define("dxbl-calendar",y),customElements.define("dxbl-calendar-table-container",class extends t{constructor(){super(),this._view=u.Month}get view(){return this._view}set view(e){this._view=e,this.handlePointerEventsMode=a.None,this.view===u.Month&&(this.handlePointerEventsMode=a.Click|a.Dragging)}static get observedAttributes(){return["view"]}attributeChangedCallback(e,t,a){if("view"===e)this.view=Number(a)}});const p={loadModule:function(){}};export{p as default};
