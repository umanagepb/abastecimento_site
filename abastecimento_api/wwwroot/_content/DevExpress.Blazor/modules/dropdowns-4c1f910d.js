import{D as t}from"./dom-9e6f7067.js";import{k as e}from"./key-b2db12a3.js";import{T as n}from"./touch-585ccec1.js";import{c as o,s as i,t as s,a as r,g as l,b as c,i as a,e as d,d as u,f as h,h as f,j as m,R as g}from"./dom-utils-728879e5.js";import{d as p,r as w}from"./disposable-d2c2d283.js";import{scrollToFocusedItem as v}from"./grid-4a24d4c7.js";import{initFocusHidingEvents as b}from"./focus-utils-3a7c8e37.js";import{g as x,a as y,P as M,E as C,b as E}from"./dragAndDropUnit-c78bb263.js";import"./_tslib-158249d5.js";import"./evt-413e0cff.js";import"./column-resize-ad193c96.js";import"./dx-style-helper-ae3caa91.js";const T=document.body,z=new WeakMap,B=new Map,R={subtree:!0,childList:!0},O=new MutationObserver((function(t){t.forEach(P)}));function P(t){t.removedNodes.forEach(k)}function k(t){const e=B.get(t);B.delete(t)&&(0===B.size&&O.disconnect(),e())}const L="\\s*matrix\\(\\s*"+[0,0,0,0,0,0].map((function(){return"(\\-?\\d+\\.?\\d*)"})).join(",\\s*")+"\\)\\s*";function S(t){let e=0;if(null!=t&&""!==t)try{const n=t.indexOf("px");n>-1&&(e=parseFloat(t.substr(0,n)))}catch(t){}return Math.ceil(e)}function D(t,e,n){const o=t.getBoundingClientRect(),i={left:e(o.left),top:e(o.top),right:n(o.right),bottom:n(o.bottom)};return i.width=i.right-i.left,i.height=i.bottom-i.top,i}function N(t){return D(t,Math.floor,Math.ceil)}function I(t){return D(t,Math.ceil,Math.floor)}class H{constructor(t,e){this.key=t,this.info=e}checkMargin(){return!0}allowScroll(){return"height"===this.info.size}canApplyToElement(t){return t.className.indexOf("dxbs-align-"+this.key)>-1}getRange(t){const e=this.getTargetBox(t)[this.info.to],n=e+this.info.sizeM*(t.elementBox[this.info.size]+(this.checkMargin()?t.margin:0));return{from:Math.min(e,n),to:Math.max(e,n),windowOverflow:0}}getTargetBox(t){return null}validate(t,e){const n=e[this.info.size];return t.windowOverflow=Math.abs(Math.min(0,t.from-n.from)+Math.min(0,n.to-t.to)),t.validTo=Math.min(t.to,n.to),t.validFrom=Math.max(t.from,n.from),0===t.windowOverflow}applyRange(t,e){e.appliedModifierKeys[this.info.size]=this.key;const n="width"===this.info.size?"left":"top",o=e.styles;let i=t.from;this.allowScroll()&&t.windowOverflow>0&&(e.limitBox.scroll.width||(e.limitBox.scroll.width=!0,e.limitBox.width.to-=c()),e.isScrollable&&(o["max-height"]=e.height-t.windowOverflow+"px",e.width+=c(),e.elementBox.width+=c(),i=t.validFrom)),o.width=e.width+"px",this.checkMargin()&&(i+=Math.max(0,this.info.sizeM)*e.margin),e.elementBox[n]+=i,o.transform="matrix(1, 0, 0, 1, "+e.elementBox.left+", "+e.elementBox.top+")"}dockElementToTarget(t){const e=this.getRange(t);this.dockElementToTargetInternal(e,t)||this.applyRange(e,t)}dockElementToTargetInternal(t,e){}}class j extends H{constructor(t,e,n){super(t,e,n),this.oppositePointName=n||null}getTargetBox(t){return t.targetBox.outer}getOppositePoint(){return this._oppositePoint||(this._oppositePoint=F.filter(function(t){return t.key===this.oppositePointName}.bind(this))[0])}dockElementToTargetInternal(t,e){if(this.validate(t,e.limitBox))this.applyRange(t,e);else{const n=this.getOppositePoint(),o=n.getRange(e);if(!(n.validate(o,e.limitBox)||o.windowOverflow<t.windowOverflow))return!1;n.applyRange(o,e)}return!0}}class W extends H{checkMargin(){return!1}getTargetBox(t){return t.targetBox.inner}dockElementToTargetInternal(t,e){return this.validate(t,e.limitBox),!1}validate(t,e){const n=Math.min(t.from,Math.max(0,t.to-e[this.info.size].to));return n>0&&(t.from-=n,t.to-=n),super.validate(t,e)}}const F=[new j("above",{to:"top",from:"bottom",size:"height",sizeM:-1},"below"),new j("below",{to:"bottom",from:"top",size:"height",sizeM:1},"above"),new W("top-sides",{to:"top",from:"top",size:"height",sizeM:1}),new W("bottom-sides",{to:"bottom",from:"bottom",size:"height",sizeM:-1}),new j("outside-left",{to:"left",from:"right",size:"width",sizeM:-1},"outside-right"),new j("outside-right",{to:"right",from:"left",size:"width",sizeM:1},"outside-left"),new W("left-sides",{to:"left",from:"left",size:"width",sizeM:1}),new W("right-sides",{to:"right",from:"right",size:"width",sizeM:-1})];function A(e,n,o){const i=l(),s=N(e),r=I(n),c=e.ownerDocument.documentElement,a={isScrollable:t.hasClassName(e,"dxbs-scrollable"),specifiedOffsetModifiers:F.filter((function(t){return t.canApplyToElement(e)})),margin:S(i.marginTop),width:o?Math.max(o.width,Math.ceil(e.offsetWidth)):Math.ceil(e.offsetWidth),height:Math.ceil(e.offsetHeight),appliedModifierKeys:{height:null,width:null}},d=function(t){const e=new RegExp(L).exec(t.transform);return e?{left:parseInt(e[5]),top:parseInt(e[6])}:{left:0,top:0}}(i),u=e.classList.contains("dxbs-visually-hidden")?r.left:s.left;var h,f,m,g;a.elementBox={left:h=d.left-u,top:f=d.top-s.top,right:h+(m=s.width),bottom:f+(g=s.height),width:m,height:g},a.targetBox={outer:N(n),inner:I(n)},a.limitBox={scroll:{width:c.clientWidth<window.innerWidth,height:c.clientHeight<window.innerHeight},width:{from:0,to:c.clientWidth},height:{from:0,to:c.clientHeight}},a.styles={};const p=(e.getAttribute("data-popup-align")||o&&o.align).split(/\s+/);return a.offsetModifiers=F.filter((function(t){return p.some((function(e){return t.key===e}))})),a}function q(t,e,n){null!==e&&(!function(t,e,n,s){o((function(){const o=A(t,e,n);for(let t=0;t<o.offsetModifiers.length;t++)o.offsetModifiers[t].dockElementToTarget(o);s(o),i(t,o.styles)}))}(t,e,{align:n},(()=>{})),s(t,"show",!0),r(t))}function _(t){return parseFloat(window.getComputedStyle(t,null).getPropertyValue("padding-right"))}function U(){return window.innerWidth-document.body.getBoundingClientRect().width}class Y{constructor(t,e){this.element=t,this.getClientRect=e}get leftTopCorner(){const t=this;return new V(this.element,(function(e){return t.getClientRect(e)}),(function(t){return{x:0,y:0}}))}get leftBottomCorner(){const t=this;return new V(this.element,(function(e){const n=t.getClientRect(e);return new M(n.x,n.bottom)}),(function(e){const n=t.getClientRect(e);return new M(0,-n.height)}))}get rightTopCorner(){const t=this;return new V(this.element,(function(e){const n=t.getClientRect(e);return new M(n.right,n.y)}),(function(e){const n=t.getClientRect(e);return new M(-n.width,0)}))}get rightBottomCorner(){const t=this;return new V(this.element,(function(e){const n=t.getClientRect(e);return new M(n.right,n.bottom)}),(function(e){const n=t.getClientRect(e);return new M(-n.width,-n.height)}))}get center(){const t=this;return new V(this.element,(function(e){return t.getClientRect(e).center}))}}class V{constructor(t,e,n){this.element=t,this.getLocation=e,this.getDelta=n}get location(){return this.getLocation(this.element)}get delta(){return this.getDelta(this.element)}anchorTo(t){return new G(this,t)}}class G{constructor(t,e){this.point=t,this.anchor=e,this.events=new C(this);const n=[];if(n.push([window,"resize"]),n.push([window,"scroll"]),this.containers=function(t,e){const n=[];for(;null!==t&&"BODY"!==t.tagName&&"#document"!==t.nodeName;)e(t)&&n.push(t),t=t.parentNode;return 0===n.length?null:n}(this.anchor.element.parentNode,this.isElementScrollable),this.containers&&this.containers.forEach((function(t){n.push([t,"scroll"])})),this.checkInCasesInt(n),"undefined"!=typeof ResizeObserver){const t=this;this.resizeObserver=new window.ResizeObserver((function(){t.update()})),this.resizeObserver.observe(this.anchor.element),this.resizeObserver.observe(this.point.element)}else this.resizeObserver=null;let o=this.point.element.offsetParent;this.notStaticParent=null===o?{x:0,y:0,scrollTop:0,scrollLeft:0}:a(o)?o:window,this.update()}isElementScrollable(t){const e=window.getComputedStyle(t);return"static"===e.position&&("scroll"===e["overflow-x"]||"scroll"===e["overflow-y"]||"auto"===e["overflow-x"]||"auto"===e["overflow-y"])}update(){const t=this.notStaticParent===window?{x:window.scrollX,y:window.scrollY}:{x:this.notStaticParent.scrollLeft,y:this.notStaticParent.scrollTop},e=E(this.anchor.location,"+",this.point.delta,"-",this.notStaticParent,"+",t),n=this.point.element;o((function(){n.style.left=e.x+"px",n.style.top=e.y+"px"}))}checkInCasesInt(t){const e=this.events;t.forEach((function(t){e.attachEvent(t[0],t[1],(function(t){this.update()}))}))}checkInCases(){return this.containers?(this.checkInCasesInt(Array.from(arguments)),this.update(),this):this}dispose(){this.events&&(this.events.dispose(),this.events=null,this.dropDownStartPos=null,this.containers=null,this.resizeObserver&&this.resizeObserver.disconnect())}}function K(t){return new Y(t,x)}function X(t){return new Y(t,y)}var J,Q;!function(t){t[t.Popup=0]="Popup",t[t.Modal=1]="Modal"}(J||(J={})),function(t){t[t.Down=1]="Down",t[t.Up=2]="Up"}(Q||(Q={}));const Z=new WeakMap;let $;const tt=[];function et(t){let e=(t=d(t)).querySelector(".dxbs-dm.dropdown-menu");return e||(e=t.querySelector(".dxgvCSD.dxbs-grid-vsd")),e}function nt(t,e,n,o){return new Promise(((n,i)=>{let s=et(t);s=d(s),s?(0===o&&(s.style.minWidth=t.offsetWidth+"px"),2===o&&(s.style.width=t.offsetWidth+"px"),ot(t,s,e),v(s),n()):n()}))}function ot(t,e,n){Z.has(t)&&(Z.get(t).disconnect(),Z.delete(t));const i=e.offsetParent;if(!i)return void o((function(){e.style.visibility=""}));const s=i.getBoundingClientRect(),r=t.getBoundingClientRect(),l=r.top-s.top,c=s.bottom-r.bottom;let a;const d=window.getComputedStyle(e),u=e.offsetHeight+Math.max(parseFloat(d.marginTop),0)+Math.max(parseFloat(d.marginBottom),0)+8;switch(n){case Q.Up:a=!0,s.top+(l-u)<=0&&s.top+l+t.offsetHeight+u+window.pageYOffset<=Math.max(document.body.scrollHeight,window.innerHeight)&&(a=!1);break;default:a=!1,s.bottom-(c-u)>=window.innerHeight&&s.top+l-u+window.pageYOffset>=0&&(a=!0);break}const h=r.left+e.offsetWidth+8>=document.body.clientWidth&&r.right-e.offsetWidth-8>0;o((()=>{$&&$.dispose(),$=a?h?K(e).rightBottomCorner.anchorTo(X(t).rightTopCorner):K(e).leftBottomCorner.anchorTo(X(t).leftTopCorner):h?K(e).rightTopCorner.anchorTo(X(t).rightBottomCorner):K(e).leftTopCorner.anchorTo(X(t).leftBottomCorner),e.style.visibility=""}))}const it=[{value:0,text:""},{value:1,text:"above"},{value:2,text:"below"},{value:4,text:"top-sides"},{value:8,text:"bottom-sides"},{value:16,text:"outside-left"},{value:32,text:"outside-right"},{value:64,text:"left-sides"},{value:128,text:"right-sides"}];function st(t,e,n){let o=t.target;for(;o;){if(o===e)return;o=o.parentElement}n&&n()}function rt(t){return"hidden"!==t.style.visibility||t.classList.contains("dxbs-visually-hidden")}const lt="a[href], input:not([disabled]), button:not([disabled]), [tabindex]:not([tabindex='-1'])";function ct(t,e){if(!e)return!1;if(u(t.srcElement,"modal-header"))return!0;const n=u(t.srcElement,"column-chooser-elements-container"),o=u(n,"modal-body");if(!n||!o)return!1;if(o.clientHeight>=n.clientHeight)return!0;const i=t.touches[0].pageY-e.touches[0].pageY,s=t=>t.getBoundingClientRect().top,r=n.querySelector(".column-chooser-element-container");if(r&&s(r)===s(o)&&i>=0&&t.cancelable)return!0;const l=t=>Math.round(t.getBoundingClientRect().bottom),c=n.querySelector(".column-chooser-element-container:last-child");return c&&l(c)===l(o)&&i<=0&&t.cancelable}function at(t,e,n){if(n!==J.Modal)return-1;const o=t.getBoundingClientRect(),i=e.getBoundingClientRect(),s=u(t,"dxbs-gridview"),r=s&&s.querySelector("thead");if(!r)return-1;const l=r.getBoundingClientRect(),c=(l||o).bottom;return c>.5*e.clientHeight?c-o.top<.5*e.clientHeight?c-i.top-.5*e.clientHeight:o.top-i.top-2:-1}function dt(t){if(!(t=d(t)))return;const e=t.getElementsByClassName("modal-body")[0];e.style.width=e.offsetWidth+"px",e.style.height=e.offsetHeight+"px"}const ut={init:function(t,e,o,i){if(t=d(t),e=d(e),o=d(o),!t)return Promise.reject("failed");if(p(t),o){const s=n=>{st(n,t,(function(){f(t)||p(t);const n=document.activeElement===e,s=o&&rt(o);(n||s)&&i.invokeMethodAsync("OnDropDownLostFocus",e.value).catch((t=>console.error(t)))}))};document.addEventListener(n.touchMouseDownEventName,s),w(t,(function(){document.removeEventListener(n.touchMouseDownEventName,s)}))}return Promise.resolve("ok")},dispose:function(t){return(t=d(t))&&p(t),$&&$.dispose(),Promise.resolve("ok")},showAdaptiveDropdown:function(i,s,r,l,c,a){if(!(i=d(i)))return Promise.reject();const f=u(i,r);if(!f)return Promise.reject();const p=document.documentElement,w=document.documentElement.style.overflow,v=document.body.style.overflow,x=document.body.scroll,y=s.dialogType,M=s.alignment,C=y===J.Modal;if(y===J.Popup)0===M?ot(f,i,s.dropDownDirection):q(i,f,function(t){let e="";return it.forEach((n=>{0!=(n.value&t)&&(e&&(e+=" "),e+=n.text)})),e}(M));else{tt.push(i),i.style.paddingRight=_(i)+U()+"px";const t=_(document.body)+U();document.body.style.paddingRight=String(t),document.body.classList.add("modal-open")}let E=!1;function P(t){const e=t.srcElement;i&&e&&(!i.contains(e)||y===J.Modal&&i===e)&&L(i)}function k(t){const e=t.target;e&&(p.removeEventListener("focusin",k),null===t.relatedTarget&&i&&i.contains(e)&&e.focus())}function L(t){if(!E){if(E=!0,m(t))return;S(),c.invokeMethodAsync("CloseDialog").catch((function(e){m(t)||console.error(e)}))}}function S(){if(p.removeEventListener(n.touchMouseDownEventName,P),window.removeEventListener("resize",N),y===J.Modal){if(i){const t=tt.indexOf(i);t>-1&&tt.splice(t,1)}tt.length||(I(y,!1),document.body.classList.remove("modal-open"),document.body.style.paddingRight=String(_(document.body)-U()))}i=null}function D(){if(!i)return;const t=i.querySelector(lt);t&&t.focus()}function N(){if(!i||!u(i,"modal-dialog-owner"))return;const t=i.firstElementChild;if(!t)return;const e=t.classList,n=at(f,p,y),o=p.clientHeight>p.clientWidth?"topVertical":"topHorizontal";g((function(){e.contains("topVertical")||e.contains("topHorizontal")?e.remove("transition"):e.add("transition"),n&&(p.scrollTop=n),e.remove("topVertical","topHorizontal"),e.add(o)}))}function I(t,e){if(t!==J.Modal)return;let n,o,i;e?(n="hidden",o="hidden",i=()=>{}):(n=w,o=v,i=x),document.documentElement.style.overflow=n,document.body.style.overflow=o,document.body.scroll=i}return p.addEventListener(n.touchMouseDownEventName,P),i.addEventListener("keydown",(function(t){i&&t.keyCode===e.KeyCode.Esc&&L(i)})),i.addEventListener("focusout",(function(t){const e=t.relatedTarget;!E&&i&&(e&&!i.contains(e)?function(t){if(!i)return;const e=i.compareDocumentPosition(t);e&window.Node.DOCUMENT_POSITION_PRECEDING?function(){if(!i)return;const t=function(t){const e=t.querySelectorAll(lt);return e[e.length-1]}(i);t&&t.focus()}():e&window.Node.DOCUMENT_POSITION_FOLLOWING&&D()}(e):null===e&&p.addEventListener("focusin",k))})),function(t,e,n,o){t&&e.addEventListener("touchmove",(t=>{t.srcElement===e&&t.preventDefault()}));if(o===J.Modal){let t;n.addEventListener("touchstart",(e=>{t=e})),n.addEventListener("touchmove",(e=>{ct(e,t)&&e.preventDefault(),t=e}))}}(C,i,f,y),function(t){if(z.has(t))return z.get(t);const e=new Promise((function(e){0===B.size&&O.observe(T,R),B.set(t,(()=>{e(void 0)}))}));return z.set(t,e),e}(i).then((()=>{S(),i=null})),I(y,!0),o((function(){i&&(s.showFocus||(t.addClassName(i,"dxbs-focus-hidden"),b(i)),y===J.Popup&&(D(),function(t,e){const n=u(t,e);if(t&&n){const e=u(t,"dx-menu-bar");e&&e.classList.contains("vertical")||(h(n,o),o())}function o(){const e=t.getBoundingClientRect(),o=n.getBoundingClientRect(),i=parseFloat(t.style.marginLeft);if(i&&(e.x=e.x-i),e.x+e.width>o.x+o.width&&o.width>e.width){const n=u(t.parentNode,"dropdown-menu");if(n){const o=n.getBoundingClientRect(),i=parseFloat(window.getComputedStyle(n,null).getPropertyValue("border-right-width"));t.style.marginLeft="-"+(e.x+e.width-o.x-i)+"px"}else t.style.marginLeft="-"+(e.x+e.width-o.x-o.width)+"px"}else i&&(t.style.marginLeft="")}}(i,a)))})),y===J.Modal&&(window.addEventListener("resize",N),N()),Promise.resolve()},updateGridDropDown:nt,setInlineModalSize:dt};export{J as DialogType,ut as default,et as getDropDownElement,rt as isDropDownVisible,st as onOutsideClick,at as scrollDropDown,dt as setInlineModalSize,ot as setPositionOfDropDown,ct as shouldPreventTouchMove,nt as updateGridDropDown};
