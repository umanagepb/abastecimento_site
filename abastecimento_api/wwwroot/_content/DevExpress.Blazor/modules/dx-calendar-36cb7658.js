import{D as e}from"./dom-9e6f7067.js";import{D as t,H as n,P as i,a,b as s}from"./dx-html-element-base-0df9d3c5.js";import{DxUIHandlersBridgeTagName as l}from"./dx-ui-handlers-bridge-4076ae57.js";import{R as r}from"./rect-2684652a.js";import"./_tslib-158249d5.js";import"./data-qa-utils-8be7c726.js";import"./eventhelper-dec6cde0.js";import"./point-9c6ab88a.js";class o{constructor(e){this._pointerDownDate=e.pointerDownDate,this._pointerUpDate=null,this._clearSelection=e.clearSelection,this.dayCellElements=e.dayCellElements,this.refreshUI(!1)}get clearSelection(){return this._clearSelection}get pointerDownDate(){return this._pointerDownDate}get pointerUpDate(){return this._pointerUpDate}set pointerUpDate(e){this._pointerUpDate!==e&&e&&(this._pointerUpDate=e,this.refreshUI(!0))}get isValid(){return!!this._pointerUpDate}stop(){this.refreshUI(!1)}cancel(){for(let e=0;e<this.dayCellElements.length;e++){const t=this.dayCellElements[e];o.removeDayCellSelectedClasses(t),t.hasAttribute("data-selected")&&o.addSelectedClassesToCell(t)}}refreshUI(t){const n=this.getStartDateRange(),i=this.getEndDateRange();for(let a=0;a<this.dayCellElements.length;a++){const s=this.dayCellElements[a],l=Number(s.dataset.date);o.removeDayCellSelectedClasses(s),!t||l!==n&&l!==i||e.addClassName(s,"dxbs-calendar-selected-range"),o.isApplySelectedStyle(l,n,i,t)&&o.addSelectedClassesToCell(s),s.hasAttribute("data-selected")&&!this.clearSelection&&o.addSelectedClassesToCell(s)}}getStartDateRange(){return this.pointerUpDate?Math.min(this.pointerUpDate.getTime(),this.pointerDownDate.getTime()):this.pointerDownDate.getTime()}getEndDateRange(){return this.pointerUpDate?Math.max(this.pointerUpDate.getTime(),this.pointerDownDate.getTime()):this.pointerDownDate.getTime()}static isApplySelectedStyle(e,t,n,i){return!(e<t||e>n)&&(!i||!o.isDateRangeBoundary(e,t,n))}static isDateRangeBoundary(e,t,n){return e===t||e===n}static addSelectedClassesToCell(t){e.addClassName(t,"dxbs-calendar-selected-item")}static removeDayCellSelectedClasses(t){e.removeClassName(t,"dxbs-calendar-selected-item"),e.removeClassName(t,"dxbs-calendar-selected-range"),e.removeClassName(t,"text-white")}}class d{constructor(e,t){this._pointerDownDate=e,this._pointerUpDate=null,this._clearSelection=t}get clearSelection(){return this._clearSelection}get pointerDownDate(){return this._pointerDownDate}get pointerUpDate(){return this._pointerUpDate}set pointerUpDate(e){this._pointerUpDate=e}get isValid(){var e;return this.pointerDownDate.getTime()===(null===(e=this.pointerUpDate)||void 0===e?void 0:e.getTime())}stop(){}cancel(){}}var c;!function(e){e[e.Month=0]="Month",e[e.Year=1]="Year",e[e.Years=2]="Years",e[e.Decades=3]="Decades"}(c||(c={}));const h=document.createElement("template");h.innerHTML="\n<style></style>\n<slot />";class p extends t{constructor(){super(),this.boundOnStartDaySelectionHandler=this.onStartDaySelection.bind(this),this.boundOnStopDaySelectionHandler=this.onStopDaySelection.bind(this),this.boundOnCancelDaySelectionHandler=this.onCancelDaySelection.bind(this),this.boundOnDayCellPointerEnterHandler=this.onDayCellPointerEnter.bind(this),this._enableMultiSelect=!1,this._readonly=!1,this._disabled=!1,this.daySelectionRenderer=null,this.calendarTableResizeObserver=new ResizeObserver(this.onCalendarTableSizeChanged.bind(this))}get enableMultiSelect(){return this._enableMultiSelect}set enableMultiSelect(e){this._enableMultiSelect=e}get readonly(){return this._readonly}set readonly(e){this._readonly=e}get disabled(){return this._disabled}set disabled(e){this._disabled=e}connectedCallback(){super.connectedCallback(),this.addEventSubscriptions()}initializeComponent(){super.initializeComponent(),this.uiHandlersBridge=this.querySelector(l),this.fixCalendarTableSize()}disposeComponent(){this.removeEventSubscriptions(),super.disposeComponent()}disconnectedCallback(){this.calendarTableResizeObserver.disconnect(),super.disconnectedCallback()}fixCalendarTableSize(){const e=this.getCalendarTableElement();e.style.width="",e.style.height="";const t=e.getBoundingClientRect();r.fromDomRect(t).isEmpty?this.calendarTableResizeObserver.observe(e):this.applyTableSize(e,t.width,t.height)}applyTableSize(e,t,n){e.style.width=t+"px",e.style.height=n+"px"}onCalendarTableSizeChanged(e){if(e.length<1)return;const t=e[0].target,n=e[0].contentRect;r.fromDomRect(n).isEmpty||(this.applyTableSize(t,n.width,n.height),this.calendarTableResizeObserver.disconnect())}addEventSubscriptions(){this.addEventListener(i.eventName,this.boundOnStartDaySelectionHandler),this.addEventListener(a.eventName,this.boundOnStopDaySelectionHandler),this.addEventListener(s.eventName,this.boundOnCancelDaySelectionHandler)}removeEventSubscriptions(){this.removeEventListener(i.eventName,this.boundOnStartDaySelectionHandler),this.removeEventListener(a.eventName,this.boundOnStopDaySelectionHandler),this.removeEventListener(s.eventName,this.boundOnCancelDaySelectionHandler)}addDayCellEventSubscriptions(){const e=this.findDayCellElements();for(let t=0;t<e.length;t++){e[t].addEventListener("pointerenter",this.boundOnDayCellPointerEnterHandler)}}removeDayCellEventSubscriptions(){const e=this.findDayCellElements();for(let t=0;t<e.length;t++){e[t].removeEventListener("pointerenter",this.boundOnDayCellPointerEnterHandler)}}onStartDaySelection(e){if(this.readonly||this.disabled)return;const t=p.getDateFromTarget(e.detail.source.target);if(!t)return;this.daySelectionRenderer=this.createDaySelectionRenderer(t,!e.detail.isLongTap&&(!(e.detail.source.ctrlKey||e.detail.source.metaKey)||e.detail.isTouch)),this.addDayCellEventSubscriptions(),e.stopPropagation()}onStopDaySelection(e){this.daySelectionRenderer&&(this.daySelectionRenderer.pointerUpDate=p.getDateFromTarget(e.detail.source.target),this.daySelectionRenderer.stop(),this.raiseSelectionChanged(),this.removeDayCellEventSubscriptions(),this.daySelectionRenderer=null,e.stopPropagation())}onCancelDaySelection(e){this.daySelectionRenderer&&(this.daySelectionRenderer.cancel(),this.removeDayCellEventSubscriptions(),this.daySelectionRenderer=null,e.stopPropagation())}raiseSelectionChanged(){this.daySelectionRenderer&&this.daySelectionRenderer.isValid&&this.invokeDayCellPointerUp(this.daySelectionRenderer.pointerDownDate,this.daySelectionRenderer.pointerUpDate,this.daySelectionRenderer.clearSelection)}invokeDayCellPointerUp(e,t,n){var i;null===(i=this.uiHandlersBridge)||void 0===i||i.send("dayCellPointerUp",{pointerDownDate:e,pointerUpDate:t,clearSelection:n})}onDayCellPointerEnter(e){if(!this.daySelectionRenderer)return;const t=p.getDateFromTarget(e.target);this.daySelectionRenderer.pointerUpDate=t}createDaySelectionRenderer(e,t){return this.enableMultiSelect?new o({pointerDownDate:e,clearSelection:t,dayCellElements:this.findDayCellElements()}):new d(e,t)}findDayCellElements(){return this.querySelectorAll(".dxbs-day")}getCalendarTableElement(){return this.querySelector(".card-body > table")}static getDateFromTarget(e){const t=p.getDayCellByTarget(e);return t?p.getDateFromCell(t):null}static getDayCellByTarget(t){const n=t;return n?e.hasClassName(n,"dxbs-day")?n:n.closest(".dxbs-day"):null}static getDateFromCell(e){return new Date(Number(e.getAttribute("data-date")))}getContentTemplate(){return h}static get observedAttributes(){return["enable-multi-select","readonly","disabled"]}attributeChangedCallback(e,t,n){switch(e){case"enable-multi-select":this.enableMultiSelect=null!==n;break;case"readonly":this.readonly=null!==n;break;case"disabled":this.disabled=null!==n}}}customElements.define("dxbl-calendar",p),customElements.define("dxbl-calendar-table-container",class extends t{constructor(){super(),this._view=c.Month}get view(){return this._view}set view(e){this._view=e,this.handlePointerEventsMode=n.None,this.view===c.Month&&(this.handlePointerEventsMode=n.Click|n.Dragging)}static get observedAttributes(){return["view"]}attributeChangedCallback(e,t,n){if("view"===e)this.view=Number(n)}});const u={loadModule:function(){}};export{u as default};
